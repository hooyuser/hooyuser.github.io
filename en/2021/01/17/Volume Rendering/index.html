

<!DOCTYPE html>
<html lang="en" data-default-color-scheme=&#34;auto&#34;>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/en/img/icon.png">
  <link rel="icon" type="image/png" href="/en/img/icon.png">
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="description" content="">
  <meta name="author" content="Hooy">
  <meta name="keywords" content="">
  <title>Volume Rendering - Topos Cat</title>

  <link  rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/4.4.1/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://cdn.staticfile.org/github-markdown-css/4.0.0/github-markdown.min.css" />
  <link  rel="stylesheet" href="/en/lib/hint/hint.min.css" />

  
    
    
      
      <link  rel="stylesheet" href="https://cdn.staticfile.org/highlight.js/10.0.0/styles/github-gist.min.css" />
    
  

  


<!-- 主题依赖的图标库，不要自行修改 -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_pf9vaxs7x7b.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_kmeydafke9r.css">


<link  rel="stylesheet" href="/en/css/main.css" />

<!-- 自定义样式保持在最底部 -->

  
<link rel="stylesheet" href="/en/css/custom_icon.css">
<link rel="stylesheet" href="/en/css/custom_toc.css">



  <script  src="/en/js/utils.js" ></script>
  <script  src="/en/js/color-schema.js" ></script>
<!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<!-- hexo injector head_end end --><meta name="generator" content="Hexo 5.4.0"></head>


<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand"
       href="/en/">&nbsp;<strong>Topos Cat</strong>&nbsp;</a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/en/">
                <i class="iconfont icon-home-fill"></i>
                Home
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/en/archives/">
                <i class="iconfont icon-archive-fill"></i>
                Archive
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/en/categories/">
                <i class="iconfont icon-category-fill"></i>
                Category
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/en/tags/">
                <i class="iconfont icon-tags-fill"></i>
                Tag
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/en/demo/">
                <i class="iconfont icon-shiyan"></i>
                Demo
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/en/about/">
                <i class="iconfont icon-user-fill"></i>
                About
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/en/links/">
                <i class="iconfont icon-link-fill"></i>
                Link
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" data-toggle="modal" data-target="#modalSearch">&nbsp;<i
                class="iconfont icon-search"></i>&nbsp;</a>
          </li>
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" href="javascript:">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="banner intro-2" id="background" parallax=true
         style="background: url('/en/img/volume_rendering/volume_rendering_banner.jpg') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="container page-header text-center fade-in-up">
            <span class="h2" id="subtitle">
              
            </span>

            
              <div class="mt-3">
  
  
    <span class="post-meta">
      <i class="iconfont icon-date-fill" aria-hidden="true"></i>
      <time datetime="2021-01-17 10:44" pubdate>
        January 17, 2021 am
      </time>
    </span>
  
</div>

<div class="mt-1">
  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      3.6k Words
    </span>
  

  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      63
       Minutes
    </span>
  

  
  
    
      <!-- 不蒜子统计文章PV -->
      <span id="busuanzi_container_page_pv" style="display: none">
        <i class="iconfont icon-eye" aria-hidden="true"></i>
        <span id="busuanzi_value_page_pv"></span> Views
      </span>
    
  
</div>

            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid">
  <div class="row">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-md">
      <div class="container nopadding-md" id="board-ctn">
        <div class="py-5" id="board">
          <article class="post-content mx-auto" id="post">
            <!-- SEO header -->
            <h1 style="display: none">Volume Rendering</h1>
            
              <p class="note note-info">
                
                  Last Update：August 6, 2021 am
                
              </p>
            
            <div class="markdown-body" id="post-body">
              <p>Volume rendering should consider not only the interaction between light and object surface, but also the interaction with a large number of particles in space. In this article, the general theory of volume rendering is introduced, and the ray propagation equation in the form of integral equation is derived. Finally, an example of real-time volume rendering is given.</p>
<h1 id="Volume-Media"><a href="#Volume-Media" class="headerlink" title="Volume Media"></a>Volume Media</h1><p>The volume medium is composed of a large number of particles in the volume. When light propagates in the medium, there may be three situations: transmission, absorption and scattering.</p>
<center>
    <img style="border-radius: 0.3125em;
    box-shadow: 0 2px 4px 0 rgba(34,36,38,.12),0 2px 10px 0 rgba(34,36,38,.08);" 
    src="/img/volume_rendering/volume_rendering_1.png" width="90%">
    <br>
    <div style="color:orange;
    font-size:14px;
    display: inline-block;
    color: #999;
    padding: 10px;">图1 - 光线与微粒的作用</div>
</center>

<p>At the same time, there may exist emission in the medium.</p>
<h2 id="Absorption"><a href="#Absorption" class="headerlink" title="Absorption"></a>Absorption</h2><p>Absorption is described by the <strong>absorption cross section</strong> of the medium, usually denoted as $\sigma_a$. Suppose that the light along $\boldsymbol{\omega}$ interacts with the medium at the point $\bf p$. Let $\sigma_a(\mathbf{p},\boldsymbol{\omega})$ be the ratio of the absorbed radiance to the original radiance after the light travels a unit length along the direction of $\boldsymbol{\omega}$ at the point $\bf p$, which can also be understood as the probability of light absorption. If the scattering of light in the medium is not considered, that is, the light always propagates along a straight line, then we can get the following formula about the radiance</p>
<script type="math/tex; mode=display">
d L_{o}(\mathbf{p},\boldsymbol{\omega})=-\sigma_{a}(\mathbf{p},\boldsymbol{\omega}) L_{i}(\mathbf{p},-\boldsymbol{\omega}) d t.</script><h2 id="Out-scattering"><a href="#Out-scattering" class="headerlink" title="Out-scattering"></a>Out-scattering</h2><p>If the light traveling along the direction $\boldsymbol{\omega}$ is scattered to other directions at the point $\bf p$, we call this kind of scattering <strong>out-scattering</strong>. <strong>scattering coefficient</strong> <script type="math/tex">\sigma_s(\mathbf{p},\boldsymbol{\omega})</script> represents the ratio of the emissivity scattered by the outside to the original emissivity after the light travels unit length in the direction of <script type="math/tex">\boldsymbol{\omega}</script> at the point $\bf p$. The out-scattering phenomenon is similar to the absorption phenomenon, which will lead to a decrease in the radiance emitted in the direction <script type="math/tex">\boldsymbol{\omega}</script> at the point $\bf p$, denoted by <script type="math/tex">L_{o}(\mathbf{p},\boldsymbol{\omega})</script>. The change rate of radiance caused by out-scattering can be described by the following formula</p>
<script type="math/tex; mode=display">
\frac{d L_{o}(\mathbf{p},\boldsymbol{\omega})}{d t}=-\sigma_{s}(\mathbf{p},\boldsymbol{\omega}) L_{i}(\mathbf{p},-\boldsymbol{\omega}).</script><p>吸收和外散射的合效应称为 <strong>衰减</strong>（attenuation）或者 <strong>灭减</strong>（extinction）. <strong>衰减系数</strong> $\sigma_{t}$ 定义为</p>
<script type="math/tex; mode=display">
\sigma_{\mathrm{t}}(\mathbf{p},\boldsymbol{\omega})=\sigma_{a}(\mathbf{p},\boldsymbol{\omega})+\sigma_{s}(\mathbf{p},\boldsymbol{\omega}).</script><p>衰减效应可由下式描述</p>
<script type="math/tex; mode=display">
\frac{d L_{o}(\mathbf{p},\boldsymbol{\omega})}{d t}=-\sigma_{\mathrm{t}}(\mathbf{p},\boldsymbol{\omega}) L_{i}(\mathbf{p},-\boldsymbol{\omega}).</script><p>有两个与衰减系数相关的量也很常见. 一个是 <strong>反射率</strong>（albedo）$\rho$, 由下式定义</p>
<script type="math/tex; mode=display">
\rho=\frac{\sigma_{s}}{\sigma_{\mathrm{t}}}=\frac{\sigma_{s}}{\sigma_a+\sigma_{s}}.</script><p>表示外散射效应占衰减效应的比重. 另一个是 <strong>平均自由程</strong>（mean free path）$1/\sigma_t$, 表示一个光子沿直线行进而不被吸收或散射的平均距离. </p>
<p>如果只考虑衰减效应, 则有 <script type="math/tex">L_{o}(\mathbf{p},\boldsymbol{\omega})=L_{i}(\mathbf{p},-\boldsymbol{\omega})</script>, 从而有</p>
<script type="math/tex; mode=display">
d \ln L_{o}(\mathbf{p},\boldsymbol{\omega})=-\sigma_{\mathrm{t}}(\mathbf{p},\boldsymbol{\omega})dt.</script><p>设 $\mathbf{p}’=\mathbf{p}+h\boldsymbol{\omega}$, 从 $\mathbf{p}$ 到 $\mathbf{p}’$ 点积分可得</p>
<script type="math/tex; mode=display">
\ln L_{o}(\mathbf{p}',\boldsymbol{\omega})-\ln L_{o}(\mathbf{p},\boldsymbol{\omega})=-\int_{0}^{h} \sigma_{\mathrm{t}}(\mathrm{p}+t \boldsymbol{\omega}, \boldsymbol{\omega}) dt,</script><p>即</p>
<script type="math/tex; mode=display">
T_{r}\left(\mathbf{p} \rightarrow \mathbf{p}^{\prime}\right)=\frac{L_{o}(\mathbf{p}',\boldsymbol{\omega})}{L_{o}(\mathbf{p},\boldsymbol{\omega})}=\mathrm{e}^{-\int_{0}^{h} \sigma_{\mathrm{t}}(\mathrm{p}+t \boldsymbol{\omega}, \boldsymbol{\omega}) dt}.</script><p>上式 <script type="math/tex">T_{r}\left(\mathbf{p} \rightarrow \mathbf{p}^{\prime}\right)</script> 被称作 <strong>光束透射比</strong>（beam transmittance）, 表示光束中未被吸收或散射的光线所占的比例. <script type="math/tex">T_{r}\left(\mathbf{p} \rightarrow \mathbf{p}^{\prime}\right)</script> 有一些常用的性质. 一个是</p>
<script type="math/tex; mode=display">
T_{r}\left(\mathbf{p} \rightarrow \mathbf{p}\right)=1,</script><p>另一个是</p>
<script type="math/tex; mode=display">
T_{r}\left(\mathbf{p} \rightarrow \mathbf{p}^{\prime\prime}\right)=T_{r}\left(\mathbf{p} \rightarrow \mathbf{p}^{\prime}\right)T_{r}\left(\mathbf{p}^{\prime}\rightarrow \mathbf{p}^{\prime\prime}\right).</script><p>我们通常还会假设</p>
<script type="math/tex; mode=display">
\sigma_{\mathrm{t}}(\mathbf{p},\boldsymbol{\omega})=\sigma_{\mathrm{t}}(\mathbf{p},-\boldsymbol{\omega}),</script><p>于是</p>
<script type="math/tex; mode=display">
\begin{aligned}
    T_{r}\left(\mathbf{p}' \rightarrow \mathbf{p}\right)&=\mathrm{e}^{-\int_{0}^{h} \sigma_{\mathrm{t}}(\mathrm{p}'+t (-\boldsymbol{\omega}), -\boldsymbol{\omega}) dt}\\
    &=\mathrm{e}^{-\int_{0}^{h} \sigma_{\mathrm{t}}(\mathrm{p}+(h-t)\boldsymbol{\omega}, \boldsymbol{\omega}) dt}\\
    &=\mathrm{e}^{\int_{h}^{0} \sigma_{\mathrm{t}}(\mathrm{p}+u\boldsymbol{\omega}, \boldsymbol{\omega}) du}\\
    &=\mathrm{e}^{-\int_{0}^{h} \sigma_{\mathrm{t}}(\mathrm{p}+u\boldsymbol{\omega}, \boldsymbol{\omega}) du}\\
    &=T_{r}\left(\mathbf{p} \rightarrow \mathbf{p}'\right).
\end{aligned}</script><p>特别地, 如果 $\sigma_{\mathrm{t}}$ 是常数, 我们有</p>
<script type="math/tex; mode=display">
T_{r}\left(\mathbf{p} \rightarrow \mathbf{p}^{\prime}\right)=\mathrm{e}^{-\sigma_{\mathrm{t}}h}=\mathrm{e}^{-\sigma_{\mathrm{t}}\Vert\mathbf{p} -\mathbf{p}^{\prime}\Vert}.</script><p>上式被称作 Beer-Lambert 定律. </p>
<h2 id="Emission"><a href="#Emission" class="headerlink" title="Emission"></a>Emission</h2><p>点 $\mathbf{p}$ 处的介质沿 $\boldsymbol{\omega}$ 方向单位长度内产生的辐射率为 $L_{\mathrm{e}}(\mathrm{p}, \omega)$, 公式写作</p>
<script type="math/tex; mode=display">
\mathrm{d} L_{o}(\mathrm{p}, \omega)=L_{\mathrm{e}}(\mathrm{p}, \omega) \mathrm{d} t.</script><h2 id="In-scattering"><a href="#In-scattering" class="headerlink" title="In-scattering"></a>In-scattering</h2><p>如果在点 $\bf p$ 处, 来自其他方向的光线被散射到了 $\boldsymbol{\omega}$ 方向, 则称这种散射为 <strong>内散射</strong>（in-scattering）. </p>
<p>我们用 <strong>相函数</strong>（phase function）$p(\mathbf{p},\boldsymbol{\omega}_i,\boldsymbol{\omega}_o)$ 来描述散射辐射率在各个方向上的分布, 其中 $\mathbf{p}$ 是点的位置, $\boldsymbol{\omega}_i$ 是入射光方向, $\boldsymbol{\omega}_o$ 是散射光方向. 根据定义, 相函数必须满足：</p>
<script type="math/tex; mode=display">
\int_{S^2}p(\mathbf{p},\boldsymbol{\omega}_i,\boldsymbol{\omega}_o)d\boldsymbol{\omega}_o=1.</script><p>内散射效应使点 $\bf p$ 处沿 $\boldsymbol{\omega}$ 方向出射的辐射率增加. 如果考虑介质发射产生的辐射率, 那么内散射和发射导致的单位长度辐射率增加的总量可以用</p>
<script type="math/tex; mode=display">
L_{\mathrm{s}}(\mathbf{p},\boldsymbol{\omega})=L_{\mathrm{e}}(\mathbf{p},\boldsymbol{\omega})+ \int_{\mathrm{S}^{2}} p\left(\mathbf{p}, \boldsymbol{\omega}_i, \boldsymbol{\omega}\right) \sigma_{\mathrm{s}}(\mathbf{p},\boldsymbol{\omega}_i)L_{i}\left(\mathbf{p},\boldsymbol{\omega}_i\right) d\boldsymbol{\omega}_i</script><p>来表示. $L_{\mathrm{s}}(\mathbf{p},\boldsymbol{\omega})$ 通常称为 <strong>源项</strong>（source term）. </p>
<h1 id="The-Equation-of-Transfer"><a href="#The-Equation-of-Transfer" class="headerlink" title="The Equation of Transfer"></a>The Equation of Transfer</h1><h2 id="Differential-integral-Equation-Form"><a href="#Differential-integral-Equation-Form" class="headerlink" title="Differential-integral Equation Form"></a>Differential-integral Equation Form</h2><p>设 $\mathbf{p}(t)=\mathbf{p}_0+t\boldsymbol{\omega}$, 点 $\mathbf{p}(t)$ 处 $\boldsymbol{\omega}$ 方向辐射率的变化率由衰减效应和源项决定. 根据这个关系得到的方程</p>
<script type="math/tex; mode=display">
\frac{d L_{o}(\mathbf{p}(t),\boldsymbol{\omega})}{d t}=-\sigma_{t}(\mathbf{p}(t),\boldsymbol{\omega}) L_{i}(\mathbf{p}(t),-\boldsymbol{\omega})+ L_{\mathrm{s}}(\mathbf{p}(t),\boldsymbol{\omega}),</script><p>即</p>
<script type="math/tex; mode=display">
\begin{aligned}
   &\frac{d L_{o}(\mathbf{p}(t),\boldsymbol{\omega})}{d t}\\
   =\ &-\sigma_{t}(\mathbf{p}(t),\boldsymbol{\omega}) L_{i}(\mathbf{p}(t),-\boldsymbol{\omega})+L_{\mathrm{e}}(\mathbf{p}(t),\boldsymbol{\omega})+ \int_{\mathrm{S}^{2}} p\left(\mathbf{p}(t), \boldsymbol{\omega}_i, \boldsymbol{\omega}\right) \sigma_{\mathrm{s}}(\mathbf{p}(t),\boldsymbol{\omega}_i)L_{i}\left(\mathbf{p}(t),\boldsymbol{\omega}_i\right) d\boldsymbol{\omega}_i,
\end{aligned}</script><p>被称作 <strong>传输方程</strong>（the equation of transfer）. </p>
<h2 id="Integral-Equation-Form"><a href="#Integral-Equation-Form" class="headerlink" title="Integral Equation Form"></a>Integral Equation Form</h2><p>为了便于求解, 可以通过给定边界条件</p>
<script type="math/tex; mode=display">
L_{o}\left(\mathbf{p}(0),\boldsymbol{\omega}\right)=L_{o}\left(\mathbf{p}_{0},\boldsymbol{\omega}\right),</script><p>将传输方程改写为关于 $L_{i}(\mathbf{p}(t),-\boldsymbol{\omega})$ 的积分方程. </p>
<p>注意到 <script type="math/tex">L_{o}(\mathbf{p}(t),\boldsymbol{\omega})=L_{i}(\mathbf{p}(t),-\boldsymbol{\omega})</script>, 移项得</p>
<script type="math/tex; mode=display">
\frac{d L_{i}(\mathbf{p}(t),-\boldsymbol{\omega})}{d t}+\sigma_{t}(\mathbf{p}(t),\boldsymbol{\omega}) L_{i}(\mathbf{p}(t),-\boldsymbol{\omega})= L_{\mathrm{s}}(\mathbf{p}(t),\boldsymbol{\omega}),</script><p>方程两边同乘</p>
<script type="math/tex; mode=display">
e^{\int_{0}^{t} \sigma_{\mathrm{t}}(\mathbf{p}(u), \boldsymbol{\omega}) du}</script><p>得</p>
<script type="math/tex; mode=display">
\begin{aligned}
    &\frac{d L_{i}(\mathbf{p}(t),-\boldsymbol{\omega})}{d t}e^{\int_{0}^{t} \sigma_{\mathrm{t}}(\mathbf{p}(u), -\boldsymbol{\omega}) du}+ L_{i}(\mathbf{p}(t),-\boldsymbol{\omega})\frac{d\left(e^{\int_{0}^{t} \sigma_{\mathrm{t}}(\mathbf{p}(u), -\boldsymbol{\omega}) du}\right)}{dt}\\
    =\ & L_{\mathrm{s}}(\mathbf{p}(t),\boldsymbol{\omega})e^{\int_{0}^{t} \sigma_{\mathrm{t}}(\mathbf{p}(u), -\boldsymbol{\omega}) du},
\end{aligned}</script><p>即</p>
<script type="math/tex; mode=display">
d\left(L_{i}(\mathbf{p}(t),-\boldsymbol{\omega})e^{\int_{0}^{t} \sigma_{\mathrm{t}}(\mathbf{p}(u), \boldsymbol{\omega}) du}\right)=L_{\mathrm{s}}(\mathbf{p}(t),\boldsymbol{\omega})e^{\int_{0}^{t} \sigma_{\mathrm{t}}(\mathbf{p}(u), \boldsymbol{\omega}) du}dt.</script><p>从 $0$ 积分到 $t$ 得</p>
<script type="math/tex; mode=display">
\left.\left(L_{i}(\mathbf{p}(s),-\boldsymbol{\omega})e^{\int_{0}^{s} \sigma_{\mathrm{t}}(\mathbf{p}(u), \boldsymbol{\omega}) du}\right)\right|_{0}^{t}=\int_{0}^tL_{\mathrm{s}}(\mathbf{p}(s),\boldsymbol{\omega})e^{\int_{0}^{s} \sigma_{\mathrm{t}}(\mathbf{p}(u), \boldsymbol{\omega}) du}ds</script><p>即</p>
<script type="math/tex; mode=display">
L_{i}(\mathbf{p}(t),-\boldsymbol{\omega})e^{\int_{0}^{t} \sigma_{\mathrm{t}}(\mathbf{p}(u), \boldsymbol{\omega}) du}-L_{i}(\mathbf{p}_0,-\boldsymbol{\omega})=\int_{0}^tL_{\mathrm{s}}(\mathbf{p}(s),\boldsymbol{\omega})e^{\int_{0}^{s} \sigma_{\mathrm{t}}(\mathbf{p}(u), \boldsymbol{\omega}) du}ds.</script><p>注意到</p>
<script type="math/tex; mode=display">
T_{r}\left( \mathbf{p}_{0}\rightarrow \mathbf{p}(t)\right)=\mathrm{e}^{-\int_{0}^{t} \sigma_{\mathrm{t}}(\mathbf{p}(u), \boldsymbol{\omega}) du}</script><p>方程两边同乘 <script type="math/tex">T_{r}\left( \mathbf{p}_{0}\rightarrow \mathbf{p}(t)\right)</script>, 移项化简得</p>
<script type="math/tex; mode=display">
L_{i}(\mathbf{p}(t),-\boldsymbol{\omega})=T_{r}\left( \mathbf{p}_{0}\rightarrow \mathbf{p}(t)\right)L_{o}(\mathbf{p}_0,\boldsymbol{\omega})+\int_{0}^tL_{\mathrm{s}}(\mathbf{p}(s),\boldsymbol{\omega})\mathrm{e}^{-\int_{s}^{t} \sigma_{\mathrm{t}}(\mathbf{p}(u), \boldsymbol{\omega}) du}ds.</script><p>令 $t’=t-s$, 即 $s=t-t’$, 换元得到</p>
<script type="math/tex; mode=display">
L_{i}(\mathbf{p}(t),-\boldsymbol{\omega})=T_{r}\left( \mathbf{p}_{0}\rightarrow \mathbf{p}(t)\right)L_{o}(\mathbf{p}_0,\boldsymbol{\omega})-\int_{t}^0L_{\mathrm{s}}(\mathbf{p}(t-t'),\boldsymbol{\omega})\mathrm{e}^{-\int_{t-t'}^{t} \sigma_{\mathrm{t}}(\mathbf{p}(u), \boldsymbol{\omega}) du}dt'.</script><p>因为 $\mathbf{p}(t-t’)=\mathbf{p}_0+t\boldsymbol{\omega}-t’\boldsymbol{\omega}=\mathbf{p}(t)-t’\boldsymbol{\omega}$, 进一步化简得</p>
<script type="math/tex; mode=display">
L_{i}(\mathbf{p}(t),-\boldsymbol{\omega})=T_{r}\left( \mathbf{p}_{0}\rightarrow \mathbf{p}(t)\right)L_{o}(\mathbf{p}_0,\boldsymbol{\omega})+\int_{0}^tT_{r}\left( \mathbf{p}(t)-t'\boldsymbol{\omega}\rightarrow \mathbf{p}\right) L_{s}\left(\mathbf{p}(t)-t'\boldsymbol{\omega},\boldsymbol{\omega}\right)dt'.</script><p>方程</p>
<script type="math/tex; mode=display">
L_{i}(\mathbf{p}, -\boldsymbol{\omega})=T_{r}\left( \mathbf{p}_{0}\rightarrow \mathbf{p}\right) L_{o}\left(\mathbf{p}_{0},\boldsymbol{\omega}\right)+\int_{0}^{t} T_{r}\left( \mathbf{p}-t'\boldsymbol{\omega}\rightarrow \mathbf{p}\right) L_{s}\left(\mathbf{p}-t'\boldsymbol{\omega},\boldsymbol{\omega}\right) \mathrm{d} t'</script><p>被称作传输方程的积分方程形式. 令 $\mathbf{p}^\prime=\mathbf{p}-t’\boldsymbol{\omega}$, 则传输方程也可写作</p>
<script type="math/tex; mode=display">
L_{i}(\mathbf{p}, -\boldsymbol{\omega})=T_{r}\left( \mathbf{p}_{0}\rightarrow \mathbf{p}\right) L_{o}\left(\mathbf{p}_{0},\boldsymbol{\omega}\right)+\int_{0}^{t} T_{r}\left(\mathbf{p}^\prime\rightarrow \mathbf{p}\right) L_{s}\left(\mathbf{p}^\prime,\boldsymbol{\omega}\right) \mathrm{d} t'</script><center>
    <img style="border-radius: 0.3125em;
    box-shadow: 0 2px 4px 0 rgba(34,36,38,.12),0 2px 10px 0 rgba(34,36,38,.08);" 
    src="/img/volume_rendering/volume_rendering_2.png" width="90%">
    <br>
    <div style="color:orange;
    font-size:14px;
    display: inline-block;
    color: #999;
    padding: 10px;">图2 - 传输方程积分示意图</div>
</center>

<h1 id="Real-time-Volume-Rendering"><a href="#Real-time-Volume-Rendering" class="headerlink" title="Real-time Volume Rendering"></a>Real-time Volume Rendering</h1><h2 id="Phase-Function"><a href="#Phase-Function" class="headerlink" title="Phase Function"></a>Phase Function</h2><p>假设相函数 $p\left(\mathbf{p}^\prime, \boldsymbol{\omega}_i, \boldsymbol{\omega}\right)$ 只与 $\boldsymbol{\omega}_i, \boldsymbol{\omega}$ 之间的夹角 $\theta$ 有关, 即</p>
<script type="math/tex; mode=display">
p\left(\mathbf{p}^\prime, \boldsymbol{\omega}_i, \boldsymbol{\omega}\right)=p\left(\theta\right).</script><p>最简单的相函数为</p>
<script type="math/tex; mode=display">
p\left(\theta\right)=\frac{1}{4\pi}.</script><p>基于物理的相函数取决于粒子的相对大小 $s_p$, </p>
<script type="math/tex; mode=display">
s_{p}=\frac{2 \pi r}{\lambda},</script><p>其中 $r$ 是粒子半径, $\lambda$ 是光的波长：</p>
<ul>
<li><p>当 $s_p\ll 1$时, 存在 Rayleigh 散射；</p>
</li>
<li><p>当 $s_p\approx 1$时, 存在 Mie 散射；</p>
</li>
<li><p>当 $s_p\gg 1$ 时, 存在几何散射. </p>
</li>
</ul>
<h3 id="Rayleigh-Scattering"><a href="#Rayleigh-Scattering" class="headerlink" title="Rayleigh Scattering"></a>Rayleigh Scattering</h3><p>Rayleigh 散射的相函数为</p>
<script type="math/tex; mode=display">
p(\theta)=\frac{3}{16 \pi}\left(1+\cos ^{2} \theta\right).</script><center>
    <img style="border-radius: 0.3125em;
    box-shadow: 0 2px 4px 0 rgba(34,36,38,.12),0 2px 10px 0 rgba(34,36,38,.08);" 
    src="/img/volume_rendering/volume_rendering_3.svg" width="90%">
    <br>
    <div style="color:orange;
    font-size:14px;
    display: inline-block;
    color: #999;
    padding: 10px;">图3 - Rayleigh 散射相函数极坐标图像</div>
</center>

<p>Rayleigh 散射的散射系数与波长的四次方成反比</p>
<script type="math/tex; mode=display">
\sigma_{s}(\lambda) \propto \frac{1}{\lambda^{4}}.</script><h3 id="Mie-Scattering"><a href="#Mie-Scattering" class="headerlink" title="Mie Scattering"></a>Mie Scattering</h3><p>Mie 散射的相函数</p>
<script type="math/tex; mode=display">
p_{h g}(\theta, g)=\frac{1-g^{2}}{4 \pi\left(1+g^{2}-2 g \cos \theta\right)^{1.5}}.</script><p>称作 Henyey-Greenstein（HG）相函数, 其中参数 $g\in[-1,1]$. $g&gt;0$ 时, 发生前向散射；$g&lt;0$ 时, 发生后向散射；$g=0$ 时, 发生各向同性散射. </p>
<p>Schlick 相函数</p>
<script type="math/tex; mode=display">
p(\theta, k)=\frac{1-k^{2}}{4 \pi(1+k \cos \theta)^{2}}, \quad \text { where } \quad k \approx 1.55 g-0.55 g^{3}</script><p>是 HG 相函数的近似, 它的计算更快. </p>
<center>
    <img style="border-radius: 0.3125em;
    box-shadow: 0 2px 4px 0 rgba(34,36,38,.12),0 2px 10px 0 rgba(34,36,38,.08);" 
    src="/img/volume_rendering/volume_rendering_4.svg" width="90%">
    <br>
    <div style="color:orange;
    font-size:14px;
    display: inline-block;
    color: #999;
    padding: 10px;">图4 - HG 相函数（蓝色）与 Schlick 相函数（红色）极坐标图像. $g$ 取值分别为 0, 0.3, 0.6</div>
</center>

<h2 id="Source-Term-Estimation"><a href="#Source-Term-Estimation" class="headerlink" title="Source Term Estimation"></a>Source Term Estimation</h2><p>假设介质不存在发射现象, 散射系数只与位置有关, 即</p>
<script type="math/tex; mode=display">
\sigma_{\mathrm{s}}(\mathbf{p}^\prime,\boldsymbol{\omega}_i)=\sigma_{\mathrm{s}}(\mathbf{p}^\prime).</script><p>源项</p>
<script type="math/tex; mode=display">
L_{\mathrm{s}}(\mathbf{p}^\prime,\boldsymbol{\omega})=\sigma_{\mathrm{s}}(\mathbf{p}^\prime)\int_{\mathrm{S}^{2}} p\left( \theta\right) L_{i}\left(\mathbf{p}^\prime,\boldsymbol{\omega}_i\right) d\boldsymbol{\omega}_i</script><p>可由下式进行近似计算</p>
<script type="math/tex; mode=display">
\widehat{L}_{s}\left(\mathbf{p}^\prime,\boldsymbol{\omega}\right)=\pi\sigma_{\mathrm{s}}(\mathbf{p}^\prime)\sum_{i=1}^{N_i} p\left( \theta\right)v\left(\mathbf{p}^\prime, \mathbf{p}_{\text {light}_{i}}\right) c_{\text{light}_i}\left(\left\|\mathbf{p}^\prime-\mathbf{p}_{\text{light}_{i}}\right\|\right),</script><p>上式的</p>
<script type="math/tex; mode=display">
v\left(\mathbf{p}^\prime, \mathbf{p}_{\text {light}_{i}}\right)=\operatorname{shadowMap}\left(\mathbf{p}^\prime, \mathbf{p}_{\text {light}_{i}}\right) \cdot \operatorname{volshad}\left(\mathbf{p}^\prime, \mathbf{p}_{\text {light}_{i}}\right)</script><p>称作可视性函数（visibility function）, 其中 <script type="math/tex">\operatorname{shadowMap}\left(\mathbf{p}^\prime, \mathbf{p}_{\text {light}_{i}}\right)</script> 表示阴影贴图, </p>
<script type="math/tex; mode=display">
\operatorname{volshad}\left(\mathbf{p}^\prime, \mathbf{p}_{\text {light}_{i}}\right)=\widehat{T}_r\left(\mathbf{p}^\prime, \mathbf{p}_{\text {light}_{i}}\right)</script><p>表示体积阴影. 如果 $\sigma_t(\mathbf{p})$ 是常数 $\sigma_t$, 体积阴影的表达式为</p>
<script type="math/tex; mode=display">
\operatorname{volshad}\left(\mathbf{p}^\prime, \mathbf{p}_{\text {light}_{i}}\right)=\mathrm{e}^{-\sigma_{\mathrm{t}}N_j\Delta t},</script><p>其中 <script type="math/tex">N_j\Delta t</script> 是从 <script type="math/tex">\mathbf{p}^\prime</script> 向 <script type="math/tex">\mathbf{p}_{\text {light}_{i}}</script> 进行光线步进得到的光线在体积中行进的距离. </p>
<p>源项估计式中的 <script type="math/tex">c_{\text{light}_i}\left(\left\|\mathbf{p}^\prime-\mathbf{p}_{\text{light}_{i}}\right\|\right)</script> 是第 $i$ 个灯光的辐射率, 通常取作</p>
<script type="math/tex; mode=display">
c_{\text{light}_i}\left(\left\|\mathbf{p}^\prime-\mathbf{p}_{\text{light}_{i}}\right\|\right)=c_{\text {light}_{i,0}}\left(\frac{r_{0}}{ \left\|\mathbf{p}^\prime-\mathbf{p}_{\text{light}_{i}}\right\|}\right)^{2},</script><p>或</p>
<script type="math/tex; mode=display">
c_{\text{light}_i}\left(\left\|\mathbf{p}^\prime-\mathbf{p}_{\text{light}_{i}}\right\|\right)=c_{\text {light}_{i,0}}\left(\frac{r_{0}}{\max \left(\left\|\mathbf{p}^\prime-\mathbf{p}_{\text{light}_{i}}\right\|, r_{\min }\right)}\right)^{2},</script><p>其中 <script type="math/tex">c_{\text {light}_{i,0}}</script> 表示 <script type="math/tex">\left\|\mathbf{p}^\prime-\mathbf{p}_{\text{light}_{i}}\right\|=r_0</script> 时第 $i$ 个灯光的辐射率. </p>
<h2 id="Total-Radiance-Estimation"><a href="#Total-Radiance-Estimation" class="headerlink" title="Total Radiance Estimation"></a>Total Radiance Estimation</h2><p>假设衰减系数 $\sigma_\mathrm{t}$ 只与位置有关, 即</p>
<script type="math/tex; mode=display">
\sigma_{\mathrm{t}}(\mathbf{p}^\prime,\boldsymbol{\omega}_i)=\sigma_{\mathrm{t}}(\mathbf{p}^\prime).</script><p>当 $\mathbf{p}_1$ 和 $\mathbf{p}_2$ 距离 $\Delta t$ 较小时, 我们可以用</p>
<script type="math/tex; mode=display">
\widehat{T}_{r}\left(\mathbf{p}_1\rightarrow \mathbf{p}_2\right)=\mathrm{e}^{-\sigma_{\mathrm{t}}(\mathbf{p}_1) \Delta t}</script><p>作为</p>
<script type="math/tex; mode=display">
T_{r}\left(\mathbf{p}_1\rightarrow \mathbf{p}_2\right)=\mathrm{e}^{-\int_{0}^{\Delta t} \sigma_{\mathrm{t}}(\mathbf{p}_1-u\boldsymbol{\omega}) du}</script><p>的估计. 于是, </p>
<script type="math/tex; mode=display">
L_{i}(\mathbf{p}, -\boldsymbol{\omega})=T_{r}\left( \mathbf{p}_{0}\rightarrow \mathbf{p}\right) L_{o}\left(\mathbf{p}_{0},\boldsymbol{\omega}\right)+\int_{0}^{t} T_{r}\left(\mathbf{p}^\prime\rightarrow \mathbf{p}\right) L_{s}\left(\mathbf{p}^\prime,\boldsymbol{\omega}\right) \mathrm{d} t'</script><p>的估计式可以写作</p>
<script type="math/tex; mode=display">
\begin{aligned}
   \widehat{L}_{i}(\mathbf{p}, -\boldsymbol{\omega})&=L_{o}\left(\mathbf{p}_{0},\boldsymbol{\omega}\right)\mathrm{e}^{-S_{N_k}\Delta t}+\sum_{k=1}^{N_k}\widehat{L}_{s}\left(\mathbf{p}^\prime_k,\boldsymbol{\omega}\right)  \mathrm{e}^{-S_k \Delta t} \Delta t,
\end{aligned}</script><p>其中</p>
<script type="math/tex; mode=display">
S_J=\sum\limits_{k=1}^{J}\sigma_{\mathrm{t}}(\mathbf{p}^\prime_k),\quad \mathbf{p}^\prime_k=\mathbf{p}-(k-1)\Delta t \boldsymbol{\omega} .</script><p>如果 $\sigma_t(\mathbf{p})$ 是常数 $\sigma_t$, 我们有更精确的估计</p>
<script type="math/tex; mode=display">
\begin{aligned}
   \widehat{L}_{i}(\mathbf{p}, -\boldsymbol{\omega})&=L_{o}\left(\mathbf{p}_{0},\boldsymbol{\omega}\right)\mathrm{e}^{-S_{N_k}\Delta t}+\sum_{k=1}^{N_k}\widehat{L}_{s}\left(\mathbf{p}^\prime_k,\boldsymbol{\omega}\right)  \int_{(k-1)\Delta t}^{k\Delta t}\mathrm{e}^{-\sigma_{\mathrm{t}}t'}dt'\\
   &=L_{o}\left(\mathbf{p}_{0},\boldsymbol{\omega}\right)\mathrm{e}^{-S_{N_k}\Delta t}+\frac{1}{\sigma_{\mathrm{t}}}\sum_{k=1}^{N_k}\widehat{L}_{s}\left(\mathbf{p}^\prime_k,\boldsymbol{\omega}\right)  \mathrm{e}^{-\sigma_{\mathrm{t}}(k-1)\Delta t}(1-\mathrm{e}^{-\sigma_{\mathrm{t}}\Delta t}).
\end{aligned}</script><h2 id="Instance"><a href="#Instance" class="headerlink" title="Instance"></a>Instance</h2><p>取定常数衰减系数 $\sigma_{\mathrm{t}}$ 和各向同性相函数, 辐射率的计算公式为</p>
<script type="math/tex; mode=display">
\begin{aligned}
   &\widehat{L}_{i}(\mathbf{p}, -\boldsymbol{\omega})\\
   =\;&L_{o}\left(\mathbf{p}_{0},\boldsymbol{\omega}\right)\mathrm{e}^{-S_{N_k}\Delta t}+\frac{1}{\sigma_{\mathrm{t}}}\sum_{k=1}^{N_k}\widehat{L}_{s}\left(\mathbf{p}^\prime_k,\boldsymbol{\omega}\right)  \mathrm{e}^{-\sigma_{\mathrm{t}}(k-1)\Delta t}(1-\mathrm{e}^{-\sigma_{\mathrm{t}}\Delta t})\\
   =\;&L_{o}\left(\mathbf{p}_{0},\boldsymbol{\omega}\right)\mathrm{e}^{-S_{N_k}\Delta t}\\
   &+\frac{\rho(1-\mathrm{e}^{-\sigma_{\mathrm{t}}\Delta t})}{4}\sum_{k=1}^{N_k}\mathrm{e}^{-\sigma_{\mathrm{t}}(k-1)\Delta t}\sum_{i=1}^{N_i} \frac{c_{\text {light}_{i,0}}r_{0}^2}{ \left\|\mathbf{p}^\prime-\mathbf{p}_{\text{light}_{i}}\right\|^2}\operatorname{shadowMap}\left(\mathbf{p}^\prime_k, \mathbf{p}_{\text {light}_{i}}\right)\mathrm{e}^{-\sigma_{\mathrm{t}}N_j\Delta t}.
\end{aligned}</script><style>
  .markdown-body {
    font-family: Times New Roman, Georgia, serif;
    font-size: 18px;
  }
</style>
            </div>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                
                  <div class="post-meta">
                    <i class="iconfont icon-tags"></i>
                    
                      <a class="hover-with-bg" href="/en/tags/Computer-Graphics/">Computer Graphics</a>
                    
                      <a class="hover-with-bg" href="/en/tags/PBR/">PBR</a>
                    
                      <a class="hover-with-bg" href="/en/tags/Volume-Rendering/">Volume Rendering</a>
                    
                  </div>
                
              </div>
              
                <p class="note note-warning">Copyright Notice: All articles in this blog are licensed under <a target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" rel="nofollow noopener noopener">CC BY-SA 4.0</a> unless declaring additionally.</p>
              
              
                <div class="post-prevnext row">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/en/2021/01/29/Yoneda%20Lemma/">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">Yoneda Lemma</span>
                        <span class="visible-mobile">Previous</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/en/2020/12/04/Differentiable%20Manifold/">
                        <span class="hidden-mobile">Differentiable Manifold</span>
                        <span class="visible-mobile">Next</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
              <!-- Comments -->
              <article class="comments" id="comments">
                
                
  <div id="vcomments"></div>
  <script type="text/javascript">
    function loadValine() {
      addScript('https://cdn.staticfile.org/valine/1.4.14/Valine.min.js', function () {
        new Valine({
          el: "#vcomments",
          app_id: "vjkw64ePz7yaH6jhWSQCKRQx-gzGzoHsz",
          app_key: "FnH9uRrc0O6C9Rc00UjmDqgl",
          placeholder: "Leave some comments here ~",
          path: window.location.pathname,
          avatar: "retro",
          meta: ["nick","mail","link"],
          pageSize: "10",
          lang: "en",
          highlight: false,
          recordIP: false,
          serverURLs: "",
        });
      });
    }
    waitElementVisible('vcomments', loadValine);
  </script>
  <noscript>Please enable JavaScript to view the <a target="_blank" href="https://valine.js.org" rel="nofollow noopener noopener">comments
      powered by Valine.</a></noscript>


              </article>
            
          </article>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;TOC</p>
  <div id="tocbot"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->


    
  </main>

  
    <a id="scroll-top-button" href="#" role="button">
      <i class="iconfont icon-arrowup" aria-hidden="true"></i>
    </a>
  

  
    <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">Search</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">keyword</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
  

  

  

  <footer class="mt-5">
  <div class="text-center py-3">
    <div>
      <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a>
      <i class="iconfont icon-love"></i>
      <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener">
        <span>Fluid</span></a>
    </div>
    

    

    
  </div>
</footer>

<!-- SCRIPTS -->
<script  src="https://cdn.staticfile.org/jquery/3.4.1/jquery.min.js" ></script>
<script  src="https://cdn.staticfile.org/twitter-bootstrap/4.4.1/js/bootstrap.min.js" ></script>
<script  src="/en/js/debouncer.js" ></script>
<script  src="/en/js/main.js" ></script>

<!-- Plugins -->




  



  <script defer src="https://cdn.staticfile.org/clipboard.js/2.0.6/clipboard.min.js" ></script>
  <script  src="/en/js/clipboard-use.js" ></script>



  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>



  
<script src="/en/js/to_cn.js"></script>




  <script  src="https://cdn.staticfile.org/tocbot/4.11.1/tocbot.min.js" ></script>
  <script>
    $(document).ready(function () {
      var boardCtn = $('#board-ctn');
      var boardTop = boardCtn.offset().top;

      tocbot.init({
        tocSelector: '#tocbot',
        contentSelector: '#post-body',
        headingSelector: 'h1,h2,h3,h4,h5,h6',
        linkClass: 'tocbot-link',
        activeLinkClass: 'tocbot-active-link',
        listClass: 'tocbot-list',
        isCollapsedClass: 'tocbot-is-collapsed',
        collapsibleClass: 'tocbot-is-collapsible',
        collapseDepth: 0,
        scrollSmooth: true,
        headingsOffset: -boardTop
      });
      if ($('.toc-list-item').length > 0) {
        $('#toc').css('visibility', 'visible');
      }
    });
  </script>



  <script  src="https://cdn.staticfile.org/typed.js/2.0.11/typed.min.js" ></script>
  <script>
    var typed = new Typed('#subtitle', {
      strings: [
        '  ',
        "Volume Rendering&nbsp;",
      ],
      cursorChar: "_",
      typeSpeed: 70,
      loop: false,
    });
    typed.stop();
    $(document).ready(function () {
      $(".typed-cursor").addClass("h2");
      typed.start();
    });
  </script>



  <script  src="https://cdn.staticfile.org/anchor-js/4.2.2/anchor.min.js" ></script>
  <script>
    anchors.options = {
      placement: "right",
      visible: "hover",
      
      icon: "↩"
      
    };
    var el = "h1,h2,h3,h4,h5,h6".split(",");
    var res = [];
    for (item of el) {
      res.push(".markdown-body > " + item)
    }
    anchors.add(res.join(", "))
  </script>



  <script  src="/en/js/local-search.js" ></script>
  <script>
    var path = "/en/local-search.xml";
    var inputArea = document.querySelector("#local-search-input");
    inputArea.onclick = function () {
      searchFunc(path, 'local-search-input', 'local-search-result');
      this.onclick = null
    }
  </script>



  <script  src="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.css" />

  <script>
    $('#post img:not(.no-zoom img, img[no-zoom]), img[zoom]').each(
      function () {
        var element = document.createElement('a');
        $(element).attr('data-fancybox', 'images');
        $(element).attr('href', $(this).attr('src'));
        $(this).wrap(element);
      }
    );
  </script>





  

  
    <!-- MathJax -->
    <script>
      MathJax = {
        tex: {
          inlineMath: [['$', '$'], ['\\(', '\\)']]
        },
        options: {
          renderActions: {
            findScript: [10, doc => {
              document.querySelectorAll('script[type^="math/tex"]').forEach(node => {
                const display = !!node.type.match(/; *mode=display/);
                const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
                const text = document.createTextNode('');
                node.parentNode.replaceChild(text, node);
                math.start = { node: text, delim: '', n: 0 };
                math.end = { node: text, delim: '', n: 0 };
                doc.math.push(math);
              });
            }, '', false],
            insertedScript: [200, () => {
              document.querySelectorAll('mjx-container').forEach(node => {
                let target = node.parentNode;
                if (target.nodeName.toLowerCase() === 'li') {
                  target.parentNode.classList.add('has-jax');
                }
              });
            }, '', false]
          }
        }
      };
    </script>

    <script async src="https://cdn.staticfile.org/mathjax/3.0.5/es5/tex-svg.js" ></script>

  
















</body>
</html>
