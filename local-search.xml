<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>预计算辐射率传递</title>
    <link href="/cn/2021/04/30/Precomputed%20Radiance%20Transfer/"/>
    <url>/cn/2021/04/30/Precomputed%20Radiance%20Transfer/</url>
    
    <content type="html"><![CDATA[<h1 id="漫反射物体"><a href="#漫反射物体" class="headerlink" title="漫反射物体"></a>漫反射物体</h1><p>对于表面只存在漫反射的物体，反射方程可以写作</p><script type="math/tex; mode=display">\begin{aligned}    L_o(\boldsymbol{\omega}_o)=\frac{\mathrm{base\_color}}{\pi} \int_{H^2}L_i(\boldsymbol{\omega}_i)V(\boldsymbol{\omega}_i)\mathbf{n}\cdot\boldsymbol{\omega}_i \:d\Omega_i,\end{aligned}</script><p>其中 $V(\boldsymbol{\omega}_i)$ 为可见性函数。为简化起见，我们假设 $L_i(\boldsymbol{\omega}_i)$ 是环境光照。</p>]]></content>
    
    
    <categories>
      
      <category>计算机图形</category>
      
    </categories>
    
    
    <tags>
      
      <tag>计算机图形</tag>
      
      <tag>PBR</tag>
      
      <tag>实时渲染</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>基于图像的光照</title>
    <link href="/cn/2021/04/27/Image-Based%20Lighting/"/>
    <url>/cn/2021/04/27/Image-Based%20Lighting/</url>
    
    <content type="html"><![CDATA[<h1 id="基于图像的实时环境光照"><a href="#基于图像的实时环境光照" class="headerlink" title="基于图像的实时环境光照"></a>基于图像的实时环境光照</h1><p>基于图像的环境光照，是指用一张图片来存储来自每个方向的环境光的辐照率，并利用这张图片进行着色计算．这张图片被称作环境纹理．</p><p>原始的反射方程为</p><script type="math/tex; mode=display">L_o(\mathbf{p},\boldsymbol{\omega}_o)=\int_{H^2}f_{\mathrm{r}}\left(\mathbf{p}, \boldsymbol{\omega}_o, \boldsymbol{\omega}_i\right)L_i(\mathbf{p},\boldsymbol{\omega}_i)\cos\theta_i\:d\Omega_i.</script><p>这里我们不考虑环境光以外的其他光照，并假设环境光对于任意着色点 $\mathbf{p}$ 都是相同的，因此环境纹理可以记作 $L_i(\boldsymbol{\omega}_i)$．相应地，反射方程可以写作</p><script type="math/tex; mode=display">L_o(\mathbf{p},\boldsymbol{\omega}_o)=\int_{H^2}f_{\mathrm{r}}\left(\mathbf{p},\boldsymbol{\omega}_o, \boldsymbol{\omega}_i\right)L_i(\boldsymbol{\omega}_i)\cos\theta_i\:d\Omega_i.</script><p>在本文中，我们所需的点 $\mathbf{p}$ 处的几何信息只有法向量 $\mathbf{n}$，故上式可写作</p><script type="math/tex; mode=display">L_o(\mathbf{n},\boldsymbol{\omega}_o)=\int_{H^2}f_{\mathrm{r}}\left(\mathbf{n},\boldsymbol{\omega}_o, \boldsymbol{\omega}_i\right)L_i(\boldsymbol{\omega}_i)\cos\theta_i\:d\Omega_i.</script><h2 id="漫反射"><a href="#漫反射" class="headerlink" title="漫反射"></a>漫反射</h2><h3 id="简化-Fresnel-项"><a href="#简化-Fresnel-项" class="headerlink" title="简化 Fresnel 项"></a>简化 Fresnel 项</h3><p>如果只考虑漫反射，反射方程为</p><script type="math/tex; mode=display">\begin{aligned}    L_o(\mathbf{n},\boldsymbol{\omega}_o)&=\int_{H^2}k_{d} f_{\text {lambert}}L_i(\boldsymbol{\omega}_i)\cos\theta_i\:d\Omega_i\\    &=\frac{\mathrm{base\_color}(1-\text {metalness})}{\pi} \int_{H^2}\left(1-F\left(\mathbf{h}, \boldsymbol{\omega}_o\right)\right)L_i(\boldsymbol{\omega}_i)\mathbf{n}\cdot\boldsymbol{\omega}_i \:d\Omega_i,\end{aligned}</script><p>其中</p><script type="math/tex; mode=display">\begin{aligned}F\left(\mathbf{h}, \boldsymbol{\omega}_o\right)&=F_{0}+\left(1-F_{0}\right)(1-(\mathbf{h} \cdot \boldsymbol{\omega}_o))^{5}, \\F_{0}&=\mathrm{lerp}(0.16\:\mathrm{specular}^2, \mathrm{base\_color}, \mathrm{metalness}).\end{aligned}</script><p>在实时渲染中，一个常见的思路是对复杂的积分进行预计算．一般地，对任意的 $\mathbf{n}$ 和 <script type="math/tex">\boldsymbol{\omega}_o</script>，我们希望得到相应的 $L_o(\mathbf{n},\boldsymbol{\omega}_o)$．一方面，$\boldsymbol{\omega}_o$ 可能的取值有无穷多个。另一方面，如果考虑物体的旋转，$\mathbf{n}$ 的取值也有无穷多个。为所有的 $\mathbf{n}$ 和 $\boldsymbol{\omega}_o$ 预计算出对应的 <script type="math/tex">L_o(\mathbf{n},\boldsymbol{\omega}_o)</script> 显然是不可能的．最朴素的想法是对有限个 $\mathbf{n}$ 和 $\boldsymbol{\omega}_o$ 进行预计算，然后对结果进行插值。但是，这要求我们制作一张 4D 的 LUT（lookup table，查找表），因而会耗费大量的空间和时间．更加经济的做法，是通过简化反射方程中需要预计算的被积函数</p><script type="math/tex; mode=display">\left(1-F\left(\mathbf{h}, \boldsymbol{\omega}_o\right)\right)L_i(\boldsymbol{\omega}_i)\mathbf{n}\cdot\boldsymbol{\omega}_i,</script><p>让包含 $\boldsymbol{\omega}_o$ 的被积项能够提到积分号之外．这样，我们只需为有限个 $\mathbf{n}$ 预计算复杂的积分，并将结果存入一张 2D 的 LUT。关于 $\boldsymbol{\omega}_o$ 的计算，则可以实时去进行。</p><p>注意到在被积函数中，只有 Fresnel 项 <script type="math/tex">F\left(\mathbf{h}, \boldsymbol{\omega}_o\right)</script> 包含 $\boldsymbol{\omega}_o$．因为 $\mathbf{h}$ 包含 $\boldsymbol{\omega}_i$，该项并不能直接提到积分之外。我们可以用简化版的 Fresnel 项 <script type="math/tex">F^*\left(\mathbf{n},\boldsymbol{\omega}_o\right)</script> 代替原本的 <script type="math/tex">F\left(\mathbf{h}, \boldsymbol{\omega}_o\right)</script>，其表达式如下</p><script type="math/tex; mode=display">\begin{aligned}F^*\left(\mathbf{n},\boldsymbol{\omega}_o\right) &=F_{0}+\left(S-F_{0}\right)\left(1-\mathbf{n}\cdot \boldsymbol{\omega}_o\right)^{5},\\S &=\max \left\{1-\text { roughness }, F_{0}\right\}.\end{aligned}</script><p>于是，反射方程简化为</p><script type="math/tex; mode=display">\begin{aligned}    L_o(\mathbf{n},\boldsymbol{\omega}_o)    \approx\frac{\mathrm{base\_color}(1-\text {metalness})\left(1-F^*\left(\mathbf{n},\boldsymbol{\omega}_o\right)\right)}{\pi} \int_{H^2}L_i(\boldsymbol{\omega}_i)\mathbf{n}\cdot\boldsymbol{\omega}_i \:d\Omega_i.\end{aligned}</script><p>之后，我们只需为有限个 $\mathbf{n}$ 预计算如下积分</p><script type="math/tex; mode=display">I_{\mathrm{diff}}\left(\mathbf{n}\right)=\int_{H^2}L_i(\boldsymbol{\omega}_i)\mathbf{n}\cdot\boldsymbol{\omega}_i \:d\Omega_i.</script><p>注意到该积分表示的是法线为 $\mathbf{n}$ 的着色点接受到的环境光辐照度，因此也被称作辐照度贴图（irradiance map）。</p><p>如果环境纹理是一张立方盒贴图，它的每一个纹素都会对应一个方向向量。我们可以让 $\mathbf{n}$ 取遍所有这些方向向量，并将 $I_{\mathrm{diff}}\left(\mathbf{n}\right)$ 的值存入对应的纹素。渲染时，$L_o(\mathbf{n},\boldsymbol{\omega}_o)$ 由下式进行计算</p><script type="math/tex; mode=display">L^*_o(\mathbf{n},\boldsymbol{\omega}_o)=\frac{\mathrm{base\_color}(1-\text {metalness})\left(1-F^*\left(\mathbf{n},\boldsymbol{\omega}_o\right)\right)}{\pi}I_{\mathrm{diff}}\left(\mathbf{n}\right).</script><h3 id="辐照度贴图的预计算"><a href="#辐照度贴图的预计算" class="headerlink" title="辐照度贴图的预计算"></a>辐照度贴图的预计算</h3><p>我们可以用 Monte Carlo 积分法计算 <script type="math/tex">I_{\mathrm{diff}}\left(\mathbf{n}\right)</script>．给定 $\mathbf{n}$，设 $\eta_{\mathbf{n}}$ 是半球 $H^2$ 上的一个概率分布，其概率密度函数为</p><script type="math/tex; mode=display">pdf_{\mathbf{n}}(\boldsymbol{\omega}_i) =\frac{\mathbf{n}\cdot\boldsymbol{\omega}_i}{\pi}.</script><p>我们利用 <script type="math/tex">\eta_{\mathbf{n}}</script> 进行重要性采样，由此得到 $I_{\mathrm{diff}}\left(\mathbf{n}\right)$ 的统计量</p><script type="math/tex; mode=display">\widehat{I}_{\mathrm{diff}}\left(\mathbf{n}\right)=\frac{\pi}{N}\sum_{k=1}^NL_i(\boldsymbol{\omega}_i^{(k)}),\quad \boldsymbol{\omega}_i^{(k)}\sim\eta_{\mathbf{n}},</script><p>其中 $N$ 为采样数．下面我们将具体描述如何为 <script type="math/tex">\eta_{\mathbf{n}}</script> 生成样本。我们会提供两种方案：坐标变换法和四元数旋转法。</p><p><strong>坐标变换法</strong>：</p><p>设</p><script type="math/tex; mode=display">\mathbf{u}=\begin{cases}       (0,0,1) &\mathrm{if}\; \mathbf{n}\ne(0,0,\pm1), \\      (1,0,0) & \mathrm{if}\; \mathbf{n}=(0,0,\pm1).   \end{cases}</script><p>切空间的基向量在世界空间下的矩阵 $T_{\mathbf{n}}$可以表示成</p><script type="math/tex; mode=display">T_{\mathbf{n}}=\left(\mathbf{t},\mathbf{b},\mathbf{n}\right),</script><p>其中</p><script type="math/tex; mode=display">\begin{aligned}\mathbf{t}&=\frac{\mathbf{u}\times\mathbf{n}}{\Vert\mathbf{u}\times\mathbf{n}\Vert},\\\mathbf{b}&=\mathbf{n}\times\mathbf{t}.\end{aligned}</script><p>设 <script type="math/tex">\xi_{1}^{(k)}, \xi_{2}^{(k)}</script> 独立且服从均匀分布 $U(0,1)$，则</p><script type="math/tex; mode=display">T_{\mathbf{n}}\boldsymbol{\omega}_i^{(k)}=T_{\mathbf{n}}\begin{bmatrix}    \sqrt{\xi_{1}} \cos \left(2 \pi \xi_{2}\right)\\    \sqrt{\xi_{1}} \sin \left(2 \pi \xi_{2}\right)\\    \sqrt{1-\xi_{1}}\end{bmatrix}</script><p>服从分布 $\eta_{\mathbf{n}}$．</p><p><strong>四元数旋转法</strong>：</p><ul><li><p>当 $\mathbf{n}=(0,0,1)$ 时，我们可以使用逆变换采样。设 <script type="math/tex">\xi_{1}^{(k)}, \xi_{2}^{(k)}</script> 独立且服从均匀分布 $U(0,1)$，则</p><script type="math/tex; mode=display">\boldsymbol{\omega}_i^{(k)}=\left(\sqrt{\xi_{1}} \cos \left(2 \pi \xi_{2}\right), \sqrt{\xi_{1}} \sin \left(2 \pi \xi_{2}\right), \sqrt{1-\xi_{1}}\right)</script><p>服从分布 $\eta_{(0,0,1)}$．</p></li><li><p>当 $\mathbf{n}=(0,0,-1)$ 时，<script type="math/tex">-\boldsymbol{\omega}_i^{(k)}</script> 服从分布 $\eta_{(0,0,-1)}$．</p></li><li><p>当 $\mathbf{n}=(n_x,n_y,n_z)\ne(0,0,\pm 1)$ 时，将向量 $(0,0,1)$ 沿旋转轴</p><script type="math/tex; mode=display">(0,0,1)\times\mathbf{n}=(-n_y,n_x,0)</script><p>旋转成向量 $\mathbf{n}$ 的四元数为</p><script type="math/tex; mode=display">q_\mathbf{n} = \cos\frac{\alpha}{2}+\sin\frac{\alpha}{2}\left(-\frac{n_y}{\sqrt{n_x^2+n_y^2}}i+\frac{n_x}{\sqrt{n_x^2+n_y^2}}j\right),</script><p>其中 $\alpha$ 是旋转角．因为</p><script type="math/tex; mode=display">\cos\alpha=(0,0,1)\cdot \mathbf{n}=n_z.</script><p>我们有</p><script type="math/tex; mode=display">\begin{aligned}  q_\mathbf{n}&=\sqrt{\frac{1+\cos\alpha}{2}}+\sqrt{\frac{1-\cos\alpha}{2}}\left(-\frac{n_y}{\sqrt{n_x^2+n_y^2}}i+\frac{n_x}{\sqrt{n_x^2+n_y^2}}j\right)\\  &=\sqrt{\frac{1+n_z}{2}}+\sqrt{\frac{1-n_z}{2}}\left(-\frac{n_y}{\sqrt{n_x^2+n_y^2}}i+\frac{n_x}{\sqrt{n_x^2+n_y^2}}j\right).\end{aligned}</script><p>由此可以计算出四元数旋转变换 $\mathrm{rot}_q:p\mapsto qpq^{-1}$ 对应的旋转矩阵</p><script type="math/tex; mode=display">R_\mathbf{n}=\begin{pmatrix}  \tfrac{n_x^2n_z+n_y^2}{n_x^2+n_y^2}&-n_xn_y(1+n_z)&n_x\\  -n_xn_y(1+n_z)&\tfrac{n_x^2+n_y^2n_z}{n_x^2+n_y^2}&n_y\\  -n_x&-n_y&n_z\end{pmatrix}.</script><p>不难看出，<script type="math/tex">R_\mathbf{n}\boldsymbol{\omega}_i^{(k)}</script> 服从分布 $\eta_{\mathbf{n}}$．</p></li></ul><h2 id="镜面反射"><a href="#镜面反射" class="headerlink" title="镜面反射"></a>镜面反射</h2><p>下面我们只考虑镜面反射，反射方程为</p><script type="math/tex; mode=display">\begin{aligned}    L_o(\mathbf{n},\boldsymbol{\omega}_o)&=\int_{H^2}f_s(\mathbf{n},\boldsymbol{\omega}_i, \boldsymbol{\omega}_o)L_i(\boldsymbol{\omega}_i)\cos\theta_i\:d\Omega_i\\    &=\int_{H^2}\dfrac{F\left(\mathbf{h}, \boldsymbol{\omega}_o\right) G(\mathbf{n},\boldsymbol{\omega}_i, \boldsymbol{\omega}_o) D(\mathbf{n},\mathbf{h})}{4(\mathbf{n} \cdot \boldsymbol{\omega}_o)(\mathbf{n} \cdot \boldsymbol{\omega}_i)}L_i(\boldsymbol{\omega}_i)\mathbf{n}\cdot\boldsymbol{\omega}_i \:d\Omega_i.\end{aligned}</script><p>为化简方程，我们可以将 $L_i(\boldsymbol{\omega}_i)$ 提出积分号外。于是，我们将 $L_o(\mathbf{n},\boldsymbol{\omega}_o)$ 写成如下形式</p><script type="math/tex; mode=display">\begin{aligned}L_o(\mathbf{n},\boldsymbol{\omega}_o)&=\int_{H^2}f_s(\mathbf{n},\boldsymbol{\omega}_i, \boldsymbol{\omega}_o) L_{i}(\boldsymbol{\omega}_i)(\mathbf{n} \cdot \boldsymbol{\omega}_i) d\Omega_i \\&=\frac{\int_{H^2}f_s(\mathbf{n},\boldsymbol{\omega}_i, \boldsymbol{\omega}_o) L_{i}(\boldsymbol{\omega}_i)(\mathbf{n} \cdot \boldsymbol{\omega}_i) d\Omega_i}{\int_{H^2}f_s(\mathbf{n},\boldsymbol{\omega}_i, \boldsymbol{\omega}_o)\mathbf{n} \cdot \boldsymbol{\omega}_i d\Omega_i}\int_{H^2} f_s(\mathbf{n},\boldsymbol{\omega}_i, \boldsymbol{\omega}_o)\mathbf{n} \cdot \boldsymbol{\omega}_i d\Omega_i,\end{aligned}</script><p>希望对含 $L_i(\boldsymbol{\omega}_i)$ 和不含 $L_i(\boldsymbol{\omega}_i)$ 的两部分分别进行计算。</p><h3 id="分裂和-第-1-部分"><a href="#分裂和-第-1-部分" class="headerlink" title="分裂和 - 第 1 部分"></a>分裂和 - 第 1 部分</h3><h4 id="公式推导"><a href="#公式推导" class="headerlink" title="公式推导"></a>公式推导</h4><p>直接计算</p><script type="math/tex; mode=display">\frac{\int_{H^2}f_s(\mathbf{n},\boldsymbol{\omega}_i, \boldsymbol{\omega}_o) L_{i}(\boldsymbol{\omega}_i)(\mathbf{n} \cdot \boldsymbol{\omega}_i) d\Omega_i}{\int_{H^2}f_s(\mathbf{n},\boldsymbol{\omega}_i, \boldsymbol{\omega}_o)\mathbf{n} \cdot \boldsymbol{\omega}_i d\Omega_i}</script><p>是比较复杂的。为了降低预计算的参数空间维度。这里的假设是： lobe 的形状保持不变，始终为光线沿法线入射时的 lobe，即在计算积分时，让 $\boldsymbol{\omega}_o, \mathbf{n}$ 的取值与 $\boldsymbol{\omega}_o$ 的反射向量 $\mathbf{r}(\boldsymbol{\omega}_o)=2(\boldsymbol{\omega}_o\cdot\mathbf{n})\mathbf{n}-\boldsymbol{\omega}_o$ 值相等。或者说，用 $\mathbf{r}(\boldsymbol{\omega}_o)$ 代替被积函数中的 $\boldsymbol{\omega}_o$ 和 $\mathbf{n}$. 记 $\mathbf{n}^*=\mathbf{r}(\boldsymbol{\omega}_o)$，</p><script type="math/tex; mode=display">\begin{aligned}    &\;f^*_s\left(\boldsymbol{\omega}_i, \boldsymbol{\omega}_o\right)\\    =&\;f_s\left(\mathbf{n}^*,\boldsymbol{\omega}_i, \mathbf{n}^*\right)\\    =&\;\dfrac{F\left(\mathbf{h}, \boldsymbol{\omega}_o\right)}{4(\mathbf{n}^* \cdot \boldsymbol{\omega}_o)(\mathbf{n}^* \cdot \boldsymbol{\omega}_i)} G(\mathbf{n}^*,\boldsymbol{\omega}_i, \boldsymbol{\omega}_o) D(\mathbf{n}^*,\mathbf{h})\\    =&\;\dfrac{F_{0}+\left(1-F_{0}\right)(1-( \mathbf{n}^*\cdot\mathbf{h} ))^{5}}{4(\mathbf{n}^* \cdot \boldsymbol{\omega}_i)}\frac{2(\mathbf{n}^* \cdot \boldsymbol{\omega}_i)}{(\mathbf{n}^* \cdot \boldsymbol{\omega}_i)(2-\alpha)+\alpha}D(\mathbf{n}^*,\mathbf{h})\\    =&\;\dfrac{F_{0}+\left(1-F_{0}\right)(1-( \mathbf{n}^*\cdot\mathbf{h} ))^{5}}{2(\mathbf{n}^* \cdot \boldsymbol{\omega}_i)(2-\alpha)+2\alpha}D(\mathbf{n}^*,\mathbf{h})\;\\    =&\;C(\boldsymbol{\omega}_i,\mathbf{n}^*)D(\mathbf{n}^*,\mathbf{h}),\end{aligned}</script><p>其中 </p><script type="math/tex; mode=display">\mathbf{h}=\frac{\boldsymbol{\omega}_i+\mathbf{n}^*}{\Vert\boldsymbol{\omega}_i+\mathbf{n}^*\Vert},</script><p>$C(\boldsymbol{\omega}_i,\mathbf{n}^*)$ 定义为</p><script type="math/tex; mode=display">C(\boldsymbol{\omega}_i,\mathbf{n}^*)=\dfrac{F_{0}+\left(1-F_{0}\right)(1-( \mathbf{n}^*\cdot\mathbf{h} ))^{5}}{2(\mathbf{n}^* \cdot \boldsymbol{\omega}_i)(2-\alpha)+2\alpha}.</script><p>因为</p><script type="math/tex; mode=display">\int_{H^2_{\mathbf{n}^*}}D(\mathbf{n}^*,\mathbf{h})\cos\theta_{\mathbf{h}} \:d\Omega_{\mathbf{h}}=1,</script><p>其中 $\cos\theta_{\mathbf{h}}=\mathbf{n}^* \cdot \mathbf{h}$，可用蒙特卡洛积分法对</p><script type="math/tex; mode=display">pdf(\mathbf{h})=D(\mathbf{n}^*,\mathbf{h})\cos\theta_{\mathbf{h}}=\dfrac{\alpha^{2}\cos\theta_{\mathbf{h}}}{\pi\left(\left(\alpha^{2}-1\right)\cos^2\theta_{\mathbf{h}}+1\right)^{2}}</script><p>进行重要性采样。注意到</p><script type="math/tex; mode=display">4 \cos \theta_{\mathbf{h}}d\Omega_\mathbf{h}=d\Omega_i,</script><p>我们有</p><script type="math/tex; mode=display">\begin{aligned}&\hspace{1.35em}\frac{\int_{H^2}f_s(\mathbf{n},\boldsymbol{\omega}_i, \boldsymbol{\omega}_o) L_{i}(\boldsymbol{\omega}_i)(\mathbf{n} \cdot \boldsymbol{\omega}_i) d\Omega_i}{\int_{H^2}f_s(\mathbf{n},\boldsymbol{\omega}_i, \boldsymbol{\omega}_o)\mathbf{n}^* \cdot \boldsymbol{\omega}_i d\Omega_i}\\&=\frac{\int_{H^2}f_s(\mathbf{n},\boldsymbol{\omega}_i, \boldsymbol{\omega}_o) L_{i}(\boldsymbol{\omega}_i)(\mathbf{n}\cdot \boldsymbol{\omega}_i) 4 \cos \theta_{\mathbf{h}}d\Omega_{\mathbf{h}}}{\int_{H^2}f_s(\mathbf{n},\boldsymbol{\omega}_i, \boldsymbol{\omega}_o)\mathbf{n}\cdot \boldsymbol{\omega}_i 4 \cos \theta_{\mathbf{h}}d\Omega_{\mathbf{h}}}\\&\approx\frac{\sum_{k=1}^Nf_s^*(\boldsymbol{\omega}_i^{(k)}, \boldsymbol{\omega}_o) L_{i}(\boldsymbol{\omega}_i^{(k)})(\mathbf{n}^* \cdot \boldsymbol{\omega}_i^{(k)}) 4 \cos \theta_{\mathbf{h}^{(k)}}/pdf(\mathbf{h}^{(k)})}{\sum_{k=1}^Nf_s^*(\boldsymbol{\omega}_i^{(k)}, \boldsymbol{\omega}_o)\mathbf{n}^* \cdot \boldsymbol{\omega}_i^{(k)} 4 \cos \theta_{\mathbf{h}^{(k)}}/pdf(\mathbf{h}^{(k)})}\\&=\frac{\sum_{k=1}^NC(\boldsymbol{\omega}_i^{(k)},\mathbf{n}^*)L_{i}(\boldsymbol{\omega}_i^{(k)})\mathbf{n}^* \cdot \boldsymbol{\omega}_i^{(k)}}{\sum_{k=1}^NC(\boldsymbol{\omega}_i^{(k)},\mathbf{n}^*)\mathbf{n}^* \cdot \boldsymbol{\omega}_i^{(k)}},\\\end{aligned}</script><p>其中 </p><script type="math/tex; mode=display">\mathbf{n}^* \cdot \boldsymbol{\omega}_i^{(k)}=2\cos^2\theta_{\mathbf{h}^{(k)}}-1=2(\mathbf{n}^* \cdot\mathbf{h}^{(k)})^2-1,</script><p>而 $\mathbf{h}^{(k)}$ 是半球 $H^2_{\mathbf{n}^*}$ 上的随机变量，服从概率密度函数为</p><script type="math/tex; mode=display">pdf(\mathbf{h})=\dfrac{\alpha^{2}\cos\theta_{\mathbf{h}}}{\pi\left(\left(\alpha^{2}-1\right)\cos^2\theta_{\mathbf{h}}+1\right)^{2}}</script><p>的概率分布。</p><h4 id="采样方案"><a href="#采样方案" class="headerlink" title="采样方案"></a>采样方案</h4><p>为应用逆变换采样法，先将 $\mathbf{h}^{(k)}$ 在 $\mathbf{n}^*$ 处的切空间上参数化为球坐标 <script type="math/tex">(\theta_{\mathbf{h}^{(k)}},\varphi_{\mathbf{h}^{(k)}})\in[0,\pi/2]\times[0,2\pi]</script>。设 <script type="math/tex">\xi_{1}^{(k)}, \xi_{2}^{(k)}</script> 独立且服从均匀分布 $U(0,1)$。由</p><script type="math/tex; mode=display">cdf_{\theta,\varphi}\left(\theta_{\mathbf{h}^{(k)}},\varphi_{\mathbf{h}^{(k)}}\right)=\int_{0}^{\varphi_{\mathbf{h}^{(k)}}} \mathrm{d} \varphi_{\mathbf{h}} \int_{0}^{\theta_{\mathbf{h}^{(k)}}} \frac{\alpha^{2} \cos \theta_{\mathbf{h}}  \sin \theta_{\mathbf{h}} }{\pi\left(\left(\alpha^{2}-1\right) \cos ^{2} \theta_{\mathbf{h}} +1\right)^{2}} d\theta_{\mathbf{h}}</script><p>可知 <script type="math/tex">\theta_{\mathbf{h}^{(k)}},\varphi_{\mathbf{h}^{(k)}}</script> 是独立的。于是，我们可以分别求出 <script type="math/tex">\theta_{\mathbf{h}^{(k)}},\varphi_{\mathbf{h}^{(k)}}</script> 的边缘分布</p><script type="math/tex; mode=display">\begin{aligned}cdf_{\theta}\left(\theta_{\mathbf{h}^{(k)}}\right)&=cdf_{\theta,\varphi}\left(\theta_{\mathbf{h}^{(k)}},2\pi\right)\\&=\int_{0}^{2\pi} \mathrm{d} \varphi_{\mathbf{h}} \int_{0}^{\theta_{\mathbf{h}^{(k)}}} \frac{\alpha^{2} \cos \theta_{\mathbf{h}}  \sin \theta_{\mathbf{h}} }{\pi\left(\left(\alpha^{2}-1\right) \cos ^{2} \theta_{\mathbf{h}} +1\right)^{2}} d\theta_{\mathbf{h}}\\&=\int_{0}^{\theta_{\mathbf{h}^{(k)}}} \frac{2\alpha^{2} \cos \theta_{\mathbf{h}}  \sin \theta_{\mathbf{h}} }{\left(\left(\alpha^{2}-1\right) \cos ^{2} \theta_{\mathbf{h}} +1\right)^{2}} d\theta_{\mathbf{h}}\\&=\left.\frac{\alpha^{2}}{\alpha^{2}-1} \frac{1}{\left(\alpha^{2}-1\right) \cos^2\theta_{\mathbf{h}}+1}\right|_{0} ^{\theta_{\mathbf{h}^{(k)}}}\\&=\frac{\alpha^{2}}{\alpha^{2}-1} \frac{1}{\left(\alpha^{2}-1\right)\cos^2\theta_{\mathbf{h}^{(k)}}+1}-\frac{1}{\alpha^{2}-1} \\&=\frac{1}{\alpha^{2}-1} \frac{\alpha^2-1-\left(\alpha^{2}-1\right)\cos^2\theta_{\mathbf{h}^{(k)}}}{\left(\alpha^{2}-1\right)\cos^2\theta_{\mathbf{h}^{(k)}}+1} \\&= \frac{1-\cos^2\theta_{\mathbf{h}^{(k)}}}{\left(\alpha^{2}-1\right)\cos^2\theta_{\mathbf{h}^{(k)}}+1}, \\\end{aligned}</script><script type="math/tex; mode=display">\begin{aligned}cdf_{\varphi}\left(\varphi_{\mathbf{h}^{(k)}}\right)&=cdf_{\theta,\varphi}\left(\frac{\pi}{2},\varphi_{\mathbf{h}^{(k)}}\right)\\&=\int_{0}^{\varphi_{\mathbf{h}^{(k)}}} \mathrm{d} \varphi_{\mathbf{h}} \int_{0}^{\frac{\pi}{2}} \frac{\alpha^{2} \cos \theta_{\mathbf{h}}  \sin \theta_{\mathbf{h}} }{\pi\left(\left(\alpha^{2}-1\right) \cos ^{2} \theta_{\mathbf{h}} +1\right)^{2}} d\theta_{\mathbf{h}}\\&=\frac{1}{2\pi}\varphi_{\mathbf{h}^{(k)}}.\end{aligned}</script><p>使用 cdf 的逆变换，就可得到球坐标下 $\mathbf{h}^{(k)}$ 的采样方案</p><script type="math/tex; mode=display">\begin{aligned}\theta_{\mathbf{h}^{(k)}}&=\arccos\sqrt{\frac{1-\xi_{1}^{(k)}}{1-(1-\alpha^2)\xi_{1}^{(k)}}},\\\varphi_{\mathbf{h}^{(k)}}&=2\pi\xi_{2}^{(k)}.\end{aligned}</script><p>由此可推出球坐标下 $\boldsymbol{\omega}_i^{(k)}$ 的采样方案</p><script type="math/tex; mode=display">\begin{aligned}\theta_{i}^{(k)}&=\arccos\frac{1-(1+\alpha^2)\xi_{1}^{(k)}}{1-(1-\alpha^2)\xi_{1}^{(k)}},\\\varphi_{i}^{(k)}&=2\pi\xi_{2}^{(k)}.\end{aligned}</script><p>因为上式的球坐标是在切空间中生成的，我们需要先将它们转换到笛卡尔坐标系下，再用坐标变换法转成成世界空间下的坐标。沿用之前定义的 $T_{\mathbf{n}}$，世界空间下 $\boldsymbol{\omega}_i^{(k)}$ 的采样方案可以写作</p><script type="math/tex; mode=display">\boldsymbol{\omega}_i^{(k)}=T_{\mathbf{n}}\begin{bmatrix}    \sin\theta_{i}^{(k)}\cos\varphi_{i}^{(k)}\\\\    \sin\theta_{i}^{(k)}\sin\varphi_{i}^{(k)}\\\\    \cos\theta_{i}^{(k)}\end{bmatrix}=T_{\mathbf{n}}\begin{bmatrix}    \dfrac{2\alpha\cos2\pi\xi_{2}^{(k)}\sqrt{\xi_{1}^{(k)}\left(1-\xi_{1}^{(k)}\right)}}{1-(1-\alpha^2)\xi_{1}^{(k)}}\\    \\    \dfrac{2\alpha\sin2\pi\xi_{2}^{(k)}\sqrt{\xi_{1}^{(k)}\left(1-\xi_{1}^{(k)}\right)}}{1-(1-\alpha^2)\xi_{1}^{(k)}}\\    \\    \dfrac{1-(1+\alpha^2)\xi_{1}^{(k)}}{1-(1-\alpha^2)\xi_{1}^{(k)}}\end{bmatrix}.</script><p>最终，我们可以导出第一部分分裂积分的估计量</p><script type="math/tex; mode=display">S(\mathbf{n}^*,\alpha)=\frac{\sum_{k=1}^NC(\boldsymbol{\omega}_i^{(k)},\mathbf{n}^*)L_{i}(\boldsymbol{\omega}_i^{(k)})\mathbf{n}^* \cdot \boldsymbol{\omega}_i^{(k)}}{\sum_{k=1}^NC(\boldsymbol{\omega}_i^{(k)},\mathbf{n}^*)\mathbf{n}^*\cdot \boldsymbol{\omega}_i^{(k)}},</script><p>其中</p><script type="math/tex; mode=display">\begin{aligned}    \mathbf{n}^*&=2(\boldsymbol{\omega}_o\cdot\mathbf{n})\mathbf{n}-\boldsymbol{\omega}_o,\\C(\boldsymbol{\omega}_i^{(k)},\mathbf{n}^*)&=\dfrac{F_{0}+\left(1-F_{0}\right)(1-( \mathbf{n}^*\cdot\mathbf{h} ))^{5}}{2(\mathbf{n}^* \cdot \boldsymbol{\omega}_i^{(k)})(2-\alpha)+2\alpha}.\end{aligned}</script><p>我们可以为某些 $\alpha$ 预计算 <script type="math/tex">S(\mathbf{n}^{*},\alpha)</script>，像 Mipmap 一样生成多张立方盒贴图。对于其它的 $\alpha$，$S(\mathbf{n}^*,\alpha)$ 的值可由三线性插值得到。在渲染时，第一部分分裂积分可估算为</p><script type="math/tex; mode=display">\frac{\int_{H^2}f_s(\mathbf{n},\boldsymbol{\omega}_i, \boldsymbol{\omega}_o) L_{i}(\boldsymbol{\omega}_i)(\mathbf{n}^* \cdot \boldsymbol{\omega}_i) d\Omega_i}{\int_{H^2}f_s(\mathbf{n},\boldsymbol{\omega}_i, \boldsymbol{\omega}_o)\mathbf{n}^* \cdot \boldsymbol{\omega}_i d\Omega_i}\approx S(\mathbf{r}(\boldsymbol{\omega}_o),\alpha)=S(2(\boldsymbol{\omega}_o\cdot\mathbf{n})\mathbf{n}-\boldsymbol{\omega}_o,\alpha).</script><h3 id="分裂和-第-2-部分"><a href="#分裂和-第-2-部分" class="headerlink" title="分裂和 - 第 2 部分"></a>分裂和 - 第 2 部分</h3><h4 id="公式推导-1"><a href="#公式推导-1" class="headerlink" title="公式推导"></a>公式推导</h4><p>分裂积分的右边可以化简为</p><script type="math/tex; mode=display">\begin{aligned}    &\; \int_{H^2} f_s(\mathbf{n},\boldsymbol{\omega}_i, \boldsymbol{\omega}_o)\mathbf{n} \cdot \boldsymbol{\omega}_i d\Omega_i\\    =&\;\int_{H^2}\left(F_{0}+\left(1-F_{0}\right)(1-( \mathbf{n}\cdot\mathbf{h} ))^{5}\right) \frac{f_s(\mathbf{n},\boldsymbol{\omega}_i, \boldsymbol{\omega}_o)}{F\left(\mathbf{h}, \boldsymbol{\omega}_o\right)}\mathbf{n} \cdot \boldsymbol{\omega}_i d\Omega_i\\    =&\; F_{0}\int_{H^2} \frac{f_s(\mathbf{n},\boldsymbol{\omega}_i, \boldsymbol{\omega}_o)}{F\left(\mathbf{h}, \boldsymbol{\omega}_o\right)}\mathbf{n} \cdot \boldsymbol{\omega}_i \left(1-(1-( \mathbf{n}\cdot\mathbf{h} ))^{5}\right)d\Omega_i\\&+\int_{H^2} \frac{f_s(\mathbf{n},\boldsymbol{\omega}_i, \boldsymbol{\omega}_o)}{F\left(\mathbf{h}, \boldsymbol{\omega}_o\right)}\mathbf{n} \cdot \boldsymbol{\omega}_i(1-( \mathbf{n}\cdot\mathbf{h} ))^{5} d\Omega_i.\end{aligned}</script><p>重要性采样</p><script type="math/tex; mode=display">\begin{aligned}A &\approx \frac{1}{N} \sum_{k=1}^{N} \frac{\frac{D\left(\boldsymbol{\omega}_{h}^{(k)}\right) G\left(\boldsymbol{\omega}_{o}, \boldsymbol{\omega}_{i}^{(k)}\right)}{4\left(\boldsymbol{\omega}_{o} \cdot \mathbf{n}\right)\left(\boldsymbol{\omega}_{i}^{(k)} \cdot \mathbf{n}\right)}\left(1-\left(1-\boldsymbol{\omega}_{o} \cdot \boldsymbol{\omega}_{h}^{(k)}\right)^{5}\right)\left(\boldsymbol{\omega}_{i}^{(k)} \cdot \mathbf{n}\right)}{\mathrm{pdf}\left(\boldsymbol{\omega}_{i}^{(k)}\right)}\\&=\frac{1}{N} \sum_{k=1}^{N} \frac{G\left(\boldsymbol{\omega}_{o}, \boldsymbol{\omega}_{i}^{(k)}\right)\left(\boldsymbol{\omega}_{o} \cdot \boldsymbol{\omega}_{h}^{(k)}\right)\left(1-\left(1-\boldsymbol{\omega}_{o} \cdot \boldsymbol{\omega}_{h}^{(k)}\right)^{5}\right)}{\left(\boldsymbol{\omega}_{o} \cdot \mathbf{n}\right)\left(\boldsymbol{\omega}_{h}^{(k)} \cdot \mathbf{n}\right)},\end{aligned}</script><script type="math/tex; mode=display">B \approx \frac{1}{N} \sum_{k=1}^{N} \frac{G\left(\boldsymbol{\omega}_{o}, \boldsymbol{\omega}_{i}^{(k)}\right)\left(\boldsymbol{\omega}_{o} \cdot \boldsymbol{\omega}_{h}^{(k)}\right)\left(1-\boldsymbol{\omega}_{o} \cdot \boldsymbol{\omega}_{h}^{(k)}\right)^{5}}{\left(\boldsymbol{\omega}_{o} \cdot \mathbf{n}\right)\left(\boldsymbol{\omega}_{h}^{(k)} \cdot \mathbf{n}\right)}.</script>]]></content>
    
    
    <categories>
      
      <category>计算机图形</category>
      
    </categories>
    
    
    <tags>
      
      <tag>计算机图形</tag>
      
      <tag>PBR</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Yoneda引理</title>
    <link href="/cn/2021/01/29/Yoneda%20Lemma/"/>
    <url>/cn/2021/01/29/Yoneda%20Lemma/</url>
    
    <content type="html"><![CDATA[<p>Yoneda 引理是范畴论中一个颇具哲学色彩的定理．Dan Piponi 称它为“数学中最难的平凡之物”，Emily Riehl 则直言“可以说是范畴论中最重要的结果”．在 <a href="https://ncatlab.org/nlab/show/HomePage">nLab</a> 上，它被认为是“基本的，但是深刻且核心的”．本文尝试用清晰明了、符合动机、图文并茂的方式叙述并证明 Yoneda 引理，同时介绍它的重要推论 Yoneda 嵌入和可表函子．</p><h1 id="预层范畴"><a href="#预层范畴" class="headerlink" title="预层范畴"></a>预层范畴</h1><p>给定两个范畴 $\mathsf{C}_1,\mathsf{C}_2$，我们可以定义函子范畴 $\mathrm{Fct}(\mathsf{C}_1,\mathsf{C}_2)$，其对象为 $\mathsf{C}_1$ 到 $\mathsf{C}_2$ 的函子，态射为函子间的自然变换．函子范畴 $\mathrm{Fct}(\mathsf{C}_1,\mathsf{C}_2)$ 也可记作 $[\mathsf{C}_1,\mathsf{C}_2]$．设 $F,G\in[\mathsf{C}_1,\mathsf{C}_2]$，$F,G$ 之间的态射集可记作</p><script type="math/tex; mode=display">\mathrm{Nat}(F,G):=\mathrm{Hom}_{[\mathsf{C}_1,\mathsf{C}_2]}(F,G).</script><p>给定范畴 $\mathsf{C}$，其上的 <strong>预层范畴</strong> 定义为</p><script type="math/tex; mode=display">\mathsf{C}^{\wedge}:=[\mathsf{C}^{\mathrm{op}},\mathsf{Set}].</script><p>预层范畴中的一个对象称为一个 <strong>预层</strong>，它是 $\mathsf{C}^{\mathrm{op}}$ 到 $\mathsf{Set}$ 的一个函子．</p><h1 id="mathrm-Hom-函子"><a href="#mathrm-Hom-函子" class="headerlink" title="$\mathrm{Hom}$ 函子"></a>$\mathrm{Hom}$ 函子</h1><h2 id="mathrm-Hom-mathsf-C-函子"><a href="#mathrm-Hom-mathsf-C-函子" class="headerlink" title="$\mathrm{Hom}_{\mathsf{C}}(-,-)$ 函子"></a>$\mathrm{Hom}_{\mathsf{C}}(-,-)$ 函子</h2><p>设 $\mathsf{C}$ 是一个范畴，它到集合范畴 $\mathsf{Set}$ 的二元函子</p><script type="math/tex; mode=display">\mathrm{Hom}_{\mathsf{C}}(-,-): \mathsf{C}^{\mathrm{op}} \times \mathsf{C} \rightarrow \mathsf{Set}.</script><p>定义如下：其对象映射为</p><script type="math/tex; mode=display">\begin{aligned}    \mathrm{Hom}_{\mathsf{C}}(-,-):\mathrm{Ob}(\mathsf{C})&\longrightarrow \mathrm{Ob}(\mathsf{Set})\\    (X,Y)&\longmapsto \mathrm{Hom}_{\mathsf{C}}(X,Y),\end{aligned}</script><p>态射映射为</p><script type="math/tex; mode=display">\begin{aligned}    \mathrm{Hom}_{\mathsf{C}}(-,-):\mathrm{Hom}_{\mathsf{C}}((X_1,Y_1),(X_2,Y_2))&\longrightarrow \mathrm{Hom}_{\mathsf{Set}}(\mathrm{Hom}_{\mathsf{C}}(X_1,Y_1),\mathrm{Hom}_{\mathsf{C}}(X_2,Y_2))\\    (f^{\mathrm{op}}:X_1\to X_2,\,g:Y_1\to Y_2)& \longmapsto g_*f^*:(\phi:X_1\to Y_1 \longmapsto g\phi f:X_2\to Y_2),\end{aligned}</script><p>用图表可以表示为</p><center>    <img style="border-radius: 0.3125em;    box-shadow: 0 2px 4px 0 rgba(34,36,38,.12),0 2px 10px 0 rgba(34,36,38,.08);"     src="/img/yoneda_lemma/f1.svg" width="50%">    <br></center><h2 id="mathrm-Hom-mathsf-C-X-函子"><a href="#mathrm-Hom-mathsf-C-X-函子" class="headerlink" title="$\mathrm{Hom}_{\mathsf{C}}(X,-)$ 函子"></a>$\mathrm{Hom}_{\mathsf{C}}(X,-)$ 函子</h2><p>对于 <script type="math/tex">\mathrm{Hom}_{\mathsf{C}}(-,-)</script> 函子，将第一个分量固定为 $X\in \mathrm{Ob}(\mathsf{C})$，就得到 $\mathrm{Hom}_{\mathsf{C}}(X,-)$ 函子</p><script type="math/tex; mode=display">\mathrm{Hom}_{\mathsf{C}}(X,-): \mathsf{C} \rightarrow \mathsf{Set}.</script><p>其对象映射为</p><script type="math/tex; mode=display">\begin{aligned}    \mathrm{Hom}_{\mathsf{C}}(X,-):\mathrm{Ob}(\mathsf{C})&\longrightarrow \mathrm{Ob}(\mathsf{Set})\\    Y&\longmapsto \mathrm{Hom}_{\mathsf{C}}(X,Y),\end{aligned}</script><p>态射映射为</p><script type="math/tex; mode=display">\begin{aligned}    \mathrm{Hom}_{\mathsf{C}}(X,-):\mathrm{Hom}_{\mathsf{C}}(Y_2,Y_1)&\longrightarrow \mathrm{Hom}_{\mathsf{Set}}(\mathrm{Hom}_{\mathsf{C}}(X,Y_1),\mathrm{Hom}_{\mathsf{C}}(X,Y_2))\\    (g:Y_1\to Y_2)& \longmapsto g_*:(\phi:X\to Y_1 \longmapsto g\phi:X\to Y_2),\end{aligned}</script><p>用图表可以表示为</p><center>    <img style="border-radius: 0.3125em;    box-shadow: 0 2px 4px 0 rgba(34,36,38,.12),0 2px 10px 0 rgba(34,36,38,.08);"     src="/img/yoneda_lemma/f5.svg" width="50%">    <br>    <br></center><p>映射 $g_*$ 常被称作推出．</p><h2 id="mathrm-Hom-mathsf-C-Y-函子"><a href="#mathrm-Hom-mathsf-C-Y-函子" class="headerlink" title="$\mathrm{Hom}_{\mathsf{C}}(-,Y)$ 函子"></a>$\mathrm{Hom}_{\mathsf{C}}(-,Y)$ 函子</h2><p>对于 <script type="math/tex">\mathrm{Hom}_{\mathsf{C}}(-,-)</script> 函子，将第二个分量固定为 $Y\in \mathrm{Ob}(\mathsf{C})$，就得到 $\mathrm{Hom}_{\mathsf{C}}(-,Y)$ 函子</p><script type="math/tex; mode=display">\mathrm{Hom}_{\mathsf{C}}(-,Y): \mathsf{C}^{\mathrm{op}}  \rightarrow \mathsf{Set}.</script><p>其对象映射为</p><script type="math/tex; mode=display">\begin{aligned}    \mathrm{Hom}_{\mathsf{C}}(-,Y):\mathrm{Ob}(\mathsf{C})&\longrightarrow \mathrm{Ob}(\mathsf{Set})\\    X&\longmapsto \mathrm{Hom}_{\mathsf{C}}(X,Y),\end{aligned}</script><p>态射映射为</p><script type="math/tex; mode=display">\begin{aligned}    \mathrm{Hom}_{\mathsf{C}}(-,Y):\mathrm{Hom}_{\mathsf{C}}(X_1,X_2)&\longrightarrow \mathrm{Hom}_{\mathsf{Set}}(\mathrm{Hom}_{\mathsf{C}}(X_1,Y),\mathrm{Hom}_{\mathsf{C}}(X_2,Y))\\    (f^{\mathrm{op}}:X_1\to X_2)& \longmapsto f^*:(\phi:X_1\to Y \longmapsto \phi f:X_2\to Y),\end{aligned}</script><p>用图表可以表示为</p><center>    <img style="border-radius: 0.3125em;    box-shadow: 0 2px 4px 0 rgba(34,36,38,.12),0 2px 10px 0 rgba(34,36,38,.08);"     src="/img/yoneda_lemma/f2.svg" width="50%">    <br>    <br></center><p>映射 $f^*$ 常被称作拉回．</p><h2 id="mathrm-Hom-mathsf-C-cdot-函子"><a href="#mathrm-Hom-mathsf-C-cdot-函子" class="headerlink" title="$\mathrm{Hom}_{\mathsf{C}}(\cdot\,,-)$ 函子"></a>$\mathrm{Hom}_{\mathsf{C}}(\cdot\,,-)$ 函子</h2><p>可以看出，<script type="math/tex">\mathrm{Hom}_{\mathsf{C}}(-,Y)</script> 函子是 $\mathsf{C}$ 上的一个预层，即 <script type="math/tex">\mathrm{Hom}_{\mathsf{C}}(-,Y)\in [\mathsf{C}^{\mathrm{op}},\mathsf{Set}]</script>．而且每给定一个 $\mathsf{C}$ 中的对象 $Y$，就能得到一个对应的预层 <script type="math/tex">\mathrm{Hom}_{\mathsf{C}}(-,Y)\in [\mathsf{C}^{\mathrm{op}},\mathsf{Set}]</script>．事实上，这种映射关系可以拓展为 $\mathsf{C}$ 到预层范畴 $[\mathsf{C}^{\mathrm{op}},\mathsf{Set}]$ 的一个函子 </p><script type="math/tex; mode=display">\mathrm{Hom}_{\mathsf{C}}(\cdot\,,-):\mathsf{C}\longrightarrow [\mathsf{C}^{\mathrm{op}},\mathsf{Set}].</script><p>其对象映射为</p><script type="math/tex; mode=display">\begin{aligned}    \mathrm{Hom}_{\mathsf{C}}(\cdot\,,-):\mathrm{Ob}(\mathsf{C})&\longrightarrow\mathrm{Ob}([\mathsf{C}^{\mathrm{op}},\mathsf{Set}])\\    Y& \longmapsto \mathrm{Hom}_{\mathsf{C}}(-,Y),\end{aligned}</script><p>态射映射为</p><script type="math/tex; mode=display">\begin{aligned}    \mathrm{Hom}_{\mathsf{C}}(\cdot\,,-):\mathrm{Hom}_{\mathsf{C}}(Y_1,Y_2)&\longrightarrow\mathrm{Hom}_{\mathsf{C}^\wedge}(\mathrm{Hom}_{\mathsf{C}}(-,Y_1),\mathrm{Hom}_{\mathsf{C}}(-,Y_2))\\    g& \longmapsto \theta_{g_*},\end{aligned}</script><p>用图表可以表示为</p><center>    <img style="border-radius: 0.3125em;    box-shadow: 0 2px 4px 0 rgba(34,36,38,.12),0 2px 10px 0 rgba(34,36,38,.08);"     src="/img/yoneda_lemma/f4.svg" width="50%">    <br>    <br></center><p>其中 <script type="math/tex">\theta_{g_*}</script> 是 <script type="math/tex">\mathrm{Hom}_{\mathsf{C}}(-,Y_1)</script> 到 <script type="math/tex">\mathrm{Hom}_{\mathsf{C}}(-,Y_2)</script> 的自然变换，定义为</p><script type="math/tex; mode=display">\begin{aligned}    \theta_{g_*}:\mathrm{Ob}(\mathsf{C})&\longrightarrow \mathrm{Mor}(\mathsf{Set})\\    X&\longmapsto g_*\in \mathrm{Hom}_{\mathsf{Set}}(\mathrm{Hom}_{\mathsf{C}}(X,Y_1),\mathrm{Hom}_{\mathsf{C}}(X,Y_2)).\\\end{aligned}</script><p>而 <script type="math/tex">\theta_{g_*}</script> 的自然性由如下交换图保证</p><center>    <img style="border-radius: 0.3125em;    box-shadow: 0 2px 4px 0 rgba(34,36,38,.12),0 2px 10px 0 rgba(34,36,38,.08);"     src="/img/yoneda_lemma/f3.svg" width="60%">    <br></center><h1 id="Yoneda引理"><a href="#Yoneda引理" class="headerlink" title="Yoneda引理"></a>Yoneda引理</h1><h2 id="Yoneda引理：同构的证明"><a href="#Yoneda引理：同构的证明" class="headerlink" title="Yoneda引理：同构的证明"></a>Yoneda引理：同构的证明</h2><h3 id="命题"><a href="#命题" class="headerlink" title="命题"></a>命题</h3><p>设 <script type="math/tex">\mathsf{C}</script> 是一个范畴，$Y$ 是 <script type="math/tex">\mathsf{C}</script> 中一个对象，<script type="math/tex">\mathrm{Hom}_{\mathsf{C}}(-,Y)</script> 就是 <script type="math/tex">\mathsf{C}</script> 上的一个预层．又设 <script type="math/tex">F\in \mathsf{C}^\wedge</script> 也是 <script type="math/tex">\mathsf{C}</script> 上的预层．一方面，</p><script type="math/tex; mode=display">\mathrm{Nat}(\mathrm{Hom}_{\mathsf{C}}(-,Y),F)</script><p>是 <script type="math/tex">\mathrm{Hom}_{\mathsf{C}}(-,Y)</script> 与 $F$ 这两个预层之间的自然变换构成的集合．另一方面，</p><script type="math/tex; mode=display">F(Y)</script><p>是预层 $F$ 在 $Y$ 处的取值，它也是一个集合．Yoneda引理断言，这两个集合之间存在一个双射，即</p><script type="math/tex; mode=display">\mathrm{Nat}(\mathrm{Hom}_{\mathsf{C}}(-,Y),F)\cong F(Y).</script><h3 id="证明"><a href="#证明" class="headerlink" title="证明"></a>证明</h3><p>如果 $\phi\in\mathrm{Nat}(\mathrm{Hom}_{\mathsf{C}}(-,Y),F)$，我们可以在 $\mathsf{C}$ 中任取一个从 $X$ 到 $Y$ 的态射</p><script type="math/tex; mode=display">X \xrightarrow{f} Y,</script><p>利用 $\phi$ 的自然性得到如下交换图</p><center>    <img style="border-radius: 0.3125em;    box-shadow: 0 2px 4px 0 rgba(34,36,38,.12),0 2px 10px 0 rgba(34,36,38,.08);"     src="/img/yoneda_lemma/f6.svg" width="90%">    <br>    <br></center><p>从交换图可以导出如下关系式</p><script type="math/tex; mode=display">\phi_X(f)=F(f)(\phi_Y(\mathrm{id}_Y))</script><p>注意到 $X$ 和 $f$ 的选取是任意的，我们知道 $\phi$ 由 $\phi_Y$ 在 $\mathrm{id}_Y$ 上的像 $\phi_Y(\mathrm{id}_Y)$ 唯一确定．</p><p>于是，定义映射</p><script type="math/tex; mode=display">\begin{aligned}    \mathcal{A}:\mathrm{Nat}(\mathrm{Hom}_{\mathsf{C}}(-,Y),F)&\longrightarrow F(Y),\\    \phi&\longmapsto \phi_Y(\mathrm{id}_Y).\end{aligned}</script><p>和</p><script type="math/tex; mode=display">\begin{aligned}    \mathcal{B}:F(Y)&\longrightarrow \mathrm{Nat}(\mathrm{Hom}_{\mathsf{C}}(-,Y),F),\\    u&\longmapsto \phi:\phi_X(f)=F(f)(u),\forall X\in\mathrm{Ob}(\mathsf{C}),f\in\mathrm{Hom}_\mathsf{C}(X,Y) .\end{aligned}</script><p>可以验证，$\mathcal{B}$ 是良定义的．事实上，任取 $\mathsf{C}$ 中态射</p><script type="math/tex; mode=display">X_1 \xrightarrow{h} X_2,</script><p>我们有如下交换图</p><center>    <img style="border-radius: 0.3125em;    box-shadow: 0 2px 4px 0 rgba(34,36,38,.12),0 2px 10px 0 rgba(34,36,38,.08);"     src="/img/yoneda_lemma/f7.svg" width="90%">    <br>    <br></center><p>所以 $\mathcal{B}(u)$ 确实是 $\mathrm{Hom}_{\mathsf{C}}(-,Y)$ 到 $F$ 的自然变换．</p><p>因为对任意 <script type="math/tex">\phi\in\mathrm{Nat}(\mathrm{Hom}_{\mathsf{C}}(-,Y),F)</script>，</p><script type="math/tex; mode=display">(\mathcal{B}(\mathcal{A}(\phi)))_Y(\mathrm{id}_Y)=(\mathcal{B}(\phi_Y(\mathrm{id}_Y)))_Y(\mathrm{id}_Y)=F(\mathrm{id}_Y)(\phi_Y(\mathrm{id}_Y))=\mathrm{id}_{F(Y)}(\phi_Y(\mathrm{id}_Y))=\phi_Y(\mathrm{id}_Y),</script><p>由前面的结论可知</p><script type="math/tex; mode=display">\mathcal{B}(\mathcal{A}(\phi))=\phi,</script><p>故</p><script type="math/tex; mode=display">\mathcal{B}\circ\mathcal{A}=\mathrm{id}_{\mathrm{Nat}(\mathrm{Hom}_{\mathsf{C}}(-,Y),F)}.</script><p>因为对任意 <script type="math/tex">u\in F(Y)</script>，</p><script type="math/tex; mode=display">\mathcal{A}(\mathcal{B}(u))=F(\mathrm{id}_Y)(u)=\mathrm{id}_{F(Y)}(u)=u,</script><p>所以</p><script type="math/tex; mode=display">\mathcal{A}\circ\mathcal{B}=\mathrm{id}_{F(Y)}.</script><p>综上所述，我们证明了</p><script type="math/tex; mode=display">\begin{aligned}    \mathcal{A}:\mathrm{Nat}(\mathrm{Hom}_{\mathsf{C}}(-,Y),F)&\longrightarrow F(Y),\\    \phi&\longmapsto \phi_Y(\mathrm{id}_Y).\end{aligned}</script><p>是一个双射．</p><h2 id="Yoneda引理：自然同构的证明"><a href="#Yoneda引理：自然同构的证明" class="headerlink" title="Yoneda引理：自然同构的证明"></a>Yoneda引理：自然同构的证明</h2><p>Yoneda引理不仅指出了映射 $\mathcal{A}$ 给出以下同构</p><script type="math/tex; mode=display">\mathrm{Nat}(\mathrm{Hom}_{\mathsf{C}}(-,Y),F)\cong F(Y),</script><p>还进一步断言该同构关于 $Y$ 和 $F$ 是自然的．</p><p>具体来说，我们可以定义二元函子</p><script type="math/tex; mode=display">\begin{aligned}    \mathrm{Nat}(\mathrm{Hom}_{\mathsf{C}}(\cdot,-),-):\mathsf{C}^{\mathrm{op}}\times \mathsf{C}^\wedge&\longrightarrow\mathsf{Set}\end{aligned}</script><p>其对象映射为</p><script type="math/tex; mode=display">\begin{aligned}    \mathrm{Nat}(\mathrm{Hom}_{\mathsf{C}}(\cdot,-),-):\mathrm{Ob}(\mathsf{C}^{\mathrm{op}}\times \mathsf{C}^\wedge)&\longrightarrow\mathrm{Ob}(\mathsf{Set}),\\    (Y,F)&\longmapsto \mathrm{Nat}(\mathrm{Hom}_{\mathsf{C}}(-,Y),F),\end{aligned}</script><p>态射映射为</p><script type="math/tex; mode=display">\mathrm{Nat}(\mathrm{Hom}_{\mathsf{C}}(\cdot,-),-):(g^{\mathrm{op}},\eta)\longmapsto s</script><p>用图表可以表示为</p><center>    <img style="border-radius: 0.3125em;    box-shadow: 0 2px 4px 0 rgba(34,36,38,.12),0 2px 10px 0 rgba(34,36,38,.08);"     src="/img/yoneda_lemma/f8.svg" width="72%">    <br>    <br></center><p>其中 $s$ 的定义为</p><script type="math/tex; mode=display">\begin{aligned}    s:\mathrm{Nat}(\mathrm{Hom}_{\mathsf{C}}(-,Y_1),F_1)&\longrightarrow\mathrm{Nat}(\mathrm{Hom}_{\mathsf{C}}(-,Y_2),F_2)),\\    \phi&\longmapsto \widetilde{\phi}:\widetilde{\phi}_X(f)=\eta_X(\phi_X(gf)),\forall X\in\mathrm{Ob}(\mathsf{C}),f\in\mathrm{Hom}_\mathsf{C}(X,Y_2).\end{aligned}</script><p>同样，我们可以定义二元求值函子</p><script type="math/tex; mode=display">\begin{aligned}    \mathrm{ev}^\wedge:\mathsf{C}^{\mathrm{op}}\times \mathsf{C}^\wedge&\longrightarrow\mathsf{Set},\\    (Y,F)&\longmapsto F(Y),\end{aligned}</script><p>用图表可以表示为</p><center>    <img style="border-radius: 0.3125em;    box-shadow: 0 2px 4px 0 rgba(34,36,38,.12),0 2px 10px 0 rgba(34,36,38,.08);"     src="/img/yoneda_lemma/f9.svg" width="42%">    <br>    <br></center><p>其中 </p><script type="math/tex; mode=display">v:=F_2(g)\circ\eta_{Y_1}=\eta_{Y_2}\circ F_1(g).</script><p>因为</p><script type="math/tex; mode=display">\begin{aligned}    \mathcal{A}_{Y_2,F_2}(s(\phi))=&\;    \mathcal{A}_{Y_2,F_2}(\widetilde{\phi})\\    =&\;\widetilde{\phi}_{Y_2}(\mathrm{id}_{Y_2})\\    =&\;\eta_{Y_2}(\phi_{Y_2}(g\;\mathrm{id}_{Y_2}))\\    =&\;\eta_{Y_2}(\phi_{Y_2}(g))\\    =&\;\eta_{Y_2}(F_1(g)(\phi_{Y_1}(\mathrm{id}_{Y_1})))\\    =&\;v(\phi_{Y_1}(\mathrm{id}_{Y_1}))\\    =&\;v(\mathcal{A}_{Y_2,F_2}(\phi))\end{aligned}</script><p>所以下图交换</p><center>    <img style="border-radius: 0.3125em;    box-shadow: 0 2px 4px 0 rgba(34,36,38,.12),0 2px 10px 0 rgba(34,36,38,.08);"     src="/img/yoneda_lemma/f10.svg" width="74%">    <br>    <br></center><p>因此，映射 $\mathcal{A}$ 是从函子 $\mathrm{Nat}(\mathrm{Hom}_{\mathsf{C}}(\cdot,-),-)$ 到函子 $\mathrm{ev}^\wedge$ 的自然同构．</p><h2 id="Yoneda嵌入"><a href="#Yoneda嵌入" class="headerlink" title="Yoneda嵌入"></a>Yoneda嵌入</h2><p>Yoneda 引理可以导出一个有用的推论．</p><div class="note note-primary">            <p><strong>推论</strong>．<script type="math/tex">\mathrm{Hom}_{\mathsf{C}}(\cdot\,,-)</script> 是一个全忠实函子．</p>          </div><p><strong>证明</strong>．在 Yoneda 引理中取 <script type="math/tex">Y=Y_1</script>, <script type="math/tex">F=\mathrm{Hom}_{\mathsf{C}}(-,Y_2)</script> 就得到</p><script type="math/tex; mode=display">\mathrm{Nat}(\mathrm{Hom}_{\mathsf{C}}(-,Y_1),\mathrm{Hom}_{\mathsf{C}}(-,Y_2))\cong \mathrm{Hom}_{\mathsf{C}}(Y_1,Y_2),</script><p>即</p><script type="math/tex; mode=display">\mathrm{Hom}_{\mathsf{C}}(Y_1,Y_2)\cong\mathrm{Hom}_{\mathsf{C}^\wedge}(\mathrm{Hom}_{\mathsf{C}}(-,Y_1),\mathrm{Hom}_{\mathsf{C}}(-,Y_2)).</script><p>此时，映射 $\mathcal{B}$ 可化为</p><script type="math/tex; mode=display">\begin{aligned}    \mathcal{B}:\mathrm{Hom}_{\mathsf{C}}(Y_1,Y_2)&\longrightarrow \mathrm{Hom}_{\mathsf{C}^\wedge}(\mathrm{Hom}_{\mathsf{C}}(-,Y_1),\mathrm{Hom}_{\mathsf{C}}(-,Y_2))\\    g&\longmapsto \phi:\phi_X(f)=f^*g=g_*f,\forall X\in\mathrm{Ob}(\mathsf{C}),f\in\mathrm{Hom}_\mathsf{C}(X,Y) .\end{aligned}</script><p>即</p><script type="math/tex; mode=display">\begin{aligned}    \mathcal{B}:\mathrm{Hom}_{\mathsf{C}}(Y_1,Y_2)&\longrightarrow \mathrm{Hom}_{\mathsf{C}^\wedge}(\mathrm{Hom}_{\mathsf{C}}(-,Y_1),\mathrm{Hom}_{\mathsf{C}}(-,Y_2))\\    g&\longmapsto \phi:\phi_X=g_*,\forall X\in\mathrm{Ob}(\mathsf{C}),\end{aligned}</script><p>这正是函子</p><script type="math/tex; mode=display">\mathrm{Hom}_{\mathsf{C}}(\cdot\,,-):\mathsf{C}\longrightarrow [\mathsf{C}^{\mathrm{op}},\mathsf{Set}]</script><p>的态射映射．因为 <script type="math/tex">\mathcal{B}</script> 是双射，所以 <script type="math/tex">\mathrm{Hom}_{\mathsf{C}}(\cdot\,,-)</script> 是一个全忠实函子．$\square$</p><p>注意到 <script type="math/tex">\mathrm{Hom}_{\mathsf{C}}(\cdot\,,-)</script> 的对象映射是一个单射，函子 <script type="math/tex">\mathrm{Hom}_{\mathsf{C}}(\cdot\,,-)</script> 将 $\mathsf{C}$ 作为一个全子范畴嵌入到 $\mathsf{C}$ 的预层范畴 $[\mathsf{C}^{\mathrm{op}},\mathsf{Set}]$ 中．这个嵌入被称作 <strong>Yoneda 嵌入</strong>．由全忠实函子的性质可知，</p><script type="math/tex; mode=display">Y_1\cong Y_2\iff \mathrm{Hom}_{\mathsf{C}}(-,Y_1)\cong\mathrm{Hom}_{\mathsf{C}}(-,Y_2).</script><p>从范畴同构的意义上来讲，我们可以将 $Y$ 与 $\mathrm{Hom}_{\mathsf{C}}(-,Y)$ 等同．范畴中的某个对象，就等于指向该对象所有箭头的总和．换言之，在范畴同构的思想下，我们关心的信息就是一个对象自己和其它对象和会给该对象打上哪些箭头，对象内部则完全被视为一个黑箱．而范畴中对象之间的箭头，就等于指向对象的箭头集之间的转换．具体来说，假如 $f$ 是对象 $A$ 到对象 $B$ 的一个箭头，那么任何打到 $A$ 上的箭头，都可以通过接上一个 $f$，转换成打到 $B$ 上的箭头．反过来，如果有一种方式能将所有打到 $A$ 上的箭头自然地转换成打到 $B$ 上的箭头，那么这种转换必然是通过接上一个 $A, B$ 间的箭头来实现的． </p><h1 id="可表函子"><a href="#可表函子" class="headerlink" title="可表函子"></a>可表函子</h1><p>范畴 $\mathsf{C}$ 上的一个预层 $F:\mathsf{C}^{\mathrm{op}}\to\mathsf{Set}$ 被称作 <strong>可表函子</strong>，如果存在 $\mathsf{C}$ 中的一个对象 $Z$，使得 $\mathrm{Hom}_{\mathsf{C}}(-,Z)$ 与 $F$ 自然同构．对象 $A$ 与自然同构</p><script type="math/tex; mode=display">\phi:\mathrm{Hom}_{\mathsf{C}}(-,Z)\longrightarrow F</script><p>构成的二元组 $(Z,\phi)$，称作 $F$ 的一个 <strong>表示</strong>．</p><p>根据 Yoneda 引理，$\phi$ 由 $F(Z)$ 中的一个元素 $c:=\phi_Z(\mathrm{id}_Z)\in F(Z)$ 唯一确定．基于这个原因，$(Z,c)$ 被称作 $F$ 的一个代表元，其中的 $Z$ 被称作 $F$ 的 <strong>表示对象</strong>（representing object）或 <strong>泛对象</strong>（universal object），而 $c$ 被称作 $F$ 的 <strong>泛元</strong>（universal element）．</p><p>关于可表函子，我们有如下命题．</p><div class="note note-primary">            <p><strong>命题</strong>．如果函子 $F$ 是可表的，那么它的表示在同构意义下是唯一的．</p>          </div><p>更具体地说，考虑函子</p><mjx-container class="MathJax" jax="SVG" display="true"><svg style="vertical-align: -1.415ex" xmlns="http://www.w3.org/2000/svg" width="22.171ex" height="3.962ex" role="img" focusable="false" viewBox="0 -1125.6 9799.6 1751.1" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="MJX-3-TEX-SS-1D5A2" d="M59 347Q59 440 100 521T218 654T392 705Q473 705 550 680Q577 670 577 667Q576 666 572 642T564 595T559 571Q515 601 479 613T392 626Q300 626 232 549T164 347Q164 231 229 150T397 68Q453 68 489 80T568 120L581 129L582 110Q584 91 585 71T587 46Q580 40 566 31T502 5T396 -11Q296 -11 218 41T99 174T59 347Z"></path><path id="MJX-3-TEX-S4-2192" d="M56 237T56 250T70 270H835Q719 357 692 493Q692 494 692 496T691 499Q691 511 708 511H711Q720 511 723 510T729 506T732 497T735 481T743 456Q765 389 816 336T935 261Q944 258 944 250Q944 244 939 241T915 231T877 212Q836 186 806 152T761 85T740 35T732 4Q730 -6 727 -8T711 -11Q691 -11 691 0Q691 7 696 25Q728 151 835 230H70Q56 237 56 250Z"></path><path id="MJX-3-TEX-S4-2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"></path><path id="MJX-3-TEX-N-48" d="M128 622Q121 629 117 631T101 634T58 637H25V683H36Q57 680 180 680Q315 680 324 683H335V637H302Q262 636 251 634T233 622L232 500V378H517V622Q510 629 506 631T490 634T447 637H414V683H425Q446 680 569 680Q704 680 713 683H724V637H691Q651 636 640 634T622 622V61Q628 51 639 49T691 46H724V0H713Q692 3 569 3Q434 3 425 0H414V46H447Q489 47 498 49T517 61V332H232V197L233 61Q239 51 250 49T302 46H335V0H324Q303 3 180 3Q45 3 36 0H25V46H58Q100 47 109 49T128 61V622Z"></path><path id="MJX-3-TEX-N-6F" d="M28 214Q28 309 93 378T250 448Q340 448 405 380T471 215Q471 120 407 55T250 -10Q153 -10 91 57T28 214ZM250 30Q372 30 372 193V225V250Q372 272 371 288T364 326T348 362T317 390T268 410Q263 411 252 411Q222 411 195 399Q152 377 139 338T126 246V226Q126 130 145 91Q177 30 250 30Z"></path><path id="MJX-3-TEX-N-6D" d="M41 46H55Q94 46 102 60V68Q102 77 102 91T102 122T103 161T103 203Q103 234 103 269T102 328V351Q99 370 88 376T43 385H25V408Q25 431 27 431L37 432Q47 433 65 434T102 436Q119 437 138 438T167 441T178 442H181V402Q181 364 182 364T187 369T199 384T218 402T247 421T285 437Q305 442 336 442Q351 442 364 440T387 434T406 426T421 417T432 406T441 395T448 384T452 374T455 366L457 361L460 365Q463 369 466 373T475 384T488 397T503 410T523 422T546 432T572 439T603 442Q729 442 740 329Q741 322 741 190V104Q741 66 743 59T754 49Q775 46 803 46H819V0H811L788 1Q764 2 737 2T699 3Q596 3 587 0H579V46H595Q656 46 656 62Q657 64 657 200Q656 335 655 343Q649 371 635 385T611 402T585 404Q540 404 506 370Q479 343 472 315T464 232V168V108Q464 78 465 68T468 55T477 49Q498 46 526 46H542V0H534L510 1Q487 2 460 2T422 3Q319 3 310 0H302V46H318Q379 46 379 62Q380 64 380 200Q379 335 378 343Q372 371 358 385T334 402T308 404Q263 404 229 370Q202 343 195 315T187 232V168V108Q187 78 188 68T191 55T200 49Q221 46 249 46H265V0H257L234 1Q210 2 183 2T145 3Q42 3 33 0H25V46H41Z"></path><path id="MJX-3-TEX-N-28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path><path id="MJX-3-TEX-N-22C5" d="M78 250Q78 274 95 292T138 310Q162 310 180 294T199 251Q199 226 182 208T139 190T96 207T78 250Z"></path><path id="MJX-3-TEX-N-2C" d="M78 35T78 60T94 103T137 121Q165 121 187 96T210 8Q210 -27 201 -60T180 -117T154 -158T130 -185T117 -194Q113 -194 104 -185T95 -172Q95 -168 106 -156T131 -126T157 -76T173 -3V9L172 8Q170 7 167 6T161 3T152 1T140 0Q113 0 96 17Z"></path><path id="MJX-3-TEX-N-2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"></path><path id="MJX-3-TEX-N-29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path><path id="MJX-3-TEX-N-2227" d="M318 591Q325 598 333 598Q344 598 348 591Q349 590 414 445T545 151T611 -4Q609 -22 591 -22Q588 -22 586 -21T581 -20T577 -17T575 -13T572 -9T570 -4L333 528L96 -4Q87 -20 80 -21Q78 -22 75 -22Q57 -22 55 -4Q55 2 120 150T251 444T318 591Z"></path><path id="MJX-3-TEX-S4-2190" d="M944 261T944 250T929 230H165Q167 228 182 216T211 189T244 152T277 96T303 25Q308 7 308 0Q308 -11 288 -11Q281 -11 278 -11T272 -7T267 2T263 21Q245 94 195 151T73 236Q58 242 55 247Q55 254 59 257T73 264Q121 283 158 314T215 375T247 434T264 480L267 497Q269 503 270 505T275 509T288 511Q308 511 308 500Q308 493 303 475Q293 438 278 406T246 352T215 315T185 287T165 270H929Q944 261 944 250Z"></path><path id="MJX-3-TEX-I-1D457" d="M297 596Q297 627 318 644T361 661Q378 661 389 651T403 623Q403 595 384 576T340 557Q322 557 310 567T297 596ZM288 376Q288 405 262 405Q240 405 220 393T185 362T161 325T144 293L137 279Q135 278 121 278H107Q101 284 101 286T105 299Q126 348 164 391T252 441Q253 441 260 441T272 442Q296 441 316 432Q341 418 354 401T367 348V332L318 133Q267 -67 264 -75Q246 -125 194 -164T75 -204Q25 -204 7 -183T-12 -137Q-12 -110 7 -91T53 -71Q70 -71 82 -81T95 -112Q95 -148 63 -167Q69 -168 77 -168Q111 -168 139 -140T182 -74L193 -32Q204 11 219 72T251 197T278 308T289 365Q289 372 288 376Z"></path><path id="MJX-3-TEX-I-1D44D" d="M58 8Q58 23 64 35Q64 36 329 334T596 635L586 637Q575 637 512 637H500H476Q442 637 420 635T365 624T311 598T266 548T228 469Q227 466 226 463T224 458T223 453T222 450L221 448Q218 443 202 443Q185 443 182 453L214 561Q228 606 241 651Q249 679 253 681Q256 683 487 683H718Q723 678 723 675Q723 673 717 649Q189 54 188 52L185 49H274Q369 50 377 51Q452 60 500 100T579 247Q587 272 590 277T603 282H607Q628 282 628 271Q547 5 541 2Q538 0 300 0H124Q58 0 58 8Z"></path><path id="MJX-3-TEX-SS-1D7E3" d="M94 612Q172 616 211 632T284 678H307V73H430V0H88V73H213V317Q213 560 212 560Q210 558 197 554T155 546T96 540L83 539V612H94Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mtable"><g data-mml-node="mtr" transform="translate(0, -375.6)"><g data-mml-node="mtd"><g data-mml-node="TeXAtom" data-mjx-texclass="ORD"><g data-mml-node="mi"><use xlink:href="#MJX-3-TEX-SS-1D5A2"></use></g></g><g data-mml-node="mpadded" transform="translate(639, 0)"></g></g><g data-mml-node="mtd" transform="translate(1139, 0)"><g data-mml-node="mover"><g data-mml-node="mo"><use xlink:href="#MJX-3-TEX-S4-2192" transform="translate(1750, 0)"></use><svg width="1850" height="865" x="0" y="-182" viewBox="462.5 -182 1850 865"><use xlink:href="#MJX-3-TEX-S4-2212" transform="scale(3.567, 1)"></use></svg></g><g data-mml-node="mpadded" transform="translate(1138.1, 870.8) scale(0.707)"><g transform="translate(330, 100)"><g data-mml-node="TeXAtom" data-mjx-texclass="ORD"><g data-mml-node="mspace"></g><g data-mml-node="msub" transform="translate(-2300, 0)"><g data-mml-node="TeXAtom" data-mjx-texclass="ORD"><g data-mml-node="mi"><use xlink:href="#MJX-3-TEX-N-48"></use></g><g data-mml-node="mi" transform="translate(750, 0)"><use xlink:href="#MJX-3-TEX-N-6F"></use></g><g data-mml-node="mi" transform="translate(1250, 0)"><use xlink:href="#MJX-3-TEX-N-6D"></use></g></g><g data-mml-node="TeXAtom" transform="translate(2083, -150) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="TeXAtom" data-mjx-texclass="ORD"><g data-mml-node="mi"><use xlink:href="#MJX-3-TEX-SS-1D5A2"></use></g></g></g></g><g data-mml-node="mo" transform="translate(284.8, 0)"><use xlink:href="#MJX-3-TEX-N-28"></use></g><g data-mml-node="mo" transform="translate(673.8, 0)"><use xlink:href="#MJX-3-TEX-N-22C5"></use></g><g data-mml-node="mo" transform="translate(951.8, 0)"><use xlink:href="#MJX-3-TEX-N-2C"></use></g><g data-mml-node="mo" transform="translate(1229.8, 0)"><use xlink:href="#MJX-3-TEX-N-2212"></use></g><g data-mml-node="mo" transform="translate(2007.8, 0)"><use xlink:href="#MJX-3-TEX-N-29"></use></g></g></g></g></g></g><g data-mml-node="mtd" transform="translate(4389, 0)"><g data-mml-node="msup"><g data-mml-node="TeXAtom" data-mjx-texclass="ORD"><g data-mml-node="mi"><use xlink:href="#MJX-3-TEX-SS-1D5A2"></use></g></g><g data-mml-node="mo" transform="translate(639, 432.1) scale(0.707)"><use xlink:href="#MJX-3-TEX-N-2227"></use></g></g></g><g data-mml-node="mtd" transform="translate(6049.6, 0)"><g data-mml-node="mover"><g data-mml-node="mo"><use xlink:href="#MJX-3-TEX-S4-2190"></use><svg width="1850" height="865" x="900" y="-182" viewBox="462.5 -182 1850 865"><use xlink:href="#MJX-3-TEX-S4-2212" transform="scale(3.567, 1)"></use></svg></g><g data-mml-node="mpadded" transform="translate(1138.1, 838.2) scale(0.707)"><g transform="translate(330, 100)"><g data-mml-node="msub"><g data-mml-node="mi"><use xlink:href="#MJX-3-TEX-I-1D457"></use></g><g data-mml-node="mi" transform="translate(412, -150) scale(0.707)"><use xlink:href="#MJX-3-TEX-I-1D44D"></use></g></g></g></g></g></g><g data-mml-node="mtd" transform="translate(9299.6, 0)"><g data-mml-node="TeXAtom" data-mjx-texclass="ORD"><g data-mml-node="mn"><use xlink:href="#MJX-3-TEX-SS-1D7E3"></use></g></g></g></g></g></g></g></svg></mjx-container><p>对应的逗号范畴 <script type="math/tex">\mathrm{Hom}_{\mathsf{C}}(\cdot,-)/j_Z</script>，其中 <script type="math/tex">\mathsf{1}</script> 是恰有一个对象和一个态射的范畴，<script type="math/tex">j_Z</script> 把 <script type="math/tex">\mathsf{1}</script> 中唯一的一个对象映成 <script type="math/tex">\mathrm{Hom}_{\mathsf{C}}(-,Z)</script>．我们可以将上述命题重述如下．</p><div class="note note-primary">            <p><strong>命题</strong>．如果 <script type="math/tex">(Z,\phi)</script> 是可表函子 $F$ 的一个表示，那么 $(Z,\phi)$ 是 <script type="math/tex">\mathrm{Hom}_{\mathsf{C}}(\cdot,-)/Z</script> 中的一个终对象．换言之，对于任意 $(Y,\psi)\in\mathrm{Hom}_{\mathsf{C}}(\cdot,-)/j_Z$，存在唯一的态射 $g:Y\to Z$，使得下图在 $\mathsf{C}^\wedge$ 中交换．</p><center>    <img style="border-radius: 0.3125em;    box-shadow: 0 2px 4px 0 rgba(34,36,38,.12),0 2px 10px 0 rgba(34,36,38,.08);"     src="/img/yoneda_lemma/f11.svg" width="50%">    <br></center>          </div><p><strong>证明</strong>．事实上，因为 $\phi$ 是同构，所以图表交换等价于</p><script type="math/tex; mode=display">\theta_{g_*}=\psi\circ\phi^{-1}.</script><p>又因为 $\mathrm{Hom}_{\mathsf{C}}(\cdot\,,-)$ 函子是全忠实的，故</p><script type="math/tex; mode=display">\begin{aligned}    \mathrm{Hom}_{\mathsf{C}}(\cdot\,,-):\mathrm{Hom}_{\mathsf{C}}(Y,Z)&\longrightarrow \mathrm{Hom}_{\mathsf{C}^\wedge}(\mathrm{Hom}_{\mathsf{C}}(-,Y),\mathrm{Hom}_{\mathsf{C}}(-,Z))\\    g&\longmapsto \theta_{g_*}\end{aligned}</script><p>是双射．于是，存在唯一的 $g:Y\to Z$，使得</p><script type="math/tex; mode=display">\mathrm{Hom}_{\mathsf{C}}(-,g)=\theta_{g_*}=\psi\circ\phi^{-1},</script><p>即图表交换．$\square$</p>]]></content>
    
    
    <categories>
      
      <category>数学</category>
      
    </categories>
    
    
    <tags>
      
      <tag>数学</tag>
      
      <tag>代数</tag>
      
      <tag>范畴论</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>体积渲染</title>
    <link href="/cn/2021/01/17/Volume%20Rendering/"/>
    <url>/cn/2021/01/17/Volume%20Rendering/</url>
    
    <content type="html"><![CDATA[<p>体积渲染不仅要考虑光线与物体表面的交互，还要考虑与空间中大量微粒的交互。本文介绍了体积渲染的一般理论，导出了积分方程形式的光线传输方程，最后给出了实时体积渲染的实例。</p><h1 id="体积介质"><a href="#体积介质" class="headerlink" title="体积介质"></a>体积介质</h1><p>体积介质（media）由体积内部的大量微粒构成．光在介质中传播时，可能会出现 3 种情况：透过（transmission）、吸收（absorption）、散射（scattering）．</p><center>    <img style="border-radius: 0.3125em;    box-shadow: 0 2px 4px 0 rgba(34,36,38,.12),0 2px 10px 0 rgba(34,36,38,.08);"     src="/img/volume_rendering/volume_rendering_1.png" width="90%">    <br>    <div style="color:orange;    font-size:14px;    display: inline-block;    color: #999;    padding: 10px;">图1 - 光线与微粒的作用</div></center><p>同时，介质本身还可能存在发射（emission）的现象．</p><h2 id="吸收"><a href="#吸收" class="headerlink" title="吸收"></a>吸收</h2><p>吸收是由介质的 <strong>吸收截面</strong>（absorption cross section）所描述的，通常记作 $\sigma_a$．假设沿 $\boldsymbol{\omega}$ 方向的光线与点 $\bf p$ 处的介质发生作用，$\sigma_a(\mathbf{p},\boldsymbol{\omega})$ 表示光线在点 $\bf p$ 处沿 $\boldsymbol{\omega}$ 方向行进单位长度后，被吸收的辐照率占原先辐照率的比值，也可以理解为光被吸收的概率．如果不考虑光在介质中的散射，即光始终沿直线传播，那么我们可以得到关于辐照率的如下公式</p><script type="math/tex; mode=display">d L_{o}(\mathbf{p},\boldsymbol{\omega})=-\sigma_{a}(\mathbf{p},\boldsymbol{\omega}) L_{i}(\mathbf{p},-\boldsymbol{\omega}) d t.</script><h2 id="外散射"><a href="#外散射" class="headerlink" title="外散射"></a>外散射</h2><p>如果沿 $\boldsymbol{\omega}$ 方向行进的光线，在点 $\bf p$ 处被散射到了其他方向，那么我们称此时的散射为 <strong>外散射</strong>（out-scattering）．<strong>散射系数</strong>（scattering coefficient）<script type="math/tex">\sigma_s(\mathbf{p},\boldsymbol{\omega})</script> 表示光在点 $\bf p$ 处沿 <script type="math/tex">\boldsymbol{\omega}</script> 方向行进单位长度后，被外散射的辐照率占原先辐照率的比值．外散射现象与吸收现象类似，都会导致点 $\bf p$ 处沿 <script type="math/tex">\boldsymbol{\omega}</script> 方向出射的辐照率 <script type="math/tex">L_{o}(\mathbf{p},\boldsymbol{\omega})</script> 减小．外散射导致的辐照率变化率可由下式描述</p><script type="math/tex; mode=display">\frac{d L_{o}(\mathbf{p},\boldsymbol{\omega})}{d t}=-\sigma_{s}(\mathbf{p},\boldsymbol{\omega}) L_{i}(\mathbf{p},-\boldsymbol{\omega}) .</script><p>吸收和外散射的合效应称为 <strong>衰减</strong>（attenuation）或者 <strong>灭减</strong>（extinction）．<strong>衰减系数</strong> $\sigma_{t}$ 定义为</p><script type="math/tex; mode=display">\sigma_{\mathrm{t}}(\mathbf{p},\boldsymbol{\omega})=\sigma_{a}(\mathbf{p},\boldsymbol{\omega})+\sigma_{s}(\mathbf{p},\boldsymbol{\omega}).</script><p>衰减效应可由下式描述</p><script type="math/tex; mode=display">\frac{d L_{o}(\mathbf{p},\boldsymbol{\omega})}{d t}=-\sigma_{\mathrm{t}}(\mathbf{p},\boldsymbol{\omega}) L_{i}(\mathbf{p},-\boldsymbol{\omega}).</script><p>有两个与衰减系数相关的量也很常见．一个是 <strong>反射率</strong>（albedo）$\rho$，由下式定义</p><script type="math/tex; mode=display">\rho=\frac{\sigma_{s}}{\sigma_{\mathrm{t}}}=\frac{\sigma_{s}}{\sigma_a+\sigma_{s}}.</script><p>表示外散射效应占衰减效应的比重．另一个是 <strong>平均自由程</strong>（mean free path）$1/\sigma_t$，表示一个光子沿直线行进而不被吸收或散射的平均距离．</p><p>如果只考虑衰减效应，则有 <script type="math/tex">L_{o}(\mathbf{p},\boldsymbol{\omega})=L_{i}(\mathbf{p},-\boldsymbol{\omega})</script>，从而有</p><script type="math/tex; mode=display">d \ln L_{o}(\mathbf{p},\boldsymbol{\omega})=-\sigma_{\mathrm{t}}(\mathbf{p},\boldsymbol{\omega})dt.</script><p>设 $\mathbf{p}’=\mathbf{p}+h\boldsymbol{\omega}$，从 $\mathbf{p}$ 到 $\mathbf{p}’$ 点积分可得</p><script type="math/tex; mode=display">\ln L_{o}(\mathbf{p}',\boldsymbol{\omega})-\ln L_{o}(\mathbf{p},\boldsymbol{\omega})=-\int_{0}^{h} \sigma_{\mathrm{t}}(\mathrm{p}+t \boldsymbol{\omega}, \boldsymbol{\omega}) dt,</script><p>即</p><script type="math/tex; mode=display">T_{r}\left(\mathbf{p} \rightarrow \mathbf{p}^{\prime}\right)=\frac{L_{o}(\mathbf{p}',\boldsymbol{\omega})}{L_{o}(\mathbf{p},\boldsymbol{\omega})}=\mathrm{e}^{-\int_{0}^{h} \sigma_{\mathrm{t}}(\mathrm{p}+t \boldsymbol{\omega}, \boldsymbol{\omega}) dt}.</script><p>上式 <script type="math/tex">T_{r}\left(\mathbf{p} \rightarrow \mathbf{p}^{\prime}\right)</script> 被称作 <strong>光束透射比</strong>（beam transmittance），表示光束中未被吸收或散射的光线所占的比例．<script type="math/tex">T_{r}\left(\mathbf{p} \rightarrow \mathbf{p}^{\prime}\right)</script> 有一些常用的性质．一个是</p><script type="math/tex; mode=display">T_{r}\left(\mathbf{p} \rightarrow \mathbf{p}\right)=1,</script><p>另一个是</p><script type="math/tex; mode=display">T_{r}\left(\mathbf{p} \rightarrow \mathbf{p}^{\prime\prime}\right)=T_{r}\left(\mathbf{p} \rightarrow \mathbf{p}^{\prime}\right)T_{r}\left(\mathbf{p}^{\prime}\rightarrow \mathbf{p}^{\prime\prime}\right).</script><p>我们通常还会假设</p><script type="math/tex; mode=display">\sigma_{\mathrm{t}}(\mathbf{p},\boldsymbol{\omega})=\sigma_{\mathrm{t}}(\mathbf{p},-\boldsymbol{\omega}),</script><p>于是</p><script type="math/tex; mode=display">\begin{aligned}    T_{r}\left(\mathbf{p}' \rightarrow \mathbf{p}\right)&=\mathrm{e}^{-\int_{0}^{h} \sigma_{\mathrm{t}}(\mathrm{p}'+t (-\boldsymbol{\omega}), -\boldsymbol{\omega}) dt}\\    &=\mathrm{e}^{-\int_{0}^{h} \sigma_{\mathrm{t}}(\mathrm{p}+(h-t)\boldsymbol{\omega}, \boldsymbol{\omega}) dt}\\    &=\mathrm{e}^{\int_{h}^{0} \sigma_{\mathrm{t}}(\mathrm{p}+u\boldsymbol{\omega}, \boldsymbol{\omega}) du}\\    &=\mathrm{e}^{-\int_{0}^{h} \sigma_{\mathrm{t}}(\mathrm{p}+u\boldsymbol{\omega}, \boldsymbol{\omega}) du}\\    &=T_{r}\left(\mathbf{p} \rightarrow \mathbf{p}'\right).\end{aligned}</script><p>特别地，如果 $\sigma_{\mathrm{t}}$ 是常数，我们有</p><script type="math/tex; mode=display">T_{r}\left(\mathbf{p} \rightarrow \mathbf{p}^{\prime}\right)=\mathrm{e}^{-\sigma_{\mathrm{t}}h}=\mathrm{e}^{-\sigma_{\mathrm{t}}\Vert\mathbf{p} -\mathbf{p}^{\prime}\Vert}.</script><p>上式被称作 Beer-Lambert 定律．</p><h2 id="发射"><a href="#发射" class="headerlink" title="发射"></a>发射</h2><p>点 $\mathbf{p}$ 处的介质沿 $\boldsymbol{\omega}$ 方向单位长度内产生的辐照率为 $L_{\mathrm{e}}(\mathrm{p}, \omega)$，公式写作</p><script type="math/tex; mode=display">\mathrm{d} L_{o}(\mathrm{p}, \omega)=L_{\mathrm{e}}(\mathrm{p}, \omega) \mathrm{d} t.</script><h2 id="内散射"><a href="#内散射" class="headerlink" title="内散射"></a>内散射</h2><p>如果在点 $\bf p$ 处，来自其他方向的光线被散射到了 $\boldsymbol{\omega}$ 方向，则称这种散射为 <strong>内散射</strong>（in-scattering）．</p><p>我们用 <strong>相函数</strong>（phase function）$p(\mathbf{p},\boldsymbol{\omega}_i,\boldsymbol{\omega}_o)$ 来描述散射辐照率在各个方向上的分布，其中 $\mathbf{p}$ 是点的位置，$\boldsymbol{\omega}_i$ 是入射光方向，$\boldsymbol{\omega}_o$ 是散射光方向．根据定义，相函数必须满足：</p><script type="math/tex; mode=display">\int_{S^2}p(\mathbf{p},\boldsymbol{\omega}_i,\boldsymbol{\omega}_o)d\boldsymbol{\omega}_o=1.</script><p>内散射效应使点 $\bf p$ 处沿 $\boldsymbol{\omega}$ 方向出射的辐照率增加．如果考虑介质发射产生的辐照率，那么内散射和发射导致的单位长度辐照率增加的总量可以用</p><script type="math/tex; mode=display">L_{\mathrm{s}}(\mathbf{p},\boldsymbol{\omega})=L_{\mathrm{e}}(\mathbf{p},\boldsymbol{\omega})+ \int_{\mathrm{S}^{2}} p\left(\mathbf{p}, \boldsymbol{\omega}_i, \boldsymbol{\omega}\right) \sigma_{\mathrm{s}}(\mathbf{p},\boldsymbol{\omega}_i)L_{i}\left(\mathbf{p},\boldsymbol{\omega}_i\right) d\boldsymbol{\omega}_i</script><p>来表示．$L_{\mathrm{s}}(\mathbf{p},\boldsymbol{\omega})$ 通常称为 <strong>源项</strong>（source term）．</p><h1 id="传输方程"><a href="#传输方程" class="headerlink" title="传输方程"></a>传输方程</h1><h2 id="微分-积分方程形式"><a href="#微分-积分方程形式" class="headerlink" title="微分-积分方程形式"></a>微分-积分方程形式</h2><p>设 $\mathbf{p}(t)=\mathbf{p}_0+t\boldsymbol{\omega}$，点 $\mathbf{p}(t)$ 处 $\boldsymbol{\omega}$ 方向辐照率的变化率由衰减效应和源项决定．根据这个关系得到的方程</p><script type="math/tex; mode=display">\frac{d L_{o}(\mathbf{p}(t),\boldsymbol{\omega})}{d t}=-\sigma_{t}(\mathbf{p}(t),\boldsymbol{\omega}) L_{i}(\mathbf{p}(t),-\boldsymbol{\omega})+ L_{\mathrm{s}}(\mathbf{p}(t),\boldsymbol{\omega}),</script><p>即</p><script type="math/tex; mode=display">\begin{aligned}   &\frac{d L_{o}(\mathbf{p}(t),\boldsymbol{\omega})}{d t}\\   =\ &-\sigma_{t}(\mathbf{p}(t),\boldsymbol{\omega}) L_{i}(\mathbf{p}(t),-\boldsymbol{\omega})+L_{\mathrm{e}}(\mathbf{p}(t),\boldsymbol{\omega})+ \int_{\mathrm{S}^{2}} p\left(\mathbf{p}(t), \boldsymbol{\omega}_i, \boldsymbol{\omega}\right) \sigma_{\mathrm{s}}(\mathbf{p}(t),\boldsymbol{\omega}_i)L_{i}\left(\mathbf{p}(t),\boldsymbol{\omega}_i\right) d\boldsymbol{\omega}_i,\end{aligned}</script><p>被称作 <strong>传输方程</strong>（the equation of transfer）．</p><h2 id="积分方程形式"><a href="#积分方程形式" class="headerlink" title="积分方程形式"></a>积分方程形式</h2><p>为了便于求解，可以通过给定边界条件</p><script type="math/tex; mode=display">L_{o}\left(\mathbf{p}(0),\boldsymbol{\omega}\right)=L_{o}\left(\mathbf{p}_{0},\boldsymbol{\omega}\right),</script><p>将传输方程改写为关于 $L_{i}(\mathbf{p}(t),-\boldsymbol{\omega})$ 的积分方程．</p><p>注意到 <script type="math/tex">L_{o}(\mathbf{p}(t),\boldsymbol{\omega})=L_{i}(\mathbf{p}(t),-\boldsymbol{\omega})</script>，移项得</p><script type="math/tex; mode=display">\frac{d L_{i}(\mathbf{p}(t),-\boldsymbol{\omega})}{d t}+\sigma_{t}(\mathbf{p}(t),\boldsymbol{\omega}) L_{i}(\mathbf{p}(t),-\boldsymbol{\omega})= L_{\mathrm{s}}(\mathbf{p}(t),\boldsymbol{\omega}),</script><p>方程两边同乘</p><script type="math/tex; mode=display">e^{\int_{0}^{t} \sigma_{\mathrm{t}}(\mathbf{p}(u), \boldsymbol{\omega}) du}</script><p>得</p><script type="math/tex; mode=display">\begin{aligned}    &\frac{d L_{i}(\mathbf{p}(t),-\boldsymbol{\omega})}{d t}e^{\int_{0}^{t} \sigma_{\mathrm{t}}(\mathbf{p}(u), -\boldsymbol{\omega}) du}+ L_{i}(\mathbf{p}(t),-\boldsymbol{\omega})\frac{d\left(e^{\int_{0}^{t} \sigma_{\mathrm{t}}(\mathbf{p}(u), -\boldsymbol{\omega}) du}\right)}{dt}\\    =\ & L_{\mathrm{s}}(\mathbf{p}(t),\boldsymbol{\omega})e^{\int_{0}^{t} \sigma_{\mathrm{t}}(\mathbf{p}(u), -\boldsymbol{\omega}) du},\end{aligned}</script><p>即</p><script type="math/tex; mode=display">d\left(L_{i}(\mathbf{p}(t),-\boldsymbol{\omega})e^{\int_{0}^{t} \sigma_{\mathrm{t}}(\mathbf{p}(u), \boldsymbol{\omega}) du}\right)=L_{\mathrm{s}}(\mathbf{p}(t),\boldsymbol{\omega})e^{\int_{0}^{t} \sigma_{\mathrm{t}}(\mathbf{p}(u), \boldsymbol{\omega}) du}dt.</script><p>从 $0$ 积分到 $t$ 得</p><script type="math/tex; mode=display">\left.\left(L_{i}(\mathbf{p}(s),-\boldsymbol{\omega})e^{\int_{0}^{s} \sigma_{\mathrm{t}}(\mathbf{p}(u), \boldsymbol{\omega}) du}\right)\right|_{0}^{t}=\int_{0}^tL_{\mathrm{s}}(\mathbf{p}(s),\boldsymbol{\omega})e^{\int_{0}^{s} \sigma_{\mathrm{t}}(\mathbf{p}(u), \boldsymbol{\omega}) du}ds</script><p>即</p><script type="math/tex; mode=display">L_{i}(\mathbf{p}(t),-\boldsymbol{\omega})e^{\int_{0}^{t} \sigma_{\mathrm{t}}(\mathbf{p}(u), \boldsymbol{\omega}) du}-L_{i}(\mathbf{p}_0,-\boldsymbol{\omega})=\int_{0}^tL_{\mathrm{s}}(\mathbf{p}(s),\boldsymbol{\omega})e^{\int_{0}^{s} \sigma_{\mathrm{t}}(\mathbf{p}(u), \boldsymbol{\omega}) du}ds.</script><p>注意到</p><script type="math/tex; mode=display">T_{r}\left( \mathbf{p}_{0}\rightarrow \mathbf{p}(t)\right)=\mathrm{e}^{-\int_{0}^{t} \sigma_{\mathrm{t}}(\mathbf{p}(u), \boldsymbol{\omega}) du}</script><p>方程两边同乘 <script type="math/tex">T_{r}\left( \mathbf{p}_{0}\rightarrow \mathbf{p}(t)\right)</script>，移项化简得</p><script type="math/tex; mode=display">L_{i}(\mathbf{p}(t),-\boldsymbol{\omega})=T_{r}\left( \mathbf{p}_{0}\rightarrow \mathbf{p}(t)\right)L_{o}(\mathbf{p}_0,\boldsymbol{\omega})+\int_{0}^tL_{\mathrm{s}}(\mathbf{p}(s),\boldsymbol{\omega})\mathrm{e}^{-\int_{s}^{t} \sigma_{\mathrm{t}}(\mathbf{p}(u), \boldsymbol{\omega}) du}ds.</script><p>令 $t’=t-s$，即 $s=t-t’$，换元得到</p><script type="math/tex; mode=display">L_{i}(\mathbf{p}(t),-\boldsymbol{\omega})=T_{r}\left( \mathbf{p}_{0}\rightarrow \mathbf{p}(t)\right)L_{o}(\mathbf{p}_0,\boldsymbol{\omega})-\int_{t}^0L_{\mathrm{s}}(\mathbf{p}(t-t'),\boldsymbol{\omega})\mathrm{e}^{-\int_{t-t'}^{t} \sigma_{\mathrm{t}}(\mathbf{p}(u), \boldsymbol{\omega}) du}dt'.</script><p>因为 $\mathbf{p}(t-t’)=\mathbf{p}_0+t\boldsymbol{\omega}-t’\boldsymbol{\omega}=\mathbf{p}(t)-t’\boldsymbol{\omega}$，进一步化简得</p><script type="math/tex; mode=display">L_{i}(\mathbf{p}(t),-\boldsymbol{\omega})=T_{r}\left( \mathbf{p}_{0}\rightarrow \mathbf{p}(t)\right)L_{o}(\mathbf{p}_0,\boldsymbol{\omega})+\int_{0}^tT_{r}\left( \mathbf{p}(t)-t'\boldsymbol{\omega}\rightarrow \mathbf{p}\right) L_{s}\left(\mathbf{p}(t)-t'\boldsymbol{\omega},\boldsymbol{\omega}\right)dt'.</script><p>方程</p><script type="math/tex; mode=display">L_{i}(\mathbf{p}, -\boldsymbol{\omega})=T_{r}\left( \mathbf{p}_{0}\rightarrow \mathbf{p}\right) L_{o}\left(\mathbf{p}_{0},\boldsymbol{\omega}\right)+\int_{0}^{t} T_{r}\left( \mathbf{p}-t'\boldsymbol{\omega}\rightarrow \mathbf{p}\right) L_{s}\left(\mathbf{p}-t'\boldsymbol{\omega},\boldsymbol{\omega}\right) \mathrm{d} t'</script><p>被称作传输方程的积分方程形式．令 $\mathbf{p}^\prime=\mathbf{p}-t’\boldsymbol{\omega}$，则传输方程也可写作</p><script type="math/tex; mode=display">L_{i}(\mathbf{p}, -\boldsymbol{\omega})=T_{r}\left( \mathbf{p}_{0}\rightarrow \mathbf{p}\right) L_{o}\left(\mathbf{p}_{0},\boldsymbol{\omega}\right)+\int_{0}^{t} T_{r}\left(\mathbf{p}^\prime\rightarrow \mathbf{p}\right) L_{s}\left(\mathbf{p}^\prime,\boldsymbol{\omega}\right) \mathrm{d} t'</script><center>    <img style="border-radius: 0.3125em;    box-shadow: 0 2px 4px 0 rgba(34,36,38,.12),0 2px 10px 0 rgba(34,36,38,.08);"     src="/img/volume_rendering/volume_rendering_2.png" width="90%">    <br>    <div style="color:orange;    font-size:14px;    display: inline-block;    color: #999;    padding: 10px;">图2 - 传输方程积分示意图</div></center><h1 id="实时体积渲染"><a href="#实时体积渲染" class="headerlink" title="实时体积渲染"></a>实时体积渲染</h1><h2 id="相函数"><a href="#相函数" class="headerlink" title="相函数"></a>相函数</h2><p>假设相函数 $p\left(\mathbf{p}^\prime, \boldsymbol{\omega}_i, \boldsymbol{\omega}\right)$ 只与 $\boldsymbol{\omega}_i, \boldsymbol{\omega}$ 之间的夹角 $\theta$ 有关，即</p><script type="math/tex; mode=display">p\left(\mathbf{p}^\prime, \boldsymbol{\omega}_i, \boldsymbol{\omega}\right)=p\left(\theta\right).</script><p>最简单的相函数为</p><script type="math/tex; mode=display">p\left(\theta\right)=\frac{1}{4\pi}.</script><p>基于物理的相函数取决于粒子的相对大小 $s_p$，</p><script type="math/tex; mode=display">s_{p}=\frac{2 \pi r}{\lambda},</script><p>其中 $r$ 是粒子半径，$\lambda$ 是光的波长：</p><ul><li><p>当 $s_p\ll 1$时，存在 Rayleigh 散射；</p></li><li><p>当 $s_p\approx 1$时，存在 Mie 散射；</p></li><li><p>当 $s_p\gg 1$ 时，存在几何散射．</p></li></ul><h3 id="Rayleigh-散射"><a href="#Rayleigh-散射" class="headerlink" title="Rayleigh 散射"></a>Rayleigh 散射</h3><p>Rayleigh 散射的相函数为</p><script type="math/tex; mode=display">p(\theta)=\frac{3}{16 \pi}\left(1+\cos ^{2} \theta\right).</script><center>    <img style="border-radius: 0.3125em;    box-shadow: 0 2px 4px 0 rgba(34,36,38,.12),0 2px 10px 0 rgba(34,36,38,.08);"     src="/img/volume_rendering/volume_rendering_3.svg" width="90%">    <br>    <div style="color:orange;    font-size:14px;    display: inline-block;    color: #999;    padding: 10px;">图3 - Rayleigh 散射相函数极坐标图像</div></center><p>Rayleigh 散射的散射系数与波长的四次方成反比</p><script type="math/tex; mode=display">\sigma_{s}(\lambda) \propto \frac{1}{\lambda^{4}}.</script><h3 id="Mie-散射"><a href="#Mie-散射" class="headerlink" title="Mie 散射"></a>Mie 散射</h3><p>Mie 散射的相函数</p><script type="math/tex; mode=display">p_{h g}(\theta, g)=\frac{1-g^{2}}{4 \pi\left(1+g^{2}-2 g \cos \theta\right)^{1.5}}.</script><p>称作 Henyey-Greenstein（HG）相函数，其中参数 $g\in[-1,1]$．$g&gt;0$ 时，发生前向散射；$g&lt;0$ 时，发生后向散射；$g=0$ 时，发生各向同性散射．</p><p>Schlick 相函数</p><script type="math/tex; mode=display">p(\theta, k)=\frac{1-k^{2}}{4 \pi(1+k \cos \theta)^{2}}, \quad \text { where } \quad k \approx 1.55 g-0.55 g^{3}</script><p>是 HG 相函数的近似，它的计算更快．</p><center>    <img style="border-radius: 0.3125em;    box-shadow: 0 2px 4px 0 rgba(34,36,38,.12),0 2px 10px 0 rgba(34,36,38,.08);"     src="/img/volume_rendering/volume_rendering_4.svg" width="90%">    <br>    <div style="color:orange;    font-size:14px;    display: inline-block;    color: #999;    padding: 10px;">图4 - HG 相函数（蓝色）与 Schlick 相函数（红色）极坐标图像．$g$ 取值分别为 0，0.3，0.6</div></center><h2 id="源项估计"><a href="#源项估计" class="headerlink" title="源项估计"></a>源项估计</h2><p>假设介质不存在发射现象，散射系数只与位置有关，即</p><script type="math/tex; mode=display">\sigma_{\mathrm{s}}(\mathbf{p}^\prime,\boldsymbol{\omega}_i)=\sigma_{\mathrm{s}}(\mathbf{p}^\prime).</script><p>源项</p><script type="math/tex; mode=display">L_{\mathrm{s}}(\mathbf{p}^\prime,\boldsymbol{\omega})=\sigma_{\mathrm{s}}(\mathbf{p}^\prime)\int_{\mathrm{S}^{2}} p\left( \theta\right) L_{i}\left(\mathbf{p}^\prime,\boldsymbol{\omega}_i\right) d\boldsymbol{\omega}_i</script><p>可由下式进行近似计算</p><script type="math/tex; mode=display">\widehat{L}_{s}\left(\mathbf{p}^\prime,\boldsymbol{\omega}\right)=\pi\sigma_{\mathrm{s}}(\mathbf{p}^\prime)\sum_{i=1}^{N_i} p\left( \theta\right)v\left(\mathbf{p}^\prime, \mathbf{p}_{\text {light}_{i}}\right) c_{\text{light}_i}\left(\left\|\mathbf{p}^\prime-\mathbf{p}_{\text{light}_{i}}\right\|\right),</script><p>上式的</p><script type="math/tex; mode=display">v\left(\mathbf{p}^\prime, \mathbf{p}_{\text {light}_{i}}\right)=\operatorname{shadowMap}\left(\mathbf{p}^\prime, \mathbf{p}_{\text {light}_{i}}\right) \cdot \operatorname{volshad}\left(\mathbf{p}^\prime, \mathbf{p}_{\text {light}_{i}}\right)</script><p>称作可视性函数（visibility function），其中 <script type="math/tex">\operatorname{shadowMap}\left(\mathbf{p}^\prime, \mathbf{p}_{\text {light}_{i}}\right)</script> 表示阴影贴图，</p><script type="math/tex; mode=display">\operatorname{volshad}\left(\mathbf{p}^\prime, \mathbf{p}_{\text {light}_{i}}\right)=\widehat{T}_r\left(\mathbf{p}^\prime, \mathbf{p}_{\text {light}_{i}}\right)</script><p>表示体积阴影．如果 $\sigma_t(\mathbf{p})$ 是常数 $\sigma_t$，体积阴影的表达式为</p><script type="math/tex; mode=display">\operatorname{volshad}\left(\mathbf{p}^\prime, \mathbf{p}_{\text {light}_{i}}\right)=\mathrm{e}^{-\sigma_{\mathrm{t}}N_j\Delta t},</script><p>其中 <script type="math/tex">N_j\Delta t</script> 是从 <script type="math/tex">\mathbf{p}^\prime</script> 向 <script type="math/tex">\mathbf{p}_{\text {light}_{i}}</script> 进行光线步进得到的光线在体积中行进的距离．</p><p>源项估计式中的 <script type="math/tex">c_{\text{light}_i}\left(\left\|\mathbf{p}^\prime-\mathbf{p}_{\text{light}_{i}}\right\|\right)</script> 是第 $i$ 个灯光的辐照率，通常取作</p><script type="math/tex; mode=display">c_{\text{light}_i}\left(\left\|\mathbf{p}^\prime-\mathbf{p}_{\text{light}_{i}}\right\|\right)=c_{\text {light}_{i,0}}\left(\frac{r_{0}}{ \left\|\mathbf{p}^\prime-\mathbf{p}_{\text{light}_{i}}\right\|}\right)^{2},</script><p>或</p><script type="math/tex; mode=display">c_{\text{light}_i}\left(\left\|\mathbf{p}^\prime-\mathbf{p}_{\text{light}_{i}}\right\|\right)=c_{\text {light}_{i,0}}\left(\frac{r_{0}}{\max \left(\left\|\mathbf{p}^\prime-\mathbf{p}_{\text{light}_{i}}\right\|, r_{\min }\right)}\right)^{2},</script><p>其中 <script type="math/tex">c_{\text {light}_{i,0}}</script> 表示 <script type="math/tex">\left\|\mathbf{p}^\prime-\mathbf{p}_{\text{light}_{i}}\right\|=r_0</script> 时第 $i$ 个灯光的辐照率．</p><h2 id="总辐照率估计"><a href="#总辐照率估计" class="headerlink" title="总辐照率估计"></a>总辐照率估计</h2><p>假设衰减系数 $\sigma_\mathrm{t}$ 只与位置有关，即</p><script type="math/tex; mode=display">\sigma_{\mathrm{t}}(\mathbf{p}^\prime,\boldsymbol{\omega}_i)=\sigma_{\mathrm{t}}(\mathbf{p}^\prime).</script><p>当 $\mathbf{p}_1$ 和 $\mathbf{p}_2$ 距离 $\Delta t$ 较小时，我们可以用</p><script type="math/tex; mode=display">\widehat{T}_{r}\left(\mathbf{p}_1\rightarrow \mathbf{p}_2\right)=\mathrm{e}^{-\sigma_{\mathrm{t}}(\mathbf{p}_1) \Delta t}</script><p>作为</p><script type="math/tex; mode=display">T_{r}\left(\mathbf{p}_1\rightarrow \mathbf{p}_2\right)=\mathrm{e}^{-\int_{0}^{\Delta t} \sigma_{\mathrm{t}}(\mathbf{p}_1-u\boldsymbol{\omega}) du}</script><p>的估计．于是，</p><script type="math/tex; mode=display">L_{i}(\mathbf{p}, -\boldsymbol{\omega})=T_{r}\left( \mathbf{p}_{0}\rightarrow \mathbf{p}\right) L_{o}\left(\mathbf{p}_{0},\boldsymbol{\omega}\right)+\int_{0}^{t} T_{r}\left(\mathbf{p}^\prime\rightarrow \mathbf{p}\right) L_{s}\left(\mathbf{p}^\prime,\boldsymbol{\omega}\right) \mathrm{d} t'</script><p>的估计式可以写作</p><script type="math/tex; mode=display">\begin{aligned}   \widehat{L}_{i}(\mathbf{p}, -\boldsymbol{\omega})&=L_{o}\left(\mathbf{p}_{0},\boldsymbol{\omega}\right)\mathrm{e}^{-S_{N_k}\Delta t}+\sum_{k=1}^{N_k}\widehat{L}_{s}\left(\mathbf{p}^\prime_k,\boldsymbol{\omega}\right)  \mathrm{e}^{-S_k \Delta t} \Delta t,\end{aligned}</script><p>其中</p><script type="math/tex; mode=display">S_J=\sum\limits_{k=1}^{J}\sigma_{\mathrm{t}}(\mathbf{p}^\prime_k),\quad \mathbf{p}^\prime_k=\mathbf{p}-(k-1)\Delta t \boldsymbol{\omega} .</script><p>如果 $\sigma_t(\mathbf{p})$ 是常数 $\sigma_t$，我们有更精确的估计</p><script type="math/tex; mode=display">\begin{aligned}   \widehat{L}_{i}(\mathbf{p}, -\boldsymbol{\omega})&=L_{o}\left(\mathbf{p}_{0},\boldsymbol{\omega}\right)\mathrm{e}^{-S_{N_k}\Delta t}+\sum_{k=1}^{N_k}\widehat{L}_{s}\left(\mathbf{p}^\prime_k,\boldsymbol{\omega}\right)  \int_{(k-1)\Delta t}^{k\Delta t}\mathrm{e}^{-\sigma_{\mathrm{t}}t'}dt'\\   &=L_{o}\left(\mathbf{p}_{0},\boldsymbol{\omega}\right)\mathrm{e}^{-S_{N_k}\Delta t}+\frac{1}{\sigma_{\mathrm{t}}}\sum_{k=1}^{N_k}\widehat{L}_{s}\left(\mathbf{p}^\prime_k,\boldsymbol{\omega}\right)  \mathrm{e}^{-\sigma_{\mathrm{t}}(k-1)\Delta t}(1-\mathrm{e}^{-\sigma_{\mathrm{t}}\Delta t}).\end{aligned}</script><h2 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h2><p>取定常数衰减系数 $\sigma_{\mathrm{t}}$ 和各向同性相函数，辐照率的计算公式为</p><script type="math/tex; mode=display">\begin{aligned}   &\widehat{L}_{i}(\mathbf{p}, -\boldsymbol{\omega})\\   =\;&L_{o}\left(\mathbf{p}_{0},\boldsymbol{\omega}\right)\mathrm{e}^{-S_{N_k}\Delta t}+\frac{1}{\sigma_{\mathrm{t}}}\sum_{k=1}^{N_k}\widehat{L}_{s}\left(\mathbf{p}^\prime_k,\boldsymbol{\omega}\right)  \mathrm{e}^{-\sigma_{\mathrm{t}}(k-1)\Delta t}(1-\mathrm{e}^{-\sigma_{\mathrm{t}}\Delta t})\\   =\;&L_{o}\left(\mathbf{p}_{0},\boldsymbol{\omega}\right)\mathrm{e}^{-S_{N_k}\Delta t}\\   &+\frac{\rho(1-\mathrm{e}^{-\sigma_{\mathrm{t}}\Delta t})}{4}\sum_{k=1}^{N_k}\mathrm{e}^{-\sigma_{\mathrm{t}}(k-1)\Delta t}\sum_{i=1}^{N_i} \frac{c_{\text {light}_{i,0}}r_{0}^2}{ \left\|\mathbf{p}^\prime-\mathbf{p}_{\text{light}_{i}}\right\|^2}\operatorname{shadowMap}\left(\mathbf{p}^\prime_k, \mathbf{p}_{\text {light}_{i}}\right)\mathrm{e}^{-\sigma_{\mathrm{t}}N_j\Delta t}.\end{aligned}</script>]]></content>
    
    
    
    <tags>
      
      <tag>计算机图形</tag>
      
      <tag>PBR</tag>
      
      <tag>体积渲染</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>微分流形</title>
    <link href="/cn/2020/12/04/Differentiable%20Manifold/"/>
    <url>/cn/2020/12/04/Differentiable%20Manifold/</url>
    
    <content type="html"><![CDATA[<h1 id="流形的基本概念"><a href="#流形的基本概念" class="headerlink" title="流形的基本概念"></a>流形的基本概念</h1><h2 id="拓扑流形"><a href="#拓扑流形" class="headerlink" title="拓扑流形"></a>拓扑流形</h2><h3 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h3><div class="note note-primary">            <p>$n$ 维 <strong>拓扑流形</strong> 是局部同胚于 $n$ 维欧式空间的 Hausdorff 拓扑空间．</p>          </div><p>所谓“局部同胚于 $n$ 维欧式空间”，就是说任取拓扑空间 $M$ 中一点 $p$，存在 $p$ 的一个邻域 $N(p)$，使得 $N(p)$ 与欧式空间 $\mathbb{R}^n$ 同胚．</p><h3 id="坐标卡"><a href="#坐标卡" class="headerlink" title="坐标卡"></a>坐标卡</h3><div class="note note-primary">            <p>如果 $U_\alpha$ 是 $\mathbb{R}^n$ 中的一个开集，</p><script type="math/tex; mode=display">\mathbf{x}_\alpha:U_\alpha\to \mathbf{x}_\alpha (U_\alpha)\subset M</script><p>是一个同胚映射，并且 <script type="math/tex">\mathbf{x}_\alpha (U_\alpha)</script> 包含点 $p$，那么二元组 <script type="math/tex">(U_\alpha,\mathbf{x}_\alpha)</script> 称作拓扑流形 $M$ 在点 $p$ 处的一个 <strong>坐标卡</strong>（coordinate chart）或者<strong>（局部）坐标系</strong>．</p>          </div><p>给定一个坐标卡，<script type="math/tex">\mathbf{x}^{-1}_{\alpha}</script> 常常被称作点 $p$ 处的局部坐标映射，而点 $p$ 在 <script type="math/tex">\mathbf{x}^{-1}_{\alpha}</script> 下的像 <script type="math/tex">\mathbf{x}^{-1}_\alpha(p)</script> 就叫做点 $p$ 的局部坐标．坐标卡可以把拓扑流形的局部转换成我们熟悉的 $\mathbb{R}^n$ 中的坐标，因此有时也被称作参数化．</p><p>拓扑流形 $M$ 在其中任意一点 $p$ 处都至少存在一个坐标卡．事实上，设 <script type="math/tex">\eta</script> 是一个由 <script type="math/tex">N(p)</script> 到 <script type="math/tex">\mathbb{R}^n</script> 的同胚映射．根据邻域的定义， $M$ 中存在一个开集 <script type="math/tex">W</script>，满足 <script type="math/tex">p\in W\subset N(p)</script>．因此，如果将 <script type="math/tex">\eta</script> 限制到 <script type="math/tex">W</script> 上，然后令 <script type="math/tex">\mathbf{x}=(\left.\eta\right|_{W})^{-1}</script>，那么</p><script type="math/tex; mode=display">\mathbf{x}:U\to \mathbf{x}(U)</script><p>也是一个同胚映射．因此，$(U,\mathbf{x})$ 就是点 $p$ 处的一个坐标卡．</p><h3 id="图册"><a href="#图册" class="headerlink" title="图册"></a>图册</h3><div class="note note-primary">            <p>若 <script type="math/tex">\Sigma=\{(U_\alpha,\mathbf{x}_\alpha)\}_{\alpha\in A}</script> 是拓扑流形 $M$ 的一个坐标卡集，并且 <script type="math/tex">\{\mathbf{x}_\alpha(U_\alpha)\}_{\alpha\in A}</script> 是 $M$ 的一个覆盖，则称 <script type="math/tex">\Sigma</script> 是 $M$ 的一个 <strong>图册</strong>（atlas）．</p>          </div><p>拓扑流形 $M$ 可以看作是由许多欧式空间的开子集 <script type="math/tex">U_\alpha(\alpha\in A)</script> 粘合而得到的拓扑空间．</p><p>给定拓扑流形 $M$ 的一个图册 <script type="math/tex">\Sigma=\{(U_\alpha,\mathbf{x}_\alpha)\}_{\alpha\in A}</script>，图册中有些坐标卡覆盖的区域可能发生重叠．换言之，$M$ 中的有些点可能会被多个坐标卡覆盖．设 <script type="math/tex">(U_\alpha,\mathbf{x}_\alpha)</script> 和 <script type="math/tex">(U_\beta,\mathbf{x}_\beta)</script> 覆盖的区域发生了重叠，即</p><script type="math/tex; mode=display">\mathbf{x}_\alpha(U_\alpha)\cap \mathbf{x}_\beta(U_\beta)\ne\varnothing,</script><p>我们可以定义 <strong>转移函数</strong></p><script type="math/tex; mode=display">\mathbf{x}^{-1}_\beta\circ \mathbf{x}_{\alpha}: \mathbf{x}^{-1}_\alpha(\mathbf{x}_\alpha(U_\alpha)\cap \mathbf{x}_\beta(U_\beta)) \longrightarrow \mathbf{x}^{-1}_\beta(\mathbf{x}_\alpha(U_\alpha)\cap \mathbf{x}_\beta(U_\beta))</script><p>和</p><script type="math/tex; mode=display">\mathbf{x}^{-1}_{\alpha}\circ \mathbf{x}_\beta:  \mathbf{x}^{-1}_\beta(\mathbf{x}_\alpha(U_\alpha)\cap \mathbf{x}_\beta(U_\beta))\longrightarrow \mathbf{x}^{-1}_\alpha(\mathbf{x}_\alpha(U_\alpha)\cap \mathbf{x}_\beta(U_\beta)).</script><p>因为同胚映射的复合依然是同胚映射，上述两个转移函数都是同胚映射．前面曾经提到过， $M$ 中某点 $p$ 可能会被多个坐标卡覆盖．也就是说，点 $p$ 可能会有多个局部坐标．借助转移函数，我们可以在点 $p$ 的多个局部坐标间进行切换．</p><h2 id="微分流形"><a href="#微分流形" class="headerlink" title="微分流形"></a>微分流形</h2><h3 id="动机：定义可微函数"><a href="#动机：定义可微函数" class="headerlink" title="动机：定义可微函数"></a>动机：定义可微函数</h3><p>拓扑流形是一种局部“很像”欧式空间的拓扑空间．这里的“很像”，指的是拓扑结构一致．对于拓扑流形，我们在局部上拥有欧式拓扑，因此可以借用处理欧式拓扑的技术处理拓扑流形．但是，欧式空间上还存在比拓扑结构更加精细的结构，比如，我们可以在欧式空间上定义可微函数并求微分．如果一个拓扑流形在局部上继承了这种更精细的结构，那么类似地，我们也可以在拓扑流形上定义可微函数并微分．下面，我们将给出这种更精细结构的形式化定义．</p><p>设 $M$ 是一个 $n$ 维拓扑流形，<script type="math/tex">\Sigma=\{(U_\alpha,\mathbf{x}_\alpha)\}_{\alpha\in A}</script> 是 $M$ 的一个图册．我们的目标是在拓扑流形上正确地定义可微函数 $f:M\to \mathbb{R}^m$．一个自然的想法是，在局部用坐标卡 <script type="math/tex">(U_\alpha,\mathbf{x}_\alpha)</script> 将定义域从 $M$ 的子集拉回到 <script type="math/tex">U_\alpha\subset\mathbb{R}^n</script> 上．具体来说，我们可以尝试这样规定：函数 $f:M\to \mathbb{R}^m$ 在点 $p$ 处是可微的，当且仅当对任意覆盖了点 $p$ 的坐标卡 <script type="math/tex">(U_\alpha,\mathbf{x}_\alpha)</script>，复合函数</p><script type="math/tex; mode=display">f\circ \mathbf{x}_\alpha:U_\alpha\longrightarrow \mathbb{R}^m</script><p>在点 $\mathbf{x}^{-1}_\alpha(p)$ 处是可微的．</p><h3 id="相容图册"><a href="#相容图册" class="headerlink" title="相容图册"></a>相容图册</h3><p>这样定义在理论上行得通，但是在实际中却比较麻烦．因为如果要证明 $f$ 在点 $p$ 处的可微性，我们要对所有覆盖了点 $p$ 的坐标卡进行验证．其实，如果我们只考虑所谓的 <strong>相容</strong> 图册，情况将大大简化．此时，我们只需要对一个覆盖了点 $p$ 的坐标卡进行验证即可．</p><p>两个坐标卡 <script type="math/tex">(U_\alpha,\mathbf{x}_\alpha),(U_\beta,\mathbf{x}_\beta)</script> 被称作是相容的，如果</p><script type="math/tex; mode=display">U_\alpha\cap U_\beta\ne\varnothing\implies\mathbf{x}^{-1}_\beta\circ \mathbf{x}_{\alpha},\mathbf{x}^{-1}_{\alpha}\circ \mathbf{x}_\beta \text{是可微函数}.</script><p>如果一个图册中任意两个坐标卡都是相容的，则该图册被称作相容图册．设 <script type="math/tex">(U_\alpha,\mathbf{x}_\alpha),(U_\beta,\mathbf{x}_\beta)</script> 是覆盖点 <script type="math/tex">p</script> 的两个坐标卡，注意到</p><script type="math/tex; mode=display">\begin{aligned}f\circ \mathbf{x}_\beta &= (f\circ \mathbf{x}_\alpha)\circ(\mathbf{x}^{-1}_\alpha\circ \mathbf{x}_{\beta}),\\f\circ \mathbf{x}_\alpha &= (f\circ \mathbf{x}_\beta)\circ(\mathbf{x}^{-1}_\beta\circ \mathbf{x}_{\alpha}),\end{aligned}</script><p>我们有 <script type="math/tex">f\circ \mathbf{x}_\beta</script> 可微当且仅当 <script type="math/tex">f\circ \mathbf{x}_\alpha</script> 可微．因此，如果给定的图册是相容的，我们对可微函数的定义就可以写成：函数 $f:M\to \mathbb{R}^m$ 在点 $p$ 处是可微的，当且仅当存在一个覆盖了点 $p$ 的坐标卡 <script type="math/tex">(U_\alpha,\mathbf{x}_\alpha)</script>，使得复合函数</p><script type="math/tex; mode=display">f\circ \mathbf{x}_\alpha:U_\alpha\longrightarrow \mathbb{R}^m</script><p>在点 $\mathbf{x}^{-1}_\alpha(p)$ 处是可微的．</p><h3 id="微分结构与微分流形"><a href="#微分结构与微分流形" class="headerlink" title="微分结构与微分流形"></a>微分结构与微分流形</h3><p>相容图册可以做极大化．设 <script type="math/tex">\Sigma=\{(U_\alpha,\mathbf{x}_\alpha)\}_{\alpha\in A}</script> 是拓扑流形 <script type="math/tex">(M,\tau)</script> 的一个相容图册，则</p><script type="math/tex; mode=display">\Sigma_{\max}=\{(U_\alpha,\mathbf{x}_\alpha)|(U_\alpha,\mathbf{x}_\alpha) \text{是 $M$ 的坐标卡，且与 $\Sigma$ 中的每一个坐标卡相容}\}</script><p>被称作 $\Sigma$ 的 <strong>极大化图册</strong>．拓扑流形 <script type="math/tex">(M,\tau)</script> 上的一个极大化相容图册 <script type="math/tex">\Sigma_{\max}</script>，被称作 <script type="math/tex">(M,\tau)</script> 的一种 <strong>微分结构</strong>．配备了微分结构的拓扑流形，就叫作 <strong>微分流形</strong>，记作三元组 <script type="math/tex">(M,\tau,\Sigma_{\max})</script>．如果没有特别声明，今后当我们谈论微分流形的坐标卡时，总是默认该坐标卡取自微分流形自带的图册．</p><p>如果我们将可微用 $C^r$ 可微或者光滑代替，可以类似地定义 $C^r$ 相容图册与光滑相容图册、$C^r$ 微分结构与光滑结构、$C^r$ 微分流形与光滑流形．今后我们将主要讨论光滑流形，但相关概念完全可以平行移植到微分流形与 $C^r$ 微分流形上．</p><h1 id="光滑映射"><a href="#光滑映射" class="headerlink" title="光滑映射"></a>光滑映射</h1><h2 id="定义-1"><a href="#定义-1" class="headerlink" title="定义"></a>定义</h2><p>我们定义光滑（可微）流形的动机之一，就是为了定义光滑（可微）函数．设 <script type="math/tex">(M,\tau,\Sigma)</script> 是一个光滑流形，函数 $f:M\to \mathbb{R}^n$ 在点 $p$ 处是 <strong>光滑</strong> 的，当且仅当存在一个覆盖了点 $p$ 的坐标卡 <script type="math/tex">(U_\alpha,\mathbf{x}_\alpha)\in\Sigma</script>，使得复合函数</p><script type="math/tex; mode=display">f\circ \mathbf{x}_\alpha:U_\alpha\longrightarrow \mathbb{R}^m</script><p>在点 $\mathbf{x}^{-1}_\alpha(p)$ 处是光滑的．</p><p>进一步，我们还可以在光滑流形 <script type="math/tex">(M_1,\tau_1,\Sigma_1), (M_2,\tau_2,\Sigma_2)</script> 之间定义光滑映射．为了定义映射 <script type="math/tex">f:M_1\to M_2</script> 在点 $p$ 处的光滑性，除了要将定义域从 <script type="math/tex">M_1</script> 的子集拉回到 <script type="math/tex">U_\alpha\subset\mathbb{R}^n</script>, 还要将到达域从 <script type="math/tex">M_2</script> 推前到 <script type="math/tex">V_\beta\subset\mathbb{R}^m</script>．</p><p>映射 <script type="math/tex">f:M_1\to M_2</script> 在点 $p$ 处是 <strong>光滑映射</strong>，如果存在一个覆盖了点 $p$ 的坐标卡 <script type="math/tex">(U_\alpha,\mathbf{x}_\alpha)\in\Sigma_1</script> 和一个覆盖了点 $f(p)$ 的坐标卡 <script type="math/tex">(V_\beta,\mathbf{y}_\beta)\in\Sigma_2</script>，使得复合映射</p><script type="math/tex; mode=display">\mathbf{y}^{-1}_\beta \circ f\circ \mathbf{x}_\alpha:U_\alpha\longrightarrow V_\beta</script><p>在点 $\mathbf{x}^{-1}_\alpha(p)$ 处是光滑的．</p><p>注意到</p><script type="math/tex; mode=display">f = \mathbf{y}_\beta\circ(\mathbf{y}^{-1}_\beta \circ f\circ \mathbf{x}_\alpha)\circ\mathbf{x}^{\hspace{2pt}-1}_\alpha</script><p>我们有 $f$ 在点 $p$ 处光滑蕴涵 $f$ 在点 $p$ 处连续．</p><p>又注意到</p><script type="math/tex; mode=display">\tilde{\mathbf{y}}^{-1}_\beta \circ f\circ \tilde{\mathbf{x}}_\alpha=(\tilde{\mathbf{y}}^{-1}_\beta\circ\mathbf{y}_\beta) \circ(\mathbf{y}^{-1}_\beta \circ f\circ \mathbf{x}_\alpha)\circ(\mathbf{x}^{-1}_\alpha\circ \tilde{\mathbf{x}}_\alpha),</script><p>可知 <script type="math/tex">f:M_1\to M_2</script> 在点 $p$ 处的光滑性不依赖于坐标卡的选取．</p><p>如果映射 <script type="math/tex">f:M_1\to M_2</script> 在开集 $U\subset M_1$ 的每一点都是光滑的，则称 $f$ 在 $U$ 上光滑．如果 $f$ 在 $M_1$ 的每一点都是光滑的，则称 <script type="math/tex">f:M_1\to M_2</script> 是光滑映射．</p><p>现在，我们已经定义好了光滑映射，但是我们定义光滑（可微）流形还有另一个一个动机————求微分．如果还是按照定义光滑映射的思路，用坐标卡把光滑映射转化成 <script type="math/tex">U_\alpha\in\mathbb{R}^n</script> 到 <script type="math/tex">\mathbb{R}^m</script> 的光滑函数，我们会发现，随着我们选取不同的坐标卡，我们会得到不同的光滑函数，自然也会求出不同的微分．一个最简单的例子就是一元实值光滑函数 <script type="math/tex">f:\mathbb{R}\to\mathbb{R}</script>．如果在点 $p$ 处选取不同的坐标卡 <script type="math/tex">(U_\alpha,x_\alpha),(V_\beta,y_\beta)</script>，微分</p><script type="math/tex; mode=display">d(y^{-1}_\beta \circ f\circ x_\alpha)|_p:\mathbb{R}\to\mathbb{R}</script><p>必然会不同．但是，这些不同的微分不可能毫无关联，因为它们之间差的只是转移函数的微分．类似的情形也发生在线性代数中．随着我们选取不同的基，一个线性变换会诱导出从坐标空间 <script type="math/tex">\mathbb{R}^n</script> 到坐标空间 <script type="math/tex">\mathbb{R}^m</script> 的不同变换．这些变换之间差的只是基变换．因此我们可以设想，光滑映射真正的“微分”，可能也是存在于一般的线性空间之间的线性映射．只有选取了特定的坐标卡，才会得到欧式空间 <script type="math/tex">\mathbb{R}^n</script> 与 <script type="math/tex">\mathbb{R}^m</script> 之间的线性映射．实际上，这里所谓的“一般的线性空间”，就是我们即将要定义的切空间．</p><h2 id="切向量与切空间"><a href="#切向量与切空间" class="headerlink" title="切向量与切空间"></a>切向量与切空间</h2><h3 id="第一种定义：曲线的等价类"><a href="#第一种定义：曲线的等价类" class="headerlink" title="第一种定义：曲线的等价类"></a>第一种定义：曲线的等价类</h3><p>考虑一个直观的例子，$\mathbb{R}^3$ 中的 $2$ 维光滑曲面．过曲面上任何一点 $p$，我们都可以作出一个切平面，而起点位于点 $p$ 、终点位于切平面内任一点的向量就是切向量．因此，该曲面在点 $p$ 处的切平面可以看成是由切向量组成的线性空间 $\mathbb{R}^2$．</p><p>对于任何一个切向量，他都可以看成是曲面上一条经过点 $p$ 的光滑曲线 $\gamma$ 在点 $p$ 处的切向量．如果曲线 $\gamma$ 的参数方程为 $\gamma(t)=(x(t),y(t),z(t))$，且满足 $\gamma(t_0)=p$，那么它在 $p$ 点处的导数</p><script type="math/tex; mode=display">\gamma'(t_0)=\left(\left.\frac{dx}{dt}\right|_{t_0},\left.\frac{dy}{dt}\right|_{t_0}, \left.\frac{dz}{dt}\right|_{t_0}\right)</script><p>就是它在该点的一个切向量．假设曲面上有另一条过点 $p$ 的曲线 $\theta$．如果 $\theta$ 和 $\gamma$ 在点 $p$ 处的导数相等，即 $\theta’(t_0)=\gamma’(t_0)$，那么这两条曲线其实对应的是同一个切向量．因此，一个切向量也可以看成是一个曲线的等价类，类中的所有曲线在点 $p$ 处拥有相同的导数．如果我们能将曲线和曲线导数的概念推广到一般的光滑流形上，我们就能用同样的方式为光滑流形定义切向量和切空间．</p><p>给定 $n$ 维光滑流形 <script type="math/tex">(M,\tau,\Sigma)</script> 和其上一点 $p$．如果光滑映射 $\gamma:(-\epsilon,\epsilon)\to M$ 满足 $\gamma(0)=p$，则称 $\gamma$ 是 $M$ 上一条过点 $p$ 的 <strong>光滑曲线</strong>．如果想对曲线“求导”，必须先进行参数化，也就是选定一个点 $p$ 处的坐标卡 $(U,\mathbf{x})\in\Sigma$，然后对复合函数</p><script type="math/tex; mode=display">\mathbf{x}^{-1} \circ \gamma:(-\epsilon,\epsilon)\to \mathbb{R}^n</script><p>进行求导．求导的结果即为 $\left.\frac{d(\mathbf{x} \circ \gamma)}{dt}\right|_0$．如果曲线 $\theta$ 和 $\gamma$ 在点 $p$ 处某个坐标卡 $(U_1,\mathbf{x}_1)$ 下有相同的导数，即</p><script type="math/tex; mode=display">\left.\frac{d(\mathbf{x}_1^{-1} \circ \theta)}{dt}\right|_0=\left.\frac{d(\mathbf{x}_1^{-1} \circ \gamma)}{dt}\right|_0,</script><p>那么在点 $p$ 处任意坐标卡 $(U_2,\mathbf{x}_2)$ 下，曲线 $\theta$ 和 $\gamma$ 也会有相同的导数．要证明这一点，只需注意到根据链式法则，</p><script type="math/tex; mode=display">\left.\frac{d(\mathbf{x}_2^{-1} \circ \theta)}{dt}\right|_0=\left.\frac{d((\mathbf{x}_2 \circ \mathbf{x}_1)\circ(\mathbf{x}_1^{-1} \circ \theta))}{dt}\right|_0=\left.\frac{d(\mathbf{x}_2^{-1} \circ \mathbf{x}_1)}{dx}\right|_p\left.\frac{d(\mathbf{x}_1^{-1} \circ \theta)}{dt}\right|_0.</script><p>因此我们可以定义：曲线 $\theta$ 和 $\gamma$ 在点 $p$ 处等价，当且仅当存在点 $p$ 处的坐标卡 $(U,\mathbf{x})$，使得</p><script type="math/tex; mode=display">\left.\frac{d(\mathbf{x}^{-1} \circ \theta)}{dt}\right|_0=\left.\frac{d(\mathbf{x}^{-1} \circ \gamma)}{dt}\right|_0.</script><p>记曲线 $\gamma$ 的等价类为 $[\gamma]_*$．而 $M$ 上所有过点 $p$ 的曲线在这种等价关系下的商集，就是 $M$ 在点 $p$ 处的切空间，记作</p><script type="math/tex; mode=display">T_pM=\{[\gamma]_*:\gamma\text{ 是 $M$ 一条上经过点 $p$ 的光滑曲线}\}.</script><h3 id="第二种定义：曲线导出的泛函"><a href="#第二种定义：曲线导出的泛函" class="headerlink" title="第二种定义：曲线导出的泛函"></a>第二种定义：曲线导出的泛函</h3><p>通过将切向量视作曲线的等价类，我们成功地将 $\mathbb{R}^n$ 中光滑曲面的切向量推广到了一般的光滑流形上．虽然这种切向量的定义比较直观，但如果想说明全体切向量构成的切空间是一个线性空间，我们还需要为曲线的等价类定义合适的加法与数乘运算．一个最直接的想法是，将曲线的等价类之和定义为曲线之和的等价类．但是，通过简单的尝试</p><script type="math/tex; mode=display">\gamma(0)=\theta(0)=p\implies (\gamma+\theta)(0)=2p\ne p,</script><p>我们就能发现 $M$ 上过点 $p$ 的全体光滑曲线在普通的加法下无法构成线性空间．因此很可惜，这种思路是行不通的．当然，我们还可以去尝试定义一种全新的加法，但这毕竟不太方便，也不太自然．更好的思路，或许是重新审视我们对切向量的定义．</p><p>切向量定义的核心是导数</p><script type="math/tex; mode=display">\left.\frac{d(\mathbf{x}^{-1} \circ \gamma)}{dt}\right|_0,</script><p>这是 $\mathbb{R}^n$ 中的一个 $n$ 维向量．设</p><script type="math/tex; mode=display">\begin{aligned}    p_i:\mathbb{R}^n&\longrightarrow \mathbb{R}\\    (x_1,x_2,\cdots,x_n)&\longmapsto x_i\end{aligned}</script><p>为 $\mathbb{R}^n$ 中的投影函数，</p><script type="math/tex; mode=display">\begin{aligned}    \tilde{x}_i=p_i\circ \mathbf{x}^{-1}:M&\longrightarrow \mathbb{R}\\    p&\longmapsto x_i\end{aligned}</script><p>为光滑流形 $M$ 在点 $p$ 处给定坐标卡 $(U,\mathbf{x})$ 的坐标函数，我们有</p><script type="math/tex; mode=display">\left(p_i\circ\left.\frac{d(\mathbf{x}^{-1} \circ \gamma)}{dt}\right)\right|_0=\left.\frac{d(p_i\circ\mathbf{x}^{-1} \circ \gamma)}{dt}\right|_0=\left.\frac{d(\tilde{x}_i \circ \gamma)}{dt}\right|_0.</script><p>于是，我们可以把导数展开写成</p><script type="math/tex; mode=display">\left.\frac{d(\mathbf{x}^{-1} \circ \gamma)}{dt}\right|_0=\left(\left.\frac{d(\tilde{x}_1 \circ \gamma)}{dt}\right|_0,\left.\frac{d(\tilde{x}_2 \circ \gamma)}{dt}\right|_0,\cdots,\left.\frac{d(\tilde{x}_n \circ \gamma)}{dt}\right|_0\right).</script><p>我们把定义在光滑流形 $M$ 上且在 $p$ 点处光滑的全体函数记作 $\mathcal{D}_p(M)$，不难看出 $\tilde{x}_1,\tilde{x}_2,\cdots,\tilde{x}_n$ 都属于 $\mathcal{D}_p(M)$．我们每确定一个导数值 $\left.\frac{d}{dt}(\mathbf{x}^{-1} \circ \gamma)\right|_0$, 也就确定了泛函</p><script type="math/tex; mode=display">\begin{aligned}    v_\gamma:=\left.\frac{d(\cdot \circ \gamma)}{dt}\right|_0:\mathcal{D}_p(M)&\longrightarrow \mathbb{R}\\    f&\longmapsto \left.\frac{d(f \circ \gamma)}{dt}\right|_0\end{aligned}</script><p>在 $\tilde{x}_1,\tilde{x}_2,\cdots,\tilde{x}_n$ 处的取值．事实上，泛函在 $\tilde{x}_1,\tilde{x}_2,\cdots,\tilde{x}_n$ 处的取值决定了它在整个 $\mathcal{D}_p(M)$ 上的取值．为了看清这一点，我们只需用坐标卡 $(U,\mathbf{x})$ 对 $f$ 和 $\gamma$ 作拉回和推前，并应用链式法则</p><script type="math/tex; mode=display">\left.\frac{d(f \circ\gamma)}{dt}\right|_0=\left.\frac{d((f \circ \mathbf{x})\circ (\mathbf{x}^{-1}\circ \gamma))}{dt}\right|_0=\sum_{i=1}^n\left.\frac{\partial (f \circ \mathbf{x})}{\partial x_i}\right|_{p}\left.\frac{d(\tilde{x}_i \circ \gamma)}{dt}\right|_0.</script><p>因此，任给一条 $M$ 上经过点 $p$ 的曲线 $\gamma$， $\gamma$ 的等价类 $[\gamma]_*$ 与 $\gamma$ 导出的泛函 $\left.\frac{d}{dt}(\cdot \circ \gamma)\right|_0$ 之间存在一一对应的关系．因此，泛函 $\left.\frac{d}{dt}(\cdot \circ \gamma)\right|_0$ 可以被视做切向量的另一种等价定义．</p><p>我们还可以验证，$v_\gamma=\left.\frac{d}{dt}(\cdot \circ \gamma)\right|_0$ 是一个线性泛函，即</p><script type="math/tex; mode=display">\left.\frac{d((f_1+f_2) \circ \gamma)}{dt}\right|_0=\left.\frac{d(f_1\circ \gamma+f_2\circ \gamma )}{dt}\right|_0=\left.\frac{d(f_1\circ \gamma)}{dt}\right|_0+\left.\frac{d(f_2\circ \gamma)}{dt}\right|_0,</script><script type="math/tex; mode=display">\left.\frac{d((kf) \circ \gamma)}{dt}\right|_0=\left.\frac{d(k(f \circ \gamma))}{dt}\right|_0=k\left.\frac{d(f \circ \gamma)}{dt}\right|_0.</script><p>设 $\mathcal{D}_p(M)^*$ 表示 $\mathcal{D}_p(M)$ 的对偶空间，即 $\mathcal{D}_p(M)$ 上的全体线性泛函构成的线性空间．进一步，我们可以相应给出切空间的定义</p><script type="math/tex; mode=display">T_pM=\left\{\left.\frac{d(\cdot \circ \gamma)}{dt}\right|_0\in\mathcal{D}_p(M)^*:\gamma\text{ 是 $M$ 上一条经过点 $p$ 的光滑曲线}\right\}.</script><p>设 $(U,\mathbf{x})$ 是点 $p$ 处的坐标卡，曲线</p><script type="math/tex; mode=display">\begin{aligned}    \varepsilon_i:(-\epsilon,\epsilon)&\longrightarrow M\\    t&\longmapsto\mathbf{x}(\tilde{x}_1(p),\cdots,\tilde{x}_i(p)+t,\cdots,\tilde{x}_n(p))\end{aligned}</script><p>被称作坐标卡 $(U,\mathbf{x})$ 的 <strong>$x_i$-曲线</strong>．</p><p>根据上面的公式，可以求出 $x_i$-曲线导出的泛函</p><script type="math/tex; mode=display">\left.\frac{d(f \circ\varepsilon_i)}{dt}\right|_0=\left.\frac{d((f \circ \mathbf{x})\circ (\mathbf{x}^{-1}\circ \varepsilon_i))}{dt}\right|_0=\sum_{k=1}^n\left.\frac{\partial (f \circ \mathbf{x})}{\partial x_k}\right|_{p}\left.\frac{d(\tilde{x}_k \circ \varepsilon_k)}{dt}\right|_0=\left.\frac{\partial (f \circ \mathbf{x})}{\partial x_i}\right|_{p}.</script><p>这 $n$ 个向量</p><script type="math/tex; mode=display">(v_{\varepsilon_1},v_{\varepsilon_2},\cdots,v_{\varepsilon_n})=\left(\left.\frac{\partial (\cdot \circ \mathbf{x})}{\partial x_1}\right|_{p},\left.\frac{\partial (\cdot \circ \mathbf{x})}{\partial x_2}\right|_{p},\cdots,\left.\frac{\partial (\cdot \circ \mathbf{x})}{\partial x_n}\right|_{p}\right)</script><p>被称作坐标卡 $(U,\mathbf{x})$ 的 <strong>坐标切向量</strong>．</p><p>记坐标切向量张成的线性空间为 <script type="math/tex">\mathop{\mathrm{span}}\limits_{1\le i \le n}(v_{\varepsilon_i})</script>．容易看出，$T_pM$ 中的任意切向量都可以写成是坐标切向量的线性组合</p><script type="math/tex; mode=display">v_\gamma(f)=\left.\frac{d(f \circ\gamma)}{dt}\right|_0=\sum_{i=1}^n\left.\frac{d(\tilde{x}_i \circ \gamma)}{dt}\right|_0\left.\frac{d(f \circ\varepsilon_i)}{dt}\right|_0=\sum_{i=1}^n\left.\frac{d(\tilde{x}_i \circ \gamma)}{dt}\right|_0v_{\varepsilon_i}(f),</script><p>即</p><script type="math/tex; mode=display">v_\gamma = \sum_{i=1}^n\left.\frac{d(\tilde{x}_i \circ \gamma)}{dt}\right|_0v_{\varepsilon_i},</script><p>故 <script type="math/tex">T_pM\subset \mathop{\mathrm{span}}\limits_{1\le i \le n}(v_{\varepsilon_i})</script>．反之，任给坐标切向量的线性组合 <script type="math/tex">\sum_{i=1}^n\lambda_iv_{\varepsilon_i}</script>，令曲线 $\varepsilon$ 为</p><script type="math/tex; mode=display">\begin{aligned}    \varepsilon:(-\epsilon,\epsilon)&\longrightarrow M\\    t&\longmapsto\mathbf{x}(\tilde{x}_1(p)+\lambda_1t,\tilde{x}_2(p)+\lambda_2t,\cdots,\tilde{x}_n(p)+\lambda_nt),\end{aligned}</script><p>则有</p><script type="math/tex; mode=display">v_\varepsilon(f)=\sum_{i=1}^n\left.\frac{d(\tilde{x}_i \circ \varepsilon)}{dt}\right|_0\left.\frac{d(f \circ\varepsilon_i)}{dt}\right|_0=\sum_{i=1}^n\lambda_iv_{\varepsilon_i}(f),</script><p>也即 <script type="math/tex">v_\varepsilon=\sum_{i=1}^n\lambda_iv_{\varepsilon_i}</script>．因此， <script type="math/tex">\mathop{\mathrm{span}}\limits_{1\le i \le n}(v_{\varepsilon_i})\subset T_pM</script>．综上可知，<script type="math/tex">T_pM=\mathop{\mathrm{span}}\limits_{1\le i \le n}(v_{\varepsilon_i})</script>，这就证明了 $T_pM$ 是一个线性空间．</p><p>进一步，我们还可以证明 <script type="math/tex">v_{\varepsilon_1},v_{\varepsilon_2},\cdots,v_{\varepsilon_n}</script> 是线性无关的．事实上，不难验证</p><script type="math/tex; mode=display">\left.\frac{d(\tilde{x}_j\circ\varepsilon_i)}{dt}\right|_0=\delta_{ij}=\begin{cases}0,& i\ne j,\\1,& i=j.\end{cases}</script><p>如果</p><script type="math/tex; mode=display">\sum_{i=1}^n\lambda_iv_{\varepsilon_i}=0,</script><p>让上式两边分别作用在 $\tilde{x}_j(1\le j\le n)$ 上可得</p><script type="math/tex; mode=display">\sum_{i=1}^n\lambda_iv_{\varepsilon_i}(\tilde{x}_i)=\sum_{i=1}^n\lambda_i\left.\frac{d(\tilde{x}_j\circ\varepsilon_i)}{dt}\right|_0=\lambda_j=0,</script><p>这就证明了线性无关．于是我们知道， 给定一个坐标卡 $(U,\mathbf{x})$，导出的坐标切向量 <script type="math/tex">v_{\varepsilon_1},v_{\varepsilon_2},\cdots,v_{\varepsilon_n}</script> 是线性空间 $T_pM$ 的一个基，这个基叫作切空间 $T_pM$ 在坐标卡 $(U,\mathbf{x})$ 下的 <strong>自然基底</strong>（associated basis）．切空间 $T_pM$ 的维数为 $n$．</p><h3 id="第三种定义：层论语言"><a href="#第三种定义：层论语言" class="headerlink" title="第三种定义：层论语言"></a>第三种定义：层论语言</h3><p>我们还可以使用层论的语言定义切向量与切空间．层论是一种更加抽象的理论，但它不仅适用于微分几何，还适用于更一般的几何．</p><p><strong>预层</strong>（presheaf）基本上来说就是一个反变函子（contravariant functor）．集合预层是某个范畴 $\mathsf{C}$ 到集合范畴 $\mathsf{Set}$ 的反变函子 $\mathcal{F}:\mathsf{C}^{\mathrm{op}}\to\mathsf{Set}$．交换群预层则是某个范畴 $\mathsf{C}$ 到交换群范畴 $\mathsf{Ab}$ 的反变函子 $\mathcal{F}:\mathsf{C}^{\mathrm{op}}\to\mathsf{Ab}$．任给 $\mathsf{C}$ 中一个对象 $X$，$\mathcal{F}(X)$ 的一个元素被称作 $\mathcal{F}$ 在 $X$ 上的一个 <strong>截面</strong>．</p><p>在研究某个光滑流形 $M$ 时，我们选定的 $\mathsf{C}$ 就是以 $M$ 的开集为对象、以开集间的包含映射（inclusion）为态射的范畴．我们考虑的预层则是某个开集 $X$ 上的全体光滑实值函数 $C^\infty(X;M\to\mathbb{R})$，在不至于混淆时可简记 $C^\infty(X)$．$C^\infty(\cdot)$ 可以是实线性空间预层、环预层或者交换实代数预层．</p><mjx-container class="MathJax" jax="SVG" display="true"><svg style="vertical-align: -6.236ex" xmlns="http://www.w3.org/2000/svg" width="18.781ex" height="13.604ex" role="img" focusable="false" viewBox="0 -3256.5 8301.4 6013" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="MJX-4-TEX-I-1D44B" d="M42 0H40Q26 0 26 11Q26 15 29 27Q33 41 36 43T55 46Q141 49 190 98Q200 108 306 224T411 342Q302 620 297 625Q288 636 234 637H206Q200 643 200 645T202 664Q206 677 212 683H226Q260 681 347 681Q380 681 408 681T453 682T473 682Q490 682 490 671Q490 670 488 658Q484 643 481 640T465 637Q434 634 411 620L488 426L541 485Q646 598 646 610Q646 628 622 635Q617 635 609 637Q594 637 594 648Q594 650 596 664Q600 677 606 683H618Q619 683 643 683T697 681T738 680Q828 680 837 683H845Q852 676 852 672Q850 647 840 637H824Q790 636 763 628T722 611T698 593L687 584Q687 585 592 480L505 384Q505 383 536 304T601 142T638 56Q648 47 699 46Q734 46 734 37Q734 35 732 23Q728 7 725 4T711 1Q708 1 678 1T589 2Q528 2 496 2T461 1Q444 1 444 10Q444 11 446 25Q448 35 450 39T455 44T464 46T480 47T506 54Q523 62 523 64Q522 64 476 181L429 299Q241 95 236 84Q232 76 232 72Q232 53 261 47Q262 47 267 47T273 46Q276 46 277 46T280 45T283 42T284 35Q284 26 282 19Q279 6 276 4T261 1Q258 1 243 1T201 2T142 2Q64 2 42 0Z"></path><path id="MJX-4-TEX-S4-2192" d="M56 237T56 250T70 270H835Q719 357 692 493Q692 494 692 496T691 499Q691 511 708 511H711Q720 511 723 510T729 506T732 497T735 481T743 456Q765 389 816 336T935 261Q944 258 944 250Q944 244 939 241T915 231T877 212Q836 186 806 152T761 85T740 35T732 4Q730 -6 727 -8T711 -11Q691 -11 691 0Q691 7 696 25Q728 151 835 230H70Q56 237 56 250Z"></path><path id="MJX-4-TEX-S4-2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"></path><path id="MJX-4-TEX-I-1D436" d="M50 252Q50 367 117 473T286 641T490 704Q580 704 633 653Q642 643 648 636T656 626L657 623Q660 623 684 649Q691 655 699 663T715 679T725 690L740 705H746Q760 705 760 698Q760 694 728 561Q692 422 692 421Q690 416 687 415T669 413H653Q647 419 647 422Q647 423 648 429T650 449T651 481Q651 552 619 605T510 659Q484 659 454 652T382 628T299 572T226 479Q194 422 175 346T156 222Q156 108 232 58Q280 24 350 24Q441 24 512 92T606 240Q610 253 612 255T628 257Q648 257 648 248Q648 243 647 239Q618 132 523 55T319 -22Q206 -22 128 53T50 252Z"></path><path id="MJX-4-TEX-N-221E" d="M55 217Q55 305 111 373T254 442Q342 442 419 381Q457 350 493 303L507 284L514 294Q618 442 747 442Q833 442 888 374T944 214Q944 128 889 59T743 -11Q657 -11 580 50Q542 81 506 128L492 147L485 137Q381 -11 252 -11Q166 -11 111 57T55 217ZM907 217Q907 285 869 341T761 397Q740 397 720 392T682 378T648 359T619 335T594 310T574 285T559 263T548 246L543 238L574 198Q605 158 622 138T664 94T714 61T765 51Q827 51 867 100T907 217ZM92 214Q92 145 131 89T239 33Q357 33 456 193L425 233Q364 312 334 337Q285 380 233 380Q171 380 132 331T92 214Z"></path><path id="MJX-4-TEX-N-28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path><path id="MJX-4-TEX-N-29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path><path id="MJX-4-TEX-I-1D456" d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z"></path><path id="MJX-4-TEX-S4-2193" d="M473 86Q483 86 483 67Q483 63 483 61T483 56T481 53T480 50T478 48T474 47T470 46T464 44Q428 35 391 14T316 -55T264 -168Q264 -170 263 -173T262 -180T261 -184Q259 -194 251 -194Q242 -194 238 -176T221 -121T180 -49Q169 -34 155 -21T125 2T95 20T67 33T44 42T27 47L21 49Q17 53 17 67Q17 87 28 87Q33 87 42 84Q158 52 223 -45L230 -55V312Q230 391 230 482T229 591Q229 662 231 676T243 693Q244 694 251 694Q264 692 270 679V-55L277 -45Q307 1 353 33T430 76T473 86Z"></path><path id="MJX-4-TEX-S4-23D0" d="M312 0V602H355V0H312Z"></path><path id="MJX-4-TEX-S4-2191" d="M27 414Q17 414 17 433Q17 437 17 439T17 444T19 447T20 450T22 452T26 453T30 454T36 456Q80 467 120 494T180 549Q227 607 238 678Q240 694 251 694Q259 694 261 684Q261 677 265 659T284 608T320 549Q340 525 363 507T405 479T440 463T467 455T479 451Q483 447 483 433Q483 413 472 413Q467 413 458 416Q342 448 277 545L270 555V-179Q262 -193 252 -193H250H248Q236 -193 230 -179V555L223 545Q192 499 146 467T70 424T27 414Z"></path><path id="MJX-4-TEX-N-2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path><path id="MJX-4-TEX-I-1D44C" d="M66 637Q54 637 49 637T39 638T32 641T30 647T33 664T42 682Q44 683 56 683Q104 680 165 680Q288 680 306 683H316Q322 677 322 674T320 656Q316 643 310 637H298Q242 637 242 624Q242 619 292 477T343 333L346 336Q350 340 358 349T379 373T411 410T454 461Q546 568 561 587T577 618Q577 634 545 637Q528 637 528 647Q528 649 530 661Q533 676 535 679T549 683Q551 683 578 682T657 680Q684 680 713 681T746 682Q763 682 763 673Q763 669 760 657T755 643Q753 637 734 637Q662 632 617 587Q608 578 477 424L348 273L322 169Q295 62 295 57Q295 46 363 46Q379 46 384 45T390 35Q390 33 388 23Q384 6 382 4T366 1Q361 1 324 1T232 2Q170 2 138 2T102 1Q84 1 84 9Q84 14 87 24Q88 27 89 30T90 35T91 39T93 42T96 44T101 45T107 45T116 46T129 46Q168 47 180 50T198 63Q201 68 227 171L252 274L129 623Q128 624 127 625T125 627T122 629T118 631T113 633T105 634T96 635T83 636T66 637Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mtable"><g data-mml-node="mtr" transform="translate(0, 1875)"><g data-mml-node="mtd"><g data-mml-node="mi"><use xlink:href="#MJX-4-TEX-I-1D44B"></use></g><g data-mml-node="mpadded" transform="translate(852, 0)"></g></g><g data-mml-node="mtd" transform="translate(1352, 0)"><g data-mml-node="mover"><g data-mml-node="mo"><use xlink:href="#MJX-4-TEX-S4-2192" transform="translate(1750, 0)"></use><svg width="1850" height="865" x="0" y="-182" viewBox="462.5 -182 1850 865"><use xlink:href="#MJX-4-TEX-S4-2212" transform="scale(3.567, 1)"></use></svg></g><g data-mml-node="mpadded" transform="translate(1138.1, 783) scale(0.707)"><g transform="translate(330, 100)"><g data-mml-node="TeXAtom" data-mjx-texclass="ORD"><g data-mml-node="msup"><g data-mml-node="mi"><use xlink:href="#MJX-4-TEX-I-1D436"></use></g><g data-mml-node="mi" transform="translate(812.3, 363) scale(0.707)"><use xlink:href="#MJX-4-TEX-N-221E"></use></g></g></g></g></g></g></g><g data-mml-node="mtd" transform="translate(4602, 0)"><g data-mml-node="msup"><g data-mml-node="mi"><use xlink:href="#MJX-4-TEX-I-1D436"></use></g><g data-mml-node="mi" transform="translate(812.3, 413) scale(0.707)"><use xlink:href="#MJX-4-TEX-N-221E"></use></g></g><g data-mml-node="mo" transform="translate(1569.4, 0)"><use xlink:href="#MJX-4-TEX-N-28"></use></g><g data-mml-node="mi" transform="translate(1958.4, 0)"><use xlink:href="#MJX-4-TEX-I-1D44B"></use></g><g data-mml-node="mo" transform="translate(2810.4, 0)"><use xlink:href="#MJX-4-TEX-N-29"></use></g></g></g><g data-mml-node="mtr" transform="translate(0, 0)"><g data-mml-node="mtd" transform="translate(92.5, 0)"><g data-mml-node="mrow"><g data-mml-node="mstyle" transform="scale(0.707)"><g data-mml-node="TeXAtom" data-mjx-texclass="ORD"><g data-mml-node="mpadded"><g transform="translate(-345, 0)"><g data-mml-node="TeXAtom" data-mjx-texclass="ORD"><g data-mml-node="mi"><use xlink:href="#MJX-4-TEX-I-1D456"></use></g></g></g></g></g></g><g data-mml-node="mo"><use xlink:href="#MJX-4-TEX-S4-2193" transform="translate(83.5, -431)"></use><svg width="667" height="962" y="163" x="0" viewBox="0 240.5 667 962"><use xlink:href="#MJX-4-TEX-S4-23D0" transform="scale(1, 2.397)"></use></svg></g></g></g><g data-mml-node="mtd" transform="translate(2727, 0)"></g><g data-mml-node="mtd" transform="translate(5868.2, 0)"><g data-mml-node="mrow"><g data-mml-node="mo"><use xlink:href="#MJX-4-TEX-S4-2191" transform="translate(83.5, 431)"></use><svg width="667" height="963" y="-625" x="0" viewBox="0 240.7 667 963"><use xlink:href="#MJX-4-TEX-S4-23D0" transform="scale(1, 2.4)"></use></svg></g><g data-mml-node="mstyle" transform="translate(667, 0) scale(0.707)"><g data-mml-node="TeXAtom" data-mjx-texclass="ORD"><g data-mml-node="mpadded"><g data-mml-node="TeXAtom" data-mjx-texclass="ORD"><g data-mml-node="msubsup"><g data-mml-node="mi"><use xlink:href="#MJX-4-TEX-I-1D456"></use></g><g data-mml-node="mo" transform="translate(345, 363) scale(0.707)"><use xlink:href="#MJX-4-TEX-N-2217"></use></g><g data-mml-node="mi" transform="translate(345, -275.2) scale(0.707)"><use xlink:href="#MJX-4-TEX-I-1D44B"></use></g></g></g></g></g></g></g></g><g data-mml-node="mtd" transform="translate(8301.4, 0)"></g></g><g data-mml-node="mtr" transform="translate(0, -2506.5)"><g data-mml-node="mtd" transform="translate(44.5, 0)"><g data-mml-node="mi"><use xlink:href="#MJX-4-TEX-I-1D44C"></use></g><g data-mml-node="mpadded" transform="translate(763, 0)"></g></g><g data-mml-node="mtd" transform="translate(1352, 0)"><g data-mml-node="mover"><g data-mml-node="mo"><use xlink:href="#MJX-4-TEX-S4-2192" transform="translate(1750, 0)"></use><svg width="1850" height="865" x="0" y="-182" viewBox="462.5 -182 1850 865"><use xlink:href="#MJX-4-TEX-S4-2212" transform="scale(3.567, 1)"></use></svg></g><g data-mml-node="mpadded" transform="translate(1138.1, 783) scale(0.707)"><g transform="translate(330, 100)"><g data-mml-node="TeXAtom" data-mjx-texclass="ORD"><g data-mml-node="msup"><g data-mml-node="mi"><use xlink:href="#MJX-4-TEX-I-1D436"></use></g><g data-mml-node="mi" transform="translate(812.3, 363) scale(0.707)"><use xlink:href="#MJX-4-TEX-N-221E"></use></g></g></g></g></g></g></g><g data-mml-node="mtd" transform="translate(4646.5, 0)"><g data-mml-node="msup"><g data-mml-node="mi"><use xlink:href="#MJX-4-TEX-I-1D436"></use></g><g data-mml-node="mi" transform="translate(812.3, 413) scale(0.707)"><use xlink:href="#MJX-4-TEX-N-221E"></use></g></g><g data-mml-node="mo" transform="translate(1569.4, 0)"><use xlink:href="#MJX-4-TEX-N-28"></use></g><g data-mml-node="mi" transform="translate(1958.4, 0)"><use xlink:href="#MJX-4-TEX-I-1D44C"></use></g><g data-mml-node="mo" transform="translate(2721.4, 0)"><use xlink:href="#MJX-4-TEX-N-29"></use></g></g></g></g></g></g></svg></mjx-container><p>给定 $M$ 中一点 $p$，将定义在包含点 $p$ 的开集上的光滑实值函数构成的集合记作</p><script type="math/tex; mode=display">\widetilde{\mathcal{C}}_p=\{(\varphi,X):p\in X,\varphi\in C^\infty(X)\}.</script><p>集合 $\widetilde{\mathcal{C}}_p$ 模掉等价关系</p><script type="math/tex; mode=display">(\varphi_1,X_1)\overset{p}\sim (\varphi_2,X_2)\iff\text{存在开集 }X_3\subset X_1\cap X_2,\text{使得 } \varphi_1|_{X_3}=\varphi_2|_{X_3}</script><p>得到的商集记作 $C^\infty_p$，称作点 $p$ 处的 <strong>光滑函数茎</strong>（stalk）．不难验证，光滑函数茎是一个交换实代数．光滑函数 $\varphi$ 所在的等价类记作 $[\varphi]_p$，称作 $\varphi$ 在点 $p$ 处的 <strong>光滑函数芽</strong>（germ）．</p><p>因为光滑函数芽内的所有光滑函数在点 $p$ 这个局部拥有完全相同的性质，所以将它们合并起来、不去计较它们之间的区别也是非常自然的．有了函数芽的语言，我们首先可以重写第二种定义．泛函 $\left.\frac{d}{dt}(\cdot \circ \gamma)\right|_0$ 之前是作用于定义在整个流形上且在点 $p$ 处光滑的函数 $f$，但 $f$ 在点 $p$ 某个邻域之外的性态其实是无用信息，甚至有没有定义都无关紧要．因此，我们完全可以设 $f$ 在点 $p$ 的某个开邻域内有定义，然后让 $\left.\frac{d}{dt}(\cdot \circ \gamma)\right|_0$ 直接作用于 $f$ 在点 $p$ 处的光滑函数芽 $[f]_p$，即定义</p><script type="math/tex; mode=display">\begin{aligned}    \left.\frac{d(\cdot \circ \gamma)}{dt}\right|_0:C^\infty_p&\longrightarrow \mathbb{R}\\    [f]_p&\longmapsto \left.\frac{d(f \circ \gamma)}{dt}\right|_0\end{aligned}</script><p>和</p><script type="math/tex; mode=display">T_pM=\left\{\left.\frac{d(\cdot \circ \gamma)}{dt}\right|_0\in (C^\infty_p)^*:\gamma\text{ 是 $M$ 上一条经过点 $p$ 的光滑曲线}\right\}.</script><p>其次，我们可以不借助曲线，用公理化的方式简洁地给出切向量的第三种定义：流形 $M$ 在点 $p$ 处的一个切向量就是一个定义在 $C^\infty_p$ 上的满足 Leibniz 律的线性函数．用形式化的方式写出来，就是</p><div class="note note-primary">            <p>给定光滑流形 $M$ 和其上一点 $p$．若函数 $\nu:C^\infty_p\to\mathbb{R}$ 满足：对任意 $\lambda_1,\lambda_2\in \mathbb{R}$，任意 $[f]_p,[g]_p\in C^\infty_p$，</p><ol><li>线性：$\nu\left(\lambda_1[f]_p+\lambda_2[g]_p\right)=\lambda_1\nu([f]_p)+\lambda_2\nu([g]_p)$，</li><li>Leibniz 律：$\nu\left([f]_p[g]_p\right)=[f]_p\,\nu\left([g]_p\right)+\nu([f]_p)[g]_p$，</li></ol><p>则称 $\nu$ 是流形 $M$ 在点 $p$ 处的一个切向量．流形 $M$ 在点 $p$ 处的切向量全体构成一个线性空间，记作 $T_pM$，称作 $M$ 在点 $p$ 处的切空间．</p>          </div><h2 id="切映射"><a href="#切映射" class="headerlink" title="切映射"></a>切映射</h2><p>在定义了切空间之后，我们终于可以为光滑映射定义一种微分的类似物了——切映射．</p><p>设光滑流形 <script type="math/tex">(M_1,\tau_1,\Sigma_1), (M_2,\tau_2,\Sigma_2)</script> 之间的映射 <script type="math/tex">f:M_1\to M_2</script> 在点 $p$ 处光滑．又设 $\gamma$ 是 <script type="math/tex">M_1</script> 上过点 <script type="math/tex">p</script> 的一条曲线，其对应的切向量为 <script type="math/tex">\left.\frac{d}{dt}(\cdot \circ \gamma)\right|_0</script>．让 $f$ 作用于 <script type="math/tex">\gamma</script>，就可以得到 $M_2$ 上过点 <script type="math/tex">f(p)</script> 的另一条曲线 <script type="math/tex">f(\gamma)</script> 及其对应的切向量 <script type="math/tex">\left.\frac{d}{dt}(\cdot \circ f(\gamma))\right|_0</script>．将切向量 <script type="math/tex">\left.\frac{d}{dt}(\cdot \circ \gamma)\right|_0\in T_pM_1</script> 映成 </p><script type="math/tex; mode=display">\left.\frac{d}{dt}(\cdot \circ f(\gamma))\right|_{0}\in T_{f(p)}M_2</script><p>的映射就叫做 <strong>切映射</strong>，记作 <script type="math/tex">(df)_p</script>．当然，要保证它是一个映射，我们要证明任给过点 $p$ 的曲线 <script type="math/tex">\gamma_1</script> 和 <script type="math/tex">\gamma_2</script>，只要 <script type="math/tex">\left.\frac{d}{dt}(\cdot \circ \gamma_1)\right|_0=\left.\frac{d}{dt}(\cdot \circ \gamma_2)\right|_0</script>，就有</p><script type="math/tex; mode=display">\left.\frac{d(\cdot \circ f(\gamma_1))}{dt}\right|_0=\left.\frac{d(\cdot \circ f(\gamma_2))}{dt}\right|_0.</script><p>我们在 $p$ 和 $f(p)$ 处分别选定坐标卡 <script type="math/tex">(U,\mathbf{x})\in\Sigma_1</script>, <script type="math/tex">(V,\mathbf{y})\in\Sigma_2</script>，并设这两个坐标卡对应的坐标函数分别为 <script type="math/tex">\tilde{x}_j=p_j\circ\mathbf{x}^{-1}</script> 和 <script type="math/tex">\tilde{y}_i=p_i\circ\mathbf{y}^{-1}</script>，对应的自然基底分别为 <script type="math/tex">v_{\varepsilon_1},v_{\varepsilon_2},\cdots,v_{\varepsilon_n}</script> 和 <script type="math/tex">v_{\eta_1},v_{\eta_2},\cdots,v_{\eta_m}</script>．注意到 $v_{f(\gamma)}$ 在自然基底下的表达式</p><script type="math/tex; mode=display">\begin{aligned}    v_{f(\gamma)}&=\left.\frac{d(\cdot \circ f(\gamma))}{dt}\right|_{0}\\    &=\sum_{i=1}^m\left.\frac{d(\tilde{y}_i \circ f(\gamma))}{dt}\right|_0v_{\eta_i}\\    &=\sum_{i=1}^m\left.\frac{d((\tilde{y}_i \circ f\circ\mathbf{x})\circ(\mathbf{x}^{-1}\circ\gamma))}{dt}\right|_0v_{\eta_i}\\    &=\sum_{i=1}^m\left.\frac{d(\tilde{y}_i \circ f\circ\mathbf{x})}{dx}\right|_{\mathbf{x}^{-1}(p)}\left.\frac{d(\mathbf{x}^{-1}\circ\gamma)}{dt}\right|_0v_{\eta_i}\\    &=\sum_{i=1}^m\sum_{j=1}^n\left.\frac{\partial(\tilde{y}_i \circ f\circ\mathbf{x})}{\partial x_j}\right|_{\mathbf{x}^{-1}(p)}\left.\frac{d(\tilde{x}_j\circ\gamma)}{dt}\right|_0v_{\eta_i}\end{aligned}</script><p>我们知道切映射确实是良定义的．此外，从上式可以看出，切映射是一个线性映射．</p><p>注意到</p><script type="math/tex; mode=display">\begin{aligned}    v_{f(\varepsilon_k)}&=\left.\frac{d(\cdot \circ f(\varepsilon_k))}{dt}\right|_{0}\\    &=\sum_{i=1}^m\sum_{j=1}^n\left.\frac{\partial(\tilde{y}_i \circ f\circ\mathbf{x})}{\partial x_j}\right|_{\mathbf{x}^{-1}(p)}\left.\frac{d(\tilde{x}_j\circ\varepsilon_k)}{dt}\right|_0v_{\eta_i}\\    &=\sum_{i=1}^m\left.\frac{\partial(\tilde{y}_i \circ f\circ\mathbf{x})}{\partial x_k}\right|_{\mathbf{x}^{-1}(p)}v_{\eta_i}\\    &=\begin{pmatrix}    v_{\eta_1}&v_{\eta_2}&\cdots&v_{\eta_m}    \end{pmatrix}    \begin{pmatrix}    \left.\frac{\partial(\tilde{y}_1 \circ f\circ\mathbf{x})}{\partial x_k}\right|_{\mathbf{x}^{-1}(p)}\\    \left.\frac{\partial(\tilde{y}_2 \circ f\circ\mathbf{x})}{\partial x_k}\right|_{\mathbf{x}^{-1}(p)}\\    \vdots\\    \left.\frac{\partial(\tilde{y}_m \circ f\circ\mathbf{x})}{\partial x_k}\right|_{\mathbf{x}^{-1}(p)}    \end{pmatrix},\end{aligned}</script><p>我们还可以进一步写出切映射 $(df)_p$ 在自然基底下的矩阵表示：</p><script type="math/tex; mode=display">\begin{aligned}    &\;\quad (df)_p    \begin{pmatrix}    v_{\varepsilon_1}&v_{\varepsilon_2}&\cdots&v_{\varepsilon_n}    \end{pmatrix}\\    &=    \begin{pmatrix}    (df)_pv_{\varepsilon_1}&(df)_pv_{\varepsilon_2}&\cdots&(df)_pv_{\varepsilon_n}    \end{pmatrix}\\    &=    \begin{pmatrix}    v_{f(\varepsilon_1)}&v_{f(\varepsilon_2)}&\cdots&v_{f(\varepsilon_n)}    \end{pmatrix}\\    &=    \begin{pmatrix}    v_{\eta_1}&v_{\eta_2}&\cdots&v_{\eta_m}    \end{pmatrix}    \left.\begin{pmatrix}        \frac{\partial(\tilde{y}_1 \circ f\circ\mathbf{x})}{\partial x_1}&\frac{\partial(\tilde{y}_1 \circ f\circ\mathbf{x})}{\partial x_2}&\cdots&\frac{\partial(\tilde{y}_1 \circ f\circ\mathbf{x})}{\partial x_n}\\        \frac{\partial(\tilde{y}_2 \circ f\circ\mathbf{x})}{\partial x_1}&\frac{\partial(\tilde{y}_2 \circ f\circ\mathbf{x})}{\partial x_2}&\cdots&\frac{\partial(\tilde{y}_2 \circ f\circ\mathbf{x})}{\partial x_n}\\        \vdots&\vdots&&\vdots\\        \frac{\partial(\tilde{y}_m \circ f\circ\mathbf{x})}{\partial x_1}&\frac{\partial(\tilde{y}_m \circ f\circ\mathbf{x})}{\partial x_2}&\cdots&\frac{\partial(\tilde{y}_m \circ f\circ\mathbf{x})}{\partial x_n}    \end{pmatrix}\right|_{\mathbf{x}^{-1}(p)}\\    &=    \begin{pmatrix}    v_{\eta_1}&v_{\eta_2}&\cdots&v_{\eta_m}    \end{pmatrix}    \begin{pmatrix}   \left.\frac{\partial(\tilde{y}_i \circ f\circ\mathbf{x})}{\partial x_j}\right|_{\mathbf{x}^{-1}(p)}   \end{pmatrix}_{m\times n}.\end{aligned}</script><p>我们发现，切映射 $(df)_p$ 在自然基底下的矩阵表示 </p><script type="math/tex; mode=display">J_pf:=\begin{pmatrix}   \left.\frac{\partial(\tilde{y}_i \circ f\circ\mathbf{x})}{\partial x_j}\right|_{\mathbf{x}^{-1}(p)}\end{pmatrix}_{m\times n}</script><p>正是函数 $\mathbf{y}^{-1}\circ f\circ\mathbf{x}$ 在 $\mathbf{x}^{-1}(p)$ 处的 Jacobi 矩阵．</p><h2 id="余切向量与余切空间"><a href="#余切向量与余切空间" class="headerlink" title="余切向量与余切空间"></a>余切向量与余切空间</h2><p>流形在点 $p$ 处的余切空间就是切空间 $T_pM$ 的对偶空间 <script type="math/tex">(T_pM)^*</script>，简记为 <script type="math/tex">T_p^*M</script>．余切空间中的向量称为余切向量．</p><p>因为 <script type="math/tex">T_pM\subset \left(C^\infty_p\right)^*$，所以 $T_p^*M\subset \left(C^\infty_p\right)^{**}</script>. 定义自然对（natural pairing）$\langle\cdot,\cdot\rangle$，它是如下双线性函数</p><script type="math/tex; mode=display">\begin{aligned}\langle\cdot,\cdot\rangle:T_pM\times C^\infty_p&\longrightarrow\mathbb{R}\\(v_\gamma,f)&\longmapsto\langle v_\gamma,f\rangle:=v_\gamma(f)=\left.\frac{d(f\circ \gamma)}{dt}\right|_{0}.\end{aligned}</script><p>任给 $f\in C^\infty_p$，定义</p><script type="math/tex; mode=display">\begin{aligned}\langle\cdot,f\rangle:T_pM&\longrightarrow\mathbb{R}\\v_\gamma&\longmapsto\langle v_\gamma,f\rangle,\end{aligned}</script><p>我们有 $\langle\cdot,f\rangle\in T_p^*M$．考虑线性映射 </p><script type="math/tex; mode=display">\begin{aligned}h:C^\infty_p&\longrightarrow T_p^*M\\f&\longmapsto\langle\cdot,f\rangle,\end{aligned}</script><p>根据 Riesz 表示定理，我们可以证明 <script type="math/tex">h(C^\infty_p)=T_p^*M</script>．这里，我们手动验证一下这个事实。给定坐标卡 $(U,\mathbf{x})$，我们有自然基底 <script type="math/tex">v_{\varepsilon_1},v_{\varepsilon_2},\cdots,v_{\varepsilon_n}</script>．</p><p>若</p><script type="math/tex; mode=display">\lambda_1\langle\cdot,\tilde{x}_1\rangle+\lambda_2\langle\cdot,\tilde{x}_2\rangle+\cdots+\lambda_n\langle\cdot,\tilde{x}_n\rangle=0,</script><p>注意到</p><script type="math/tex; mode=display">\langle v_{\varepsilon_j},\tilde{x}_i\rangle=\left.\frac{d(\tilde{x}_i\circ\varepsilon_j)}{dt}\right|_0=\delta_{ij},</script><p>让上式依次作用在自然基底的基向量 $v_{\varepsilon_j}(j=1,2\cdots,n)$ 上可得 $\lambda_j=0$．这就证明了 $\dim\left(h(C^\infty_p)\right)\ge n$．又因为</p><script type="math/tex; mode=display">\dim\left(h(C^\infty_p)\right)\le \dim\left(T_p^*M\right)=n,</script><p>我们最终证明了 $h(C^\infty_p)=T_p^*M$．</p>]]></content>
    
    
    <categories>
      
      <category>数学</category>
      
    </categories>
    
    
    <tags>
      
      <tag>数学</tag>
      
      <tag>几何</tag>
      
      <tag>微分流形</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>基于位置的动力学</title>
    <link href="/cn/2020/11/22/Position%20Based%20Dynamics/"/>
    <url>/cn/2020/11/22/Position%20Based%20Dynamics/</url>
    
    <content type="html"><![CDATA[<h1 id="算法描述"><a href="#算法描述" class="headerlink" title="算法描述"></a>算法描述</h1><p>物体的动力学可由 $N$ 个顶点和 $M$ 个关于顶点位置的约束进行描述．第 $i$ 个顶点的质量、位置、速度分别记作 <script type="math/tex">m_i,\mathbf{x}_i,\mathbf{v}_i</script>．第 $j$ 个约束可能为等式或不等式，记作</p><script type="math/tex; mode=display">C_{j}(\mathbf{x}_{1}, \cdots, \mathbf{x}_{N})=0\quad \text{或}\quad C_{j}(\mathbf{x}_{1}, \cdots, \mathbf{x}_{N})\ge0.</script><p>我们用符号 $\succ$ 来表示 $=$ 或 $\ge$，并且令 <script type="math/tex">\mathbf{x}=(\mathbf{x}_{1}, \cdots, \mathbf{x}_{N})</script>，则第 $j$ 个约束可简记为 <script type="math/tex">C_{j}(\mathbf{x})\succ 0</script>．</p><p>基于位置的动力学（Position Based Dynamics）简称为PBD．该算法会先计算出每个顶点的初始预测位置 <script type="math/tex">\mathbf{p}_i(i=1,2,\cdots,N)</script>，然后尝试移动 <script type="math/tex">\mathbf{p}_i(i=1,2,\cdots,N)</script> 使其满足所有约束</p><script type="math/tex; mode=display">C_j\succ 0(j=1,2,\cdots,M).</script><p>PBD的具体算法可由以下伪代码表示．</p><center>    <img style="border-radius: 0.3125em;    box-shadow: 0 2px 4px 0 rgba(34,36,38,.12),0 2px 10px 0 rgba(34,36,38,.08);"     src="/img/PBD/PBD_algorithm.png" width="90%">    <br>    <div style="color:orange;    font-size:14px;    display: inline-block;    color: #999;    padding: 10px;">图1 - PBD 伪代码</div></center><h1 id="求解器"><a href="#求解器" class="headerlink" title="求解器"></a>求解器</h1><p>在PBD伪代码中，第8至第10行是求解器的迭代求解．这里的函数</p><script type="math/tex; mode=display">\mathrm{ projectConstraints }\left(C_{1}, \cdots, C_{M + M_{\mathrm{Coll }}}, \mathbf{p}_{1}, \ldots, \mathbf{p}_{N}\right)</script><p>是方程/不等式组</p><script type="math/tex; mode=display">\left\{    \begin{array}{l}        C_{1}\left(\mathbf{p}_{1}, \cdots, \mathbf{p}_{N}\right)\succ 0, \\          C_{2}\left(\mathbf{p}_{1}, \cdots, \mathbf{p}_{N}\right)\succ 0, \\        \quad\ldots\\        C_{M + M_{\mathrm{Coll }}}\left(\mathbf{p}_{1}, \cdots, \mathbf{p}_{N}\right)\succ 0, \\    \end{array}\right.</script><p>的一个非线性Gauss-Seidel求解器．求解器 <script type="math/tex">\mathrm{ projectConstraints}</script> 会对约束 <script type="math/tex">C_{1},C_{2},\cdots,C_{M + M_{\mathrm{Coll }}}</script> 依次进行一阶线性化求解．每次求解完 <script type="math/tex">C_{j}</script>，求解器会当即更新 <script type="math/tex">\mathbf{p}_{1},\mathbf{p}_{2},\cdots,\mathbf{p}_{N}</script> 的值，使之影响对 <script type="math/tex">C_{j+1}</script> 的求解．下面我们将具体介绍 <script type="math/tex">C_{j}</script> 的求解方法．</p><p>如果约束是一个等式，我们希望找到一个 <script type="math/tex">\Delta \mathbf{p}</script> 使得 <script type="math/tex">C_{j}(\mathbf{p}+\Delta \mathbf{p})=0</script>，其中 <script type="math/tex">\mathbf{p}=\left(\mathbf{p}_{1}, \ldots, \mathbf{p}_{N}\right)</script>．对其进行一阶线性化可得</p><script type="math/tex; mode=display">C_{j}(\mathbf{p}+\Delta \mathbf{p})\approx C_{j}(\mathbf{p})+\nabla C_{j}(\mathbf{p}) \cdot \Delta \mathbf{p} = 0</script><p>上述方程的一般会有无穷个解．如果我们将解 <script type="math/tex">\Delta \mathbf{p}=\left(\Delta\mathbf{p}_{1},\Delta\mathbf{p}_{2},\cdots,\Delta\mathbf{p}_{N}\right)</script> 限制在</p><script type="math/tex; mode=display">\left(w_1\nabla_\mathbf{p_1} C_{j}(\mathbf{p}),w_2\nabla_\mathbf{p_2} C_{j}(\mathbf{p}),\cdots,w_N\nabla_\mathbf{p_N} C_{j}(\mathbf{p})\right)</script><p>的方向上，即令 </p><script type="math/tex; mode=display">\begin{equation}\Delta \mathbf{p}_i=\lambda w_i\nabla_{\mathbf{p}_i} C_{j}(\mathbf{p}),\quad i=1,2,\cdots,N,\end{equation}</script><p>我们就可以求出一个特解</p><script type="math/tex; mode=display">\Delta \mathbf{p}_i=-\frac{w_iC_j\left(\mathbf{p}\right)}{\sum_{k=1}^N w_{k}\left|\nabla_{\mathbf{p}_{j}} C_j\left(\mathbf{p}\right)\right|^{2}}\nabla_{\mathbf{p}_i} C_{j}(\mathbf{p}),\quad i=1,2,\cdots,N.</script><p>$C_{j}$ 的求解方法，就是用 <script type="math/tex">\mathbf{p}+\Delta \mathbf{p}</script> 来更新原来的 <script type="math/tex">\mathbf{p}</script>．因此，<script type="math/tex">\mathrm{projectConstraints}</script> 函数可用伪代码表示成</p><center>    <img style="border-radius: 0.3125em;    box-shadow: 0 2px 4px 0 rgba(34,36,38,.12),0 2px 10px 0 rgba(34,36,38,.08);"     src="/img/PBD/algorithm_project_constraints.svg" width="620">    <br>    <div style="color:orange;    font-size:14px;    display: inline-block;    color: #999;    padding: 10px;">图2 - $\mathrm{projectConstraints}$ 求解器伪代码</div></center><h1 id="特定约束"><a href="#特定约束" class="headerlink" title="特定约束"></a>特定约束</h1><h2 id="拉伸"><a href="#拉伸" class="headerlink" title="拉伸"></a>拉伸</h2><p>拉伸约束为</p><script type="math/tex; mode=display">C(\mathbf{p}_1,\mathbf{p}_2) = \left\Vert \mathbf{p}_1-\mathbf{p}_2\right\Vert - d,</script><p>其中 $d$ 代表初始长度。计算梯度，可得</p><script type="math/tex; mode=display">\begin{aligned}    \nabla_{\mathbf{p}_1} C(\mathbf{p}_1,\mathbf{p}_2)&=\nabla_{\mathbf{p}_1} \left\Vert \mathbf{p}_1-\mathbf{p}_2\right\Vert\\    &=\nabla_{\mathbf{p}_1} \left(\left(\mathbf{p}_{1x}-\mathbf{p}_{2x}\right)^2+\left(\mathbf{p}_{1y}-\mathbf{p}_{2y}\right)^2+\left(\mathbf{p}_{1z}-\mathbf{p}_{2z}\right)^2\right)^{\frac{1}{2}}\\    &=\frac{1}{2\left\Vert \mathbf{p}_1-\mathbf{p}_2\right\Vert}2(\mathbf{p}_1-\mathbf{p}_2)\\    &=\frac{\mathbf{p}_1-\mathbf{p}_2}{\left\Vert \mathbf{p}_1-\mathbf{p}_2\right\Vert},\end{aligned}</script><script type="math/tex; mode=display">\begin{aligned}    \nabla_{\mathbf{p}_2} C(\mathbf{p}_1,\mathbf{p}_2)&=\nabla_{\mathbf{p}_2} \left\Vert \mathbf{p}_1-\mathbf{p}_2\right\Vert\\    &=\nabla_{\mathbf{p}_2} \left(\left(\mathbf{p}_{1x}-\mathbf{p}_{2x}\right)^2+\left(\mathbf{p}_{1y}-\mathbf{p}_{2y}\right)^2+\left(\mathbf{p}_{1z}-\mathbf{p}_{2z}\right)^2\right)^{\frac{1}{2}}\\    &=\frac{1}{2\left\Vert \mathbf{p}_1-\mathbf{p}_2\right\Vert}2(\mathbf{p}_2-\mathbf{p}_1)\\    &=\frac{\mathbf{p}_2-\mathbf{p}_1}{\left\Vert \mathbf{p}_1-\mathbf{p}_2\right\Vert}.\end{aligned}</script><p>于是</p><script type="math/tex; mode=display">\begin{aligned}\lambda&=\frac{\left\Vert \mathbf{p}_1-\mathbf{p}_2\right\Vert - d}{w_1+w_2},\\\Delta \mathbf{p}_1&=-\frac{\left\Vert \mathbf{p}_1-\mathbf{p}_2\right\Vert - d}{w_1+w_2}w_1\frac{\mathbf{p}_1-\mathbf{p}_2}{\left\Vert \mathbf{p}_1-\mathbf{p}_2\right\Vert}=\frac{w_1}{w_1+w_2}\left(1-\frac{d}{\left\Vert \mathbf{p}_1-\mathbf{p}_2\right\Vert}\right)(\mathbf{p}_2-\mathbf{p}_1),\\\Delta \mathbf{p}_2&=-\frac{\left\Vert \mathbf{p}_1-\mathbf{p}_2\right\Vert - d}{w_1+w_2}w_2\frac{\mathbf{p}_2-\mathbf{p}_1}{\left\Vert \mathbf{p}_1-\mathbf{p}_2\right\Vert}=\frac{w_2}{w_1+w_2}\left(1-\frac{d}{\left\Vert \mathbf{p}_1-\mathbf{p}_2\right\Vert}\right)(\mathbf{p}_1-\mathbf{p}_2).\end{aligned}</script><h2 id="SDF碰撞"><a href="#SDF碰撞" class="headerlink" title="SDF碰撞"></a>SDF碰撞</h2><p>SDF碰撞约束为</p><script type="math/tex; mode=display">C(\mathbf{p}_i) = \mathrm{SDF}(\mathbf{p}_i).</script><p>矫正量</p><script type="math/tex; mode=display">\Delta\mathbf{p}_i = - \frac{\mathrm{SDF}(\mathbf{p}_i)}{w_i\left\Vert\nabla_{\mathbf{p}_i}\mathrm{SDF}(\mathbf{p}_i)\right\Vert^2}w_i\nabla_{\mathbf{p}_i}\mathrm{SDF}(\mathbf{p}_i)= -\frac{\mathrm{SDF}(\mathbf{p}_i)}{\left\Vert\nabla_{\mathbf{p}_i}\mathrm{SDF}(\mathbf{p}_i)\right\Vert^2}\nabla_{\mathbf{p}_i}\mathrm{SDF}(\mathbf{p}_i).</script><h3 id="例子：球面SDF碰撞"><a href="#例子：球面SDF碰撞" class="headerlink" title="例子：球面SDF碰撞"></a>例子：球面SDF碰撞</h3><p>给定半径为 $r$ 的球面，它的SDF碰撞约束为</p><script type="math/tex; mode=display">C(\mathbf{p}_i) = \left\Vert\mathbf{p}_i\right\Vert-r.</script><p>矫正量</p><script type="math/tex; mode=display">\Delta\mathbf{p}_i = -\frac{\left\Vert\mathbf{p}_i\right\Vert-r}{\left\Vert\mathbf{p}_i\right\Vert^2/\left\Vert\mathbf{p}_i\right\Vert^2}\frac{\mathbf{p}_i}{\left\Vert\mathbf{p}_i\right\Vert}=\left(\frac{r}{\left\Vert\mathbf{p}_i\right\Vert}-1\right)\mathbf{p}_i.</script><h3 id="数值微分的计算"><a href="#数值微分的计算" class="headerlink" title="数值微分的计算"></a>数值微分的计算</h3><p>我们可以使用四面体技巧对 SDF 数值微分的计算进行优化。设</p><script type="math/tex; mode=display">\begin{aligned}    \mathbf{k}_0&=(1,-1,-1)\\    \mathbf{k}_1&=(-1,-1,1)\\    \mathbf{k}_2&=(-1,1,-1)\\    \mathbf{k}_3&=(1,1,1)\\.\end{aligned}</script><p>考虑求和</p><script type="math/tex; mode=display">\begin{aligned}m &=\sum_{i=0}^3 \mathbf{k}_{i}\frac{f\left(\mathbf{p}+h \mathbf{k}_{i}\right)}{\sqrt{3}h} \\&=\sum_{i=0}^3 \mathbf{k}_{i} \frac{f\left(\mathbf{p}+h \mathbf{k}_{i}\right)-f(\mathbf{p})}{\sqrt{3}h}\\&\approx\sum_{i=0}^3\mathbf{k}_{i} \nabla_{\widehat{\mathbf{k}}_{i}}f(\mathbf{p})\\&=\sum_{i=0}^3\begin{pmatrix}k_{ix}\\k_{iy}\\k_{iz}\\\end{pmatrix}\left(\widehat{k}_{ix},\widehat{k}_{iy},\widehat{k}_{iz}\right)\begin{pmatrix}\nabla_{x}f(\mathbf{p})\\\nabla_{y}f(\mathbf{p})\\\nabla_{z}f(\mathbf{p})\end{pmatrix}\\&=\frac{1}{\sqrt{3}}\sum_{i=0}^3\begin{pmatrix}k_{ix}^2&k_{ix}k_{iy}&k_{ix}k_{iz}\\k_{ix}k_{iy}&k_{iy}^2&k_{iy}k_{iz}\\k_{ix}k_{iz}&k_{iy}k_{iz}&k_{iz}\end{pmatrix}\begin{pmatrix}\nabla_{x}f(\mathbf{p})\\\nabla_{y}f(\mathbf{p})\\\nabla_{z}f(\mathbf{p})\\\end{pmatrix}\\&=\frac{4}{\sqrt{3}}\nabla f(\mathbf{p})\end{aligned}.</script><p>由此可以得到</p><script type="math/tex; mode=display">\nabla f(\mathbf{p})\approx\sum_{i=0}^3 \mathbf{k}_{i}\frac{f\left(\mathbf{p}+h \mathbf{k}_{i}\right)}{4h}</script>]]></content>
    
    
    <categories>
      
      <category>计算机图形</category>
      
    </categories>
    
    
    <tags>
      
      <tag>计算机图形</tag>
      
      <tag>物理模拟</tag>
      
      <tag>PBD</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>路径追踪渲染算法</title>
    <link href="/cn/2020/10/13/Path%20Tracing%20Rendering%20Algorithm/"/>
    <url>/cn/2020/10/13/Path%20Tracing%20Rendering%20Algorithm/</url>
    
    <content type="html"><![CDATA[<h1 id="Monte-Carlo-积分方法"><a href="#Monte-Carlo-积分方法" class="headerlink" title="Monte Carlo 积分方法"></a>Monte Carlo 积分方法</h1><h2 id="重要性采样"><a href="#重要性采样" class="headerlink" title="重要性采样"></a>重要性采样</h2><p>Monte Carlo 积分方法是一种求解定积分的数值方法．假定需要计算的是下面的积分</p><script type="math/tex; mode=display">I=\int_a^b f(x)dx.</script><p>先选取一个连续型随机变量 $X$，要求其概率密度函数 $p(x)$ 满足</p><script type="math/tex; mode=display">\forall x\in[a,b],\quad p(x)>0.</script><p>然后令 $Y=g(X)=\frac{f(X)}{p(X)}$．注意到</p><script type="math/tex; mode=display">\mathrm{E}\left[Y\right]=\mathrm{E}\left[\frac{f(X)}{p(X)}\right]=\int_{a}^{b} \frac{f\left(x\right)}{p\left(x\right)} p\left(x\right) d x=I,</script><p>我们可以将求解定积分 $I$ 的任务，直接转化为估计随机变量 $Y$ 的期望 $\mathrm{E}\left[Y\right]$.</p><p>估计 $\mathrm{E}\left[Y\right]$ 的一个常见做法，就是用 $Y$ 为总体进行简单随机抽样，然后以样本均值</p><script type="math/tex; mode=display">\overline{Y}=\frac{1}{N}\sum_{i=1}^N Y_i</script><p>作为 $\mathrm{E}\left[Y\right]$ 的估计量．具体方案如下：</p><blockquote><p>设 $X_i\sim p(x)(i=1,2,\cdots,n)$ 是独立同分布的 $n$ 个随机变量，则 $Y_i=\frac{f(X_i)}{p(X_i)}$ 也是独立同分布的 $n$ 个随机变量．令</p><script type="math/tex; mode=display">I_N=\frac{1}{N}\sum_{i=1}^N\frac{f(X_i)}{p(X_i)}=\frac{1}{N}\sum_{i=1}^N Y_i,</script><p>以 $I_N$ 作为 $\mathrm{E}\left[Y\right]=I$ 的估计量．</p></blockquote><p>统计学告诉我们：样本均值是总体期望的一致无偏估计量．这里我们可以再次证明一下这个结论．首先，$I_N$ 的期望为</p><script type="math/tex; mode=display">\begin{aligned}\mathrm{E}\left[I_{N}\right]&=\mathrm{E}\left[\frac{1}{N}\sum_{i=1}^N Y_i\right]=\frac{1}{N}\mathrm{E}\left[\sum_{i=1}^N Y\right] = \mathrm{E}\left[Y\right] =I,\end{aligned}</script><p>这说明 $I_N$ 是无偏的．其次，当 $N\to\infty$ 时，$I_N$ 的方差</p><script type="math/tex; mode=display">\begin{aligned}\mathrm{Var}\left[I_{N}\right]&=\mathrm{Var}\left[\frac{1}{N} \sum_{i=1}^{N} Y_i\right]\\ &=\frac{1}{N^2} \sum_{i=1}^{N} \mathrm{Var}\left[Y_i\right] \\&=\frac{1}{N} \mathrm{Var}\left[Y\right] \to 0,\end{aligned}</script><p>这说明 $I_N$ 是一致的．证明完毕．</p><p>对于一个估计量，我们总希望减小它的方差．估计量 $I_{N}$ 的方差表达式为</p><script type="math/tex; mode=display">\mathrm{Var}\left[I_{N}\right]=\frac{1}{N} \mathrm{Var}\left[\frac{f(X)}{p(X)}\right].</script><p>我们清楚的是：当 $p(x)=kf(x)$ 时，也即 $p(x)=\frac{1}{I}f(x)$ 时，方差会取得最小值 $0$．但是，求出 $I$ 是不可能的，因为这正是我们 Monte Carlo 积分方法的求解目标．我们所能做的，只是让 $p(x)$ 的形态尽量与 $f(x)$ 相接近．这种削减方差的手段叫作 <strong>重要性采样</strong>（importance sampling）．$f(x)$ 取值越大的区域，对积分的贡献会越多，也就越重要，需要更多的采样．</p><p>如果我们简单地让 $X$ 服从 $[a,b]$ 上的均匀分布．此时估计量为</p><script type="math/tex; mode=display">I_N=\frac{b-a}{N}\sum_{i=1}^Nf(X_i).</script><p>直觉上看，这就是将积分区间等分成 $N$ 段，用 $N$ 个面积为 <script type="math/tex">\frac{b-a}{N}\cdot f(X_i)</script> 的矩形来估计曲边梯形．如果我们希望在某个子区间采样数翻倍，那么这个子区间需要分成两半，将一个矩形换成宽度为 $\frac{b-a}{2N}$ 的两个矩形．推而广之就是采样概率越大的区域，单个样本的权重就越小．这也是为什么 $I_{N}$ 中要除以 $p(X_i)$ 的原因．</p><h2 id="多重重要性采样"><a href="#多重重要性采样" class="headerlink" title="多重重要性采样"></a>多重重要性采样</h2><p>假定需要计算的是下面的积分</p><script type="math/tex; mode=display">I=\int_a^b f(x)g(x)dx,</script><p>并且已知概率密度函数 $p_X(x)$ 和 $p_Y(x)$ 分别能较好地吻合 $f(x)$ 和 $g(x)$ 的形状，即它们分别能对</p><script type="math/tex; mode=display">\int_a^b f(x)dx,\,\int_a^b g(x)dx</script><p>进行较好地重要性采样，那么该如何对 $I$ 进行重要性采样呢？</p><p>很容易想到的一种方法是用 $p_X(x)p_Y(x)$ 进行重要性采样，但是，有些时候为总体 $Z\sim p_X(x)p_Y(x)$ 生成样本 $Z_i$ 比较困难．这时，<strong>多重重要性采样</strong>（multiple importance sampling）不失为一种好的选择．</p><p>设 $X_i\sim p_X(x)$，$Y_i\sim p_Y(x)$，多重重要性采样使用了如下估计量</p><script type="math/tex; mode=display">I_{n_{f},n_g}=\frac{1}{n_{f}} \sum_{i=1}^{n_{f}} \frac{f\left(X_{i}\right) g\left(X_{i}\right) w_{f}\left(X_{i}\right)}{p_{X}\left(X_{i}\right)}+\frac{1}{n_{g}} \sum_{j=1}^{n_{g}} \frac{f\left(Y_{j}\right) g\left(Y_{j}\right) w_{g}\left(Y_{j}\right)}{p_{Y}\left(Y_{j}\right)},</script><p>其中 $w_f(x),w_g(x)$ 是满足 $w_f(x)+w_g(x)=1$ 的权重函数．可以验证</p><script type="math/tex; mode=display">\begin{aligned}\mathrm{E}\left[I_{n_{f},n_g}\right]&= \mathrm{E}\left[\frac{f\left(X\right) g\left(X\right) w_{f}\left(X\right)}{p_{X}\left(X\right)}\right]+\mathrm{E}\left[\frac{f\left(Y\right) g\left(Y\right) w_{g}\left(Y\right)}{p_{Y}\left(Y\right)}\right]\\&=\int_a^b\frac{f\left(x\right) g\left(x\right) w_{f}\left(x\right)}{p_X(x)}p_X(x)dx+\int_a^b\frac{f\left(x\right) g\left(x\right) w_{g}\left(x\right)}{p_Y(x)}p_Y(x)dx\\&=\int_a^bf\left(x\right) g\left(x\right) w_{f}\left(x\right)dx+\int_a^bf\left(x\right) g\left(x\right) w_{g}\left(x\right)dx\\&=\int_a^bf\left(x\right) g\left(x\right) (w_{f}\left(x\right)+w_{g}\left(x\right))\:dx\\&=\int_a^bf\left(x\right) g\left(x\right)dx,\end{aligned}</script><p>即 <script type="math/tex">I_{n_{f},n_{g}}</script> 确实是 $I$ 的无偏估计量．实践中，常使用如下形式的启发式权重函数</p><script type="math/tex; mode=display">w_{f}(x)=\frac{\left(n_{f} p_{X}(x)\right)^{\beta}}{\left(n_{f} p_{X}(x)\right)^{\beta}+\left(n_{g} p_{Y}(x)\right)^{\beta}},\quad w_{g}(x)=\frac{\left(n_{g} p_{Y}(x)\right)^{\beta}}{\left(n_{f} p_{X}(x)\right)^{\beta}+\left(n_{g} p_{Y}(x)\right)^{\beta}}.</script><p>当 $\beta=2$ 时，往往效果会较好．</p><h1 id="光线传输方程"><a href="#光线传输方程" class="headerlink" title="光线传输方程"></a>光线传输方程</h1><h2 id="基本形式"><a href="#基本形式" class="headerlink" title="基本形式"></a>基本形式</h2><p>之前我们已经见过了反射方程</p><script type="math/tex; mode=display">L_o(\mathbf{p},\boldsymbol{\omega}_o)=\int_{H^2}f_{\mathrm{r}}\left(\mathbf{p}, \boldsymbol{\omega}_o, \boldsymbol{\omega}_i\right)L_i(\mathbf{p},\boldsymbol{\omega}_i)\cos\theta_i\:d\Omega_i.</script><p>如果我们将描述表面反射的双向反射分布函数 $f_{\mathrm{r}}\left(\mathbf{p}, \boldsymbol{\omega}_o, \boldsymbol{\omega}_i\right)$ 替换为双向散射分布函数 $f\left(\mathbf{p}, \boldsymbol{\omega}_o, \boldsymbol{\omega}_i\right)$，并加入自发光辐照率 $L_e(\mathbf{p},\boldsymbol{\omega}_o)$，那么就得到了如下含自发光项的散射方程</p><script type="math/tex; mode=display">L_o(\mathbf{p},\boldsymbol{\omega}_o)=L_e(\mathbf{p},\boldsymbol{\omega}_o)+\int_{S^2}f\left(\mathbf{p}, \boldsymbol{\omega}_o, \boldsymbol{\omega}_i\right)L_i(\mathbf{p},\boldsymbol{\omega}_i)\left|\cos\theta_i\right|d\Omega_i.</script><p>注意到在上式中，$L_e(\mathbf{p},\boldsymbol{\omega}_o)$ 和 $f\left(\mathbf{p}, \boldsymbol{\omega}_o, \boldsymbol{\omega}_i\right)$ 都是已知量．如果我们能将函数 $L_i$ 用函数 $L_o$ 表示出来，那么我们将得到一个只含 $L_o$ 的积分方程．为了实现这一点，我们需要引入 <strong>光线投射函数</strong>（ray-casting function）$t(\mathbf{p},\boldsymbol{\omega})$．假设在 $\mathbf{p}$ 点向 $\boldsymbol{\omega}$ 方向发出一条射线，射线第一次与场景中某个表面相交的位置就记作 $t(\mathbf{p},\boldsymbol{\omega})$．于是，我们得到</p><script type="math/tex; mode=display">L_i(\mathbf{p},\boldsymbol{\omega}_i)=L_o(t(\mathbf{p},\boldsymbol{\omega}_i),-\boldsymbol{\omega}_i).</script><p>为了处理射线不与场景中任何表面相交的特殊情况，我们规定此时 $t(\mathbf{p},\boldsymbol{\omega})$ 取特殊值 $\Lambda$，并且对任意 $\boldsymbol{\omega}$，有 $L_o(\Lambda,\boldsymbol{\omega})=0$．</p><p>利用上面的关系式，并将 $L_o(\mathbf{p},\boldsymbol{\omega}_o)$ 简记为 $L(\mathbf{p},\boldsymbol{\omega}_o)$，由此导出的方程就称为 <strong>光线传输方程</strong>（light transport equation）</p><script type="math/tex; mode=display">L(\mathbf{p},\boldsymbol{\omega}_o)=L_e(\mathbf{p},\boldsymbol{\omega}_o)+\int_{S^2}f\left(\mathbf{p}, \boldsymbol{\omega}_o, \boldsymbol{\omega}_i\right)L(t(\mathbf{p},\boldsymbol{\omega}_i),-\boldsymbol{\omega}_i)\left|\cos\theta_i\right|d\Omega_i.</script><p>光线传输方程也叫做称渲染方程（rendering equation），它是关于函数 $L(\mathbf{p},\boldsymbol{\omega}_o)$ 的积分方程，描述了均衡状态下物体表面任意一点、沿任意方向的辐照率．实际上，我们可以也可以得到场景中任意一点、沿任意方向的辐照率，因为借助前面导出的关系式</p><script type="math/tex; mode=display">L(\mathbf{p},\boldsymbol{\omega})=L(t(\mathbf{p},\boldsymbol{\omega}),-\boldsymbol{\omega}),</script><p>我们可以将场景中的辐照率转化为物体表面的辐照率． </p><h2 id="表面形式"><a href="#表面形式" class="headerlink" title="表面形式"></a>表面形式</h2><p>在上面的光线传输方程中，场景中物体表面的几何信息全部隐藏在了光线投射函数 $t(\mathbf{p},\boldsymbol{\omega})$ 里．为了让这些信息显式地表达出来，我们将导出表面形式的光线传输方程．</p><p>之前在对某点各个方向上的入射光做积分时，我们是在单位球上做积分．考虑到某点接收的入射光实际上来自于其他物体表面各点的出射光，我们也可以把单位球上的积分转化为其他物体表面上的积分．如果我们要用蒙特卡洛积分法估计该积分，那么我们的采样区域将从单位球转到其他物体的表面．</p><p>下面引入一些记号．如果从 $\mathbf{p}^\prime$ 点沿 $\boldsymbol{\omega}$ 方向出发的射线经过了 $\mathbf{p}$ 点，我们记</p><script type="math/tex; mode=display">L(\mathbf{p}^\prime\to\mathbf{p}):=L(\mathbf{p}^\prime,\boldsymbol{\omega})=L\left(\mathbf{p}^\prime,\frac{\mathbf{p}-\mathbf{p}^\prime}{\Vert\mathbf{p}-\mathbf{p}^\prime\Vert}\right).</script><p>如下图所示，</p><center>    <img style="border-radius: 0.3125em;    box-shadow: 0 2px 4px 0 rgba(34,36,38,.12),0 2px 10px 0 rgba(34,36,38,.08);"     src="/img/path_tracing_rendering_algorithm/three_point_form.svg" width="400">     <br>    <div style="color:orange;    font-size:14px;    display: inline-block;    color: #999;    padding: 10px;">图1 - $f(\mathbf{p}^{\prime\prime}\to\mathbf{p}^\prime\to\mathbf{p})$ 示意图</div></center><p>如果 $t(\mathbf{p}^\prime,\boldsymbol{\omega}_o)=\mathbf{p}$，$t(\mathbf{p}^\prime,\boldsymbol{\omega}_i)=\mathbf{p}^{\prime\prime}$，我们记</p><script type="math/tex; mode=display">f(\mathbf{p}^{\prime\prime}\to\mathbf{p}^\prime\to\mathbf{p}):=f\left(\mathbf{p}, \boldsymbol{\omega}_o, \boldsymbol{\omega}_i\right)=f\left(\mathbf{p}^\prime,\frac{\mathbf{p}-\mathbf{p}^\prime}{\Vert\mathbf{p}-\mathbf{p}^\prime\Vert},\frac{\mathbf{p}^{\prime\prime}-\mathbf{p}^\prime}{\Vert\mathbf{p}^{\prime\prime}-\mathbf{p}^\prime\Vert}\right).</script><p>设 $V\left(\mathbf{p} \leftrightarrow \mathbf{p}^{\prime}\right)$ 是可视性函数，当 $\mathbf{p}$ 与 $\mathbf{p}^{\prime}$ 两点之间没有遮挡、相互可见时，即</p><script type="math/tex; mode=display">t\left(\mathbf{p},\frac{\mathbf{p}^\prime-\mathbf{p}}{\Vert\mathbf{p}^\prime-\mathbf{p}\Vert}\right)=\mathbf{p}^\prime,\quadt\left(\mathbf{p}^\prime,\frac{\mathbf{p}-\mathbf{p}^\prime}{\Vert\mathbf{p}-\mathbf{p}^\prime\Vert}\right)=\mathbf{p}</script><p>时，$V\left(\mathbf{p} \leftrightarrow \mathbf{p}^{\prime}\right)$ 取值为 $1$；否则 $V\left(\mathbf{p} \leftrightarrow \mathbf{p}^{\prime}\right)$ 取值为 $0$．</p><p>设几何耦合项（geometric coupling term）为可视性函数与积分区域转换映射的 Jacobi 行列式的乘积，即</p><script type="math/tex; mode=display">G\left(\mathbf{p} \leftrightarrow \mathbf{p}^{\prime}\right)=V\left(\mathbf{p} \leftrightarrow \mathbf{p}^{\prime}\right) \frac{|\cos \theta|\left|\cos \theta^{\prime}\right|}{\left\|\mathbf{p}-\mathbf{p}^{\prime}\right\|^{2}},</script><p>其中 $\theta$ 为 $\mathbf{p}$ 点处法向量与 $\mathbf{p}^\prime-\mathbf{p}$ 的夹角， $\theta^\prime$ 为 $\mathbf{p}^\prime$ 点处法向量与 $\mathbf{p}-\mathbf{p}^\prime$ 的夹角．</p><p>当 $V\left(\mathbf{p} \leftrightarrow \mathbf{p}^{\prime}\right)=1$ 时，光线传输方程可以重写成场景中所有物体表面 $A$ 上的积分</p><script type="math/tex; mode=display">L\left(\mathbf{p}^{\prime} \rightarrow \mathbf{p}\right)=L_{\mathrm{e}}\left(\mathbf{p}^{\prime} \rightarrow \mathbf{p}\right)+\int_{A} f\left(\mathbf{p}^{\prime \prime} \rightarrow \mathbf{p}^{\prime} \rightarrow \mathbf{p}\right) L\left(\mathbf{p}^{\prime \prime} \rightarrow \mathbf{p}^{\prime}\right) G\left(\mathbf{p}^{\prime \prime} \leftrightarrow \mathbf{p}^{\prime}\right)\: d A\left(\mathbf{p}^{\prime \prime}\right).</script><p>这就是表面形式的光线传输方程．</p><h2 id="路径积分形式"><a href="#路径积分形式" class="headerlink" title="路径积分形式"></a>路径积分形式</h2><p>表面形式的光线传输方程给出了 $L\left(\mathbf{p}_{i+1} \rightarrow \mathbf{p}_i\right)$ 关于 $i$ 的递推关系</p><script type="math/tex; mode=display">\begin{aligned}&L\left(\mathbf{p}_{i+1} \rightarrow \mathbf{p}_i\right)\\=\;&L_{\mathrm{e}}\left(\mathbf{p}_{i+1} \rightarrow \mathbf{p}_i\right)+\int_{A} f\left(\mathbf{p}_{i+2} \rightarrow \mathbf{p}_{i+1}\rightarrow \mathbf{p}_i\right) L\left(\mathbf{p}_{i+2}\rightarrow \mathbf{p}_{i+1}\right) G\left(\mathbf{p}_{i+2}\leftrightarrow \mathbf{p}_{i+1}\right)\: d A\left(\mathbf{p}_{i+2}\right).\end{aligned}</script><p>从 <script type="math/tex">i=0</script> 出发，先将等式右边的 <script type="math/tex">L\left(\mathbf{p}_{2}\rightarrow\mathbf{p}_{1}\right)</script> 用 <script type="math/tex">L\left(\mathbf{p}_{3}\rightarrow \mathbf{p}_{2}\right)</script> 表示，再将先将等式右边的 <script type="math/tex">L\left(\mathbf{p}_{3}\rightarrow \mathbf{p}_{2}\right)</script> 用 <script type="math/tex">L\left(\mathbf{p}_{4}\rightarrow \mathbf{p}_{3}\right)</script> 表示，以此类推，最终将得到如下等式</p><script type="math/tex; mode=display">\begin{aligned}L\left(\mathbf{p}_{1} \rightarrow \mathbf{p}_{0}\right)&=L_{\mathrm{e}} \left(\mathbf{p}_{1} \rightarrow \mathbf{p}_{0}\right) \\&\quad+\int_{A} L_{\mathrm{e}}\left(\mathbf{p}_{2} \rightarrow \mathbf{p}_{1}\right) f\left(\mathbf{p}_{2} \rightarrow \mathbf{p}_{1} \rightarrow \mathbf{p}_{0}\right) G\left(\mathbf{p}_{2} \leftrightarrow \mathbf{p}_{1}\right)\: d A\left(\mathbf{p}_{2}\right) \\&\quad+\int_{A} \int_{A} L_{\mathrm{e}}\left(\mathbf{p}_{3} \rightarrow \mathbf{p}_{2}\right) f\left(\mathbf{p}_{3} \rightarrow \mathbf{p}_{2} \rightarrow \mathbf{p}_{1}\right) G\left(\mathbf{p}_{3} \leftrightarrow \mathbf{p}_{2}\right)\\&\quad\quad\times f\left(\mathbf{p}_{2} \rightarrow \mathbf{p}_{1} \rightarrow \mathbf{p}_{0}\right) G\left(\mathbf{p}_{2} \leftrightarrow \mathbf{p}_{1}\right) \:d A\left(\mathbf{p}_{3}\right) d A\left(\mathbf{p}_{2}\right)\\&\quad+\cdots\end{aligned}</script><p>记</p><script type="math/tex; mode=display">T\left(\overline{\mathbf{p}}_{n}\right):=\prod_{i=1}^{n-1} f\left(\mathbf{p}_{i+1} \rightarrow \mathbf{p}_{i} \rightarrow \mathbf{p}_{i-1}\right) G\left(\mathbf{p}_{i+1} \leftrightarrow \mathbf{p}_{i}\right)</script><p>为路径 <script type="math/tex">\overline{\mathbf{p}}_{n}=(\mathbf{p}_n,\mathbf{p}_{n-1},\cdots,\mathbf{p}_{0})</script> 的吞吐量（throughput），又令</p><mjx-container class="MathJax" jax="SVG" display="true"><svg style="vertical-align: -5.69ex" xmlns="http://www.w3.org/2000/svg" width="60.399ex" height="8.769ex" role="img" focusable="false" viewBox="0 -1361 26696.2 3876.1" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="MJX-1-TEX-I-1D443" d="M287 628Q287 635 230 637Q206 637 199 638T192 648Q192 649 194 659Q200 679 203 681T397 683Q587 682 600 680Q664 669 707 631T751 530Q751 453 685 389Q616 321 507 303Q500 302 402 301H307L277 182Q247 66 247 59Q247 55 248 54T255 50T272 48T305 46H336Q342 37 342 35Q342 19 335 5Q330 0 319 0Q316 0 282 1T182 2Q120 2 87 2T51 1Q33 1 33 11Q33 13 36 25Q40 41 44 43T67 46Q94 46 127 49Q141 52 146 61Q149 65 218 339T287 628ZM645 554Q645 567 643 575T634 597T609 619T560 635Q553 636 480 637Q463 637 445 637T416 636T404 636Q391 635 386 627Q384 621 367 550T332 412T314 344Q314 342 395 342H407H430Q542 342 590 392Q617 419 631 471T645 554Z"></path><path id="MJX-1-TEX-N-28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path><path id="MJX-1-TEX-B-1D429" d="M32 442L123 446Q214 450 215 450H221V409Q222 409 229 413T251 423T284 436T328 446T382 450Q480 450 540 388T600 223Q600 128 539 61T361 -6H354Q292 -6 236 28L227 34V-132H296V-194H287Q269 -191 163 -191Q56 -191 38 -194H29V-132H98V113V284Q98 330 97 348T93 370T83 376Q69 380 42 380H29V442H32ZM457 224Q457 303 427 349T350 395Q282 395 235 352L227 345V104L233 97Q274 45 337 45Q383 45 420 86T457 224Z"></path><path id="MJX-1-TEX-S4-AF" d="M69 544V590H430V544H69Z"></path><path id="MJX-1-TEX-I-1D45B" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"></path><path id="MJX-1-TEX-N-29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path><path id="MJX-1-TEX-N-3A" d="M78 370Q78 394 95 412T138 430Q162 430 180 414T199 371Q199 346 182 328T139 310T96 327T78 370ZM78 60Q78 84 95 102T138 120Q162 120 180 104T199 61Q199 36 182 18T139 0T96 17T78 60Z"></path><path id="MJX-1-TEX-N-3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path><path id="MJX-1-TEX-LO-222B" d="M114 -798Q132 -824 165 -824H167Q195 -824 223 -764T275 -600T320 -391T362 -164Q365 -143 367 -133Q439 292 523 655T645 1127Q651 1145 655 1157T672 1201T699 1257T733 1306T777 1346T828 1360Q884 1360 912 1325T944 1245Q944 1220 932 1205T909 1186T887 1183Q866 1183 849 1198T832 1239Q832 1287 885 1296L882 1300Q879 1303 874 1307T866 1313Q851 1323 833 1323Q819 1323 807 1311T775 1255T736 1139T689 936T633 628Q574 293 510 -5T410 -437T355 -629Q278 -862 165 -862Q125 -862 92 -831T55 -746Q55 -711 74 -698T112 -685Q133 -685 150 -700T167 -741Q167 -789 114 -798Z"></path><path id="MJX-1-TEX-I-1D434" d="M208 74Q208 50 254 46Q272 46 272 35Q272 34 270 22Q267 8 264 4T251 0Q249 0 239 0T205 1T141 2Q70 2 50 0H42Q35 7 35 11Q37 38 48 46H62Q132 49 164 96Q170 102 345 401T523 704Q530 716 547 716H555H572Q578 707 578 706L606 383Q634 60 636 57Q641 46 701 46Q726 46 726 36Q726 34 723 22Q720 7 718 4T704 0Q701 0 690 0T651 1T578 2Q484 2 455 0H443Q437 6 437 9T439 27Q443 40 445 43L449 46H469Q523 49 533 63L521 213H283L249 155Q208 86 208 74ZM516 260Q516 271 504 416T490 562L463 519Q447 492 400 412L310 260L413 259Q516 259 516 260Z"></path><path id="MJX-1-TEX-N-22EF" d="M78 250Q78 274 95 292T138 310Q162 310 180 294T199 251Q199 226 182 208T139 190T96 207T78 250ZM525 250Q525 274 542 292T585 310Q609 310 627 294T646 251Q646 226 629 208T586 190T543 207T525 250ZM972 250Q972 274 989 292T1032 310Q1056 310 1074 294T1093 251Q1093 226 1076 208T1033 190T990 207T972 250Z"></path><path id="MJX-1-TEX-S4-E152" d="M-24 327L-18 333H-1Q11 333 15 333T22 329T27 322T35 308T54 284Q115 203 225 162T441 120Q454 120 457 117T460 95V60V28Q460 8 457 4T442 0Q355 0 260 36Q75 118 -16 278L-24 292V327Z"></path><path id="MJX-1-TEX-S4-E153" d="M-10 60V95Q-10 113 -7 116T9 120Q151 120 250 171T396 284Q404 293 412 305T424 324T431 331Q433 333 451 333H468L474 327V292L466 278Q375 118 190 36Q95 0 8 0Q-5 0 -7 3T-10 24V60Z"></path><path id="MJX-1-TEX-S4-E151" d="M-10 60Q-10 104 -10 111T-5 118Q-1 120 10 120Q96 120 190 84Q375 2 466 -158L474 -172V-207L468 -213H451H447Q437 -213 434 -213T428 -209T423 -202T414 -187T396 -163Q331 -82 224 -41T9 0Q-4 0 -7 3T-10 25V60Z"></path><path id="MJX-1-TEX-S4-E150" d="M-18 -213L-24 -207V-172L-16 -158Q75 2 260 84Q334 113 415 119Q418 119 427 119T440 120Q454 120 457 117T460 98V60V25Q460 7 457 4T441 0Q308 0 193 -55T25 -205Q21 -211 18 -212T-1 -213H-18Z"></path><path id="MJX-1-TEX-S4-E154" d="M-10 0V120H410V0H-10Z"></path><path id="MJX-1-TEX-N-2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"></path><path id="MJX-1-TEX-N-31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path><path id="MJX-1-TEX-I-1D43F" d="M228 637Q194 637 192 641Q191 643 191 649Q191 673 202 682Q204 683 217 683Q271 680 344 680Q485 680 506 683H518Q524 677 524 674T522 656Q517 641 513 637H475Q406 636 394 628Q387 624 380 600T313 336Q297 271 279 198T252 88L243 52Q243 48 252 48T311 46H328Q360 46 379 47T428 54T478 72T522 106T564 161Q580 191 594 228T611 270Q616 273 628 273H641Q647 264 647 262T627 203T583 83T557 9Q555 4 553 3T537 0T494 -1Q483 -1 418 -1T294 0H116Q32 0 32 10Q32 17 34 24Q39 43 44 45Q48 46 59 46H65Q92 46 125 49Q139 52 144 61Q147 65 216 339T285 628Q285 635 228 637Z"></path><path id="MJX-1-TEX-N-65" d="M28 218Q28 273 48 318T98 391T163 433T229 448Q282 448 320 430T378 380T406 316T415 245Q415 238 408 231H126V216Q126 68 226 36Q246 30 270 30Q312 30 342 62Q359 79 369 104L379 128Q382 131 395 131H398Q415 131 415 121Q415 117 412 108Q393 53 349 21T250 -11Q155 -11 92 58T28 218ZM333 275Q322 403 238 411H236Q228 411 220 410T195 402T166 381T143 340T127 274V267H333V275Z"></path><path id="MJX-1-TEX-N-2192" d="M56 237T56 250T70 270H835Q719 357 692 493Q692 494 692 496T691 499Q691 511 708 511H711Q720 511 723 510T729 506T732 497T735 481T743 456Q765 389 816 336T935 261Q944 258 944 250Q944 244 939 241T915 231T877 212Q836 186 806 152T761 85T740 35T732 4Q730 -6 727 -8T711 -11Q691 -11 691 0Q691 7 696 25Q728 151 835 230H70Q56 237 56 250Z"></path><path id="MJX-1-TEX-I-1D447" d="M40 437Q21 437 21 445Q21 450 37 501T71 602L88 651Q93 669 101 677H569H659Q691 677 697 676T704 667Q704 661 687 553T668 444Q668 437 649 437Q640 437 637 437T631 442L629 445Q629 451 635 490T641 551Q641 586 628 604T573 629Q568 630 515 631Q469 631 457 630T439 622Q438 621 368 343T298 60Q298 48 386 46Q418 46 427 45T436 36Q436 31 433 22Q429 4 424 1L422 0Q419 0 415 0Q410 0 363 1T228 2Q99 2 64 0H49Q43 6 43 9T45 27Q49 40 55 46H83H94Q174 46 189 55Q190 56 191 56Q196 59 201 76T241 233Q258 301 269 344Q339 619 339 625Q339 630 310 630H279Q212 630 191 624Q146 614 121 583T67 467Q60 445 57 441T43 437H40Z"></path><path id="MJX-1-TEX-I-1D451" d="M366 683Q367 683 438 688T511 694Q523 694 523 686Q523 679 450 384T375 83T374 68Q374 26 402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487H491Q506 153 506 145Q506 140 503 129Q490 79 473 48T445 8T417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157Q33 205 53 255T101 341Q148 398 195 420T280 442Q336 442 364 400Q369 394 369 396Q370 400 396 505T424 616Q424 629 417 632T378 637H357Q351 643 351 645T353 664Q358 683 366 683ZM352 326Q329 405 277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q233 26 290 98L298 109L352 326Z"></path><path id="MJX-1-TEX-N-32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path><path id="MJX-1-TEX-N-2C" d="M78 35T78 60T94 103T137 121Q165 121 187 96T210 8Q210 -27 201 -60T180 -117T154 -158T130 -185T117 -194Q113 -194 104 -185T95 -172Q95 -168 106 -156T131 -126T157 -76T173 -3V9L172 8Q170 7 167 6T161 3T152 1T140 0Q113 0 96 17Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mi"><use xlink:href="#MJX-1-TEX-I-1D443"></use></g><g data-mml-node="mrow" transform="translate(751, 0)"><g data-mml-node="mo"><use xlink:href="#MJX-1-TEX-N-28"></use></g><g data-mml-node="msub" transform="translate(389, 0)"><g data-mml-node="mover"><g data-mml-node="TeXAtom" data-mjx-texclass="ORD"><g data-mml-node="mi"><use xlink:href="#MJX-1-TEX-B-1D429"></use></g></g><g data-mml-node="mo" transform="translate(0, 265.3) scale(0.707)"><svg width="903.7" height="246" x="0" y="444" viewBox="225.9 444 903.7 246"><use xlink:href="#MJX-1-TEX-S4-AF" transform="scale(2.711, 1)"></use></svg></g></g><g data-mml-node="TeXAtom" transform="translate(639, -229.4) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><use xlink:href="#MJX-1-TEX-I-1D45B"></use></g></g></g><g data-mml-node="mo" transform="translate(1502.3, 0)"><use xlink:href="#MJX-1-TEX-N-29"></use></g></g><g data-mml-node="mo" transform="translate(2920, 0)"><use xlink:href="#MJX-1-TEX-N-3A"></use><use xlink:href="#MJX-1-TEX-N-3D" transform="translate(278, 0)"></use></g><g data-mml-node="munder" transform="translate(4253.8, 0)"><g data-mml-node="TeXAtom" data-mjx-texclass="OP"><g data-mml-node="munder"><g data-mml-node="mrow"><g data-mml-node="msub"><g data-mml-node="mo"><use xlink:href="#MJX-1-TEX-LO-222B"></use></g><g data-mml-node="TeXAtom" transform="translate(556, -896.4) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><use xlink:href="#MJX-1-TEX-I-1D434"></use></g></g></g><g data-mml-node="msub" transform="translate(1303, 0)"><g data-mml-node="mo"><use xlink:href="#MJX-1-TEX-LO-222B"></use></g><g data-mml-node="TeXAtom" transform="translate(556, -896.4) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><use xlink:href="#MJX-1-TEX-I-1D434"></use></g></g></g><g data-mml-node="mo" transform="translate(2606, 0)"><use xlink:href="#MJX-1-TEX-N-22EF"></use></g><g data-mml-node="msub" transform="translate(3944.7, 0)"><g data-mml-node="mo"><use xlink:href="#MJX-1-TEX-LO-222B"></use></g><g data-mml-node="TeXAtom" transform="translate(556, -896.4) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><use xlink:href="#MJX-1-TEX-I-1D434"></use></g></g></g></g><g data-mml-node="mo" transform="translate(0, -1276.4)"><use xlink:href="#MJX-1-TEX-S4-E152"></use><use xlink:href="#MJX-1-TEX-S4-E153" transform="translate(4631, 0)"></use><g data-c="E156" transform="translate(2090.5, 0)"><use xlink:href="#MJX-1-TEX-S4-E151"></use><use xlink:href="#MJX-1-TEX-S4-E150" transform="translate(450, 0)"></use></g><svg width="1840.5" height="720" x="350" y="-300" viewBox="460.1 -300 1840.5 720"><use xlink:href="#MJX-1-TEX-S4-E154" transform="scale(6.902, 1)"></use></svg><svg width="1840.5" height="720" x="2890.5" y="-300" viewBox="460.1 -300 1840.5 720"><use xlink:href="#MJX-1-TEX-S4-E154" transform="scale(6.902, 1)"></use></svg></g></g></g><g data-mml-node="TeXAtom" transform="translate(1664.4, -2273.7) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><use xlink:href="#MJX-1-TEX-I-1D45B"></use></g><g data-mml-node="mo" transform="translate(600, 0)"><use xlink:href="#MJX-1-TEX-N-2212"></use></g><g data-mml-node="mn" transform="translate(1378, 0)"><use xlink:href="#MJX-1-TEX-N-31"></use></g><g data-mml-node="mtext" transform="translate(1878, 0)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="773.5px" font-family="serif">个</text></g></g></g><g data-mml-node="msub" transform="translate(9334.8, 0)"><g data-mml-node="mi"><use xlink:href="#MJX-1-TEX-I-1D43F"></use></g><g data-mml-node="TeXAtom" transform="translate(681, -150) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="TeXAtom" data-mjx-texclass="ORD"><g data-mml-node="mi"><use xlink:href="#MJX-1-TEX-N-65"></use></g></g></g></g><g data-mml-node="mrow" transform="translate(10379.8, 0)"><g data-mml-node="mo"><use xlink:href="#MJX-1-TEX-N-28"></use></g><g data-mml-node="msub" transform="translate(389, 0)"><g data-mml-node="TeXAtom" data-mjx-texclass="ORD"><g data-mml-node="mi"><use xlink:href="#MJX-1-TEX-B-1D429"></use></g></g><g data-mml-node="TeXAtom" transform="translate(639, -229.4) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><use xlink:href="#MJX-1-TEX-I-1D45B"></use></g></g></g><g data-mml-node="mo" transform="translate(1780, 0)"><use xlink:href="#MJX-1-TEX-N-2192"></use></g><g data-mml-node="msub" transform="translate(3057.8, 0)"><g data-mml-node="TeXAtom" data-mjx-texclass="ORD"><g data-mml-node="mi"><use xlink:href="#MJX-1-TEX-B-1D429"></use></g></g><g data-mml-node="TeXAtom" transform="translate(639, -229.4) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><use xlink:href="#MJX-1-TEX-I-1D45B"></use></g><g data-mml-node="mo" transform="translate(600, 0)"><use xlink:href="#MJX-1-TEX-N-2212"></use></g><g data-mml-node="mn" transform="translate(1378, 0)"><use xlink:href="#MJX-1-TEX-N-31"></use></g></g></g><g data-mml-node="mo" transform="translate(5074.8, 0)"><use xlink:href="#MJX-1-TEX-N-29"></use></g></g><g data-mml-node="mi" transform="translate(15843.5, 0)"><use xlink:href="#MJX-1-TEX-I-1D447"></use></g><g data-mml-node="mrow" transform="translate(16547.5, 0)"><g data-mml-node="mo"><use xlink:href="#MJX-1-TEX-N-28"></use></g><g data-mml-node="msub" transform="translate(389, 0)"><g data-mml-node="mover"><g data-mml-node="TeXAtom" data-mjx-texclass="ORD"><g data-mml-node="mi"><use xlink:href="#MJX-1-TEX-B-1D429"></use></g></g><g data-mml-node="mo" transform="translate(0, 265.3) scale(0.707)"><svg width="903.7" height="246" x="0" y="444" viewBox="225.9 444 903.7 246"><use xlink:href="#MJX-1-TEX-S4-AF" transform="scale(2.711, 1)"></use></svg></g></g><g data-mml-node="TeXAtom" transform="translate(639, -229.4) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><use xlink:href="#MJX-1-TEX-I-1D45B"></use></g></g></g><g data-mml-node="mo" transform="translate(1502.3, 0)"><use xlink:href="#MJX-1-TEX-N-29"></use></g></g><g data-mml-node="mstyle" transform="translate(18438.8, 0)"><g data-mml-node="mspace"></g></g><g data-mml-node="mi" transform="translate(18661, 0)"><use xlink:href="#MJX-1-TEX-I-1D451"></use></g><g data-mml-node="mi" transform="translate(19181, 0)"><use xlink:href="#MJX-1-TEX-I-1D434"></use></g><g data-mml-node="mrow" transform="translate(19931, 0)"><g data-mml-node="mo"><use xlink:href="#MJX-1-TEX-N-28"></use></g><g data-mml-node="msub" transform="translate(389, 0)"><g data-mml-node="TeXAtom" data-mjx-texclass="ORD"><g data-mml-node="mi"><use xlink:href="#MJX-1-TEX-B-1D429"></use></g></g><g data-mml-node="TeXAtom" transform="translate(639, -229.4) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mn"><use xlink:href="#MJX-1-TEX-N-32"></use></g></g></g><g data-mml-node="mo" transform="translate(1431.6, 0)"><use xlink:href="#MJX-1-TEX-N-29"></use></g></g><g data-mml-node="mo" transform="translate(21918.2, 0)"><use xlink:href="#MJX-1-TEX-N-22EF"></use></g><g data-mml-node="mi" transform="translate(23256.9, 0)"><use xlink:href="#MJX-1-TEX-I-1D451"></use></g><g data-mml-node="mi" transform="translate(23776.9, 0)"><use xlink:href="#MJX-1-TEX-I-1D434"></use></g><g data-mml-node="mrow" transform="translate(24526.9, 0)"><g data-mml-node="mo"><use xlink:href="#MJX-1-TEX-N-28"></use></g><g data-mml-node="msub" transform="translate(389, 0)"><g data-mml-node="TeXAtom" data-mjx-texclass="ORD"><g data-mml-node="mi"><use xlink:href="#MJX-1-TEX-B-1D429"></use></g></g><g data-mml-node="TeXAtom" transform="translate(639, -229.4) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><use xlink:href="#MJX-1-TEX-I-1D45B"></use></g></g></g><g data-mml-node="mo" transform="translate(1502.3, 0)"><use xlink:href="#MJX-1-TEX-N-29"></use></g></g><g data-mml-node="mo" transform="translate(26418.2, 0)"><use xlink:href="#MJX-1-TEX-N-2C"></use></g></g></g></svg></mjx-container><p>我们可以将 <script type="math/tex">L\left(\mathbf{p}_{1}\to\mathbf{p}_{0}\right)</script> 写成级数形式</p><script type="math/tex; mode=display">L\left(\mathbf{p}_{1} \rightarrow \mathbf{p}_{0}\right)=\sum_{n=1}^{\infty} P\left(\overline{\mathbf{p}}_{n}\right).</script><p>这被称作路径积分形式的光线传输方程．注意到等式右端不再包含 $L$，因此，我们实际上以级数形式显式地写出了光线传输方程的解．<script type="math/tex">P\left(\overline{\mathbf{p}}_{1}\right)</script> 表示从光源直接射向照相机的光，<script type="math/tex">P\left(\overline{\mathbf{p}}_{2}\right)</script> 表示经过一次散射的直接光，<script type="math/tex">P\left(\overline{\mathbf{p}}_{3}\right),P\left(\overline{\mathbf{p}}_{4}\right),\cdots</script> 表示经过多次散射的间接光．</p><h1 id="路径追踪算法"><a href="#路径追踪算法" class="headerlink" title="路径追踪算法"></a>路径追踪算法</h1><p>路径追踪算法（path tracing algorithm）的目标是估计</p><script type="math/tex; mode=display">L\left(\mathbf{p}_{1} \rightarrow \mathbf{p}_{0}\right)=\sum_{n=1}^{\infty} P\left(\overline{\mathbf{p}}_{n}\right).</script><p>的值．需要解决的问题有两个：第一个是如何估计无穷求和，第二个是如何估计积分项 $P\left(\overline{\mathbf{p}}_{n}\right)$．</p><h2 id="俄罗斯轮盘赌"><a href="#俄罗斯轮盘赌" class="headerlink" title="俄罗斯轮盘赌"></a>俄罗斯轮盘赌</h2><p>无穷求和的困难可以由所谓的俄罗斯轮盘赌（Russian roulette）解决．</p><p>假设我们有办法得到任意一个 <script type="math/tex">P\left(\overline{\mathbf{p}}_{n}\right)</script> 的无偏估计量 <script type="math/tex">\widehat{P}\left(\overline{\mathbf{p}}_{n}\right)</script>，那么我们可以立刻写出 <script type="math/tex">\sum\limits_{n=1}^{\infty} {P} \left(\overline{\mathbf{p}}_{n}\right)</script> 的一个无偏估计量</p><script type="math/tex; mode=display">\sum_{n=1}^{\infty} \widehat{P} \left(\overline{\mathbf{p}}_{n}\right).</script><p>但问题是在现实中，我们只能获得有限项的 <script type="math/tex">\widehat{P}\left(\overline{\mathbf{p}}_{n}\right)</script>．俄罗斯轮盘赌的想法，就是以一定概率 $q$ 丢弃第 $N$ 项之后的所有项之和 <script type="math/tex">\sum\limits_{n=N}^{\infty} \widehat{P} \left(\overline{\mathbf{p}}_{n}\right)</script>．而在没有被丢弃的情况下，放大 <script type="math/tex">\sum\limits_{n=N}^{\infty} \widehat{P} \left(\overline{\mathbf{p}}_{n}\right)</script> 作为补偿．</p><p>对于前 $2$ 项 <script type="math/tex">P\left(\overline{\mathbf{p}}_{1}\right),P\left(\overline{\mathbf{p}}_{2}\right)</script>，我们并不采用俄罗斯轮盘赌，而是将它们直接计算出来．从第 $3$ 项开始，我们执行俄罗斯轮盘赌．设 $\eta_1$ 服从 0-1 分布，</p><script type="math/tex; mode=display">\mathrm{P}(\eta_1=k) = q^{k}(1-q)^{1-k},\quad k=0,1,</script><p>当 $\eta_1$ 取 $1$ 时，我们丢弃之后的项，只取前两项之和</p><script type="math/tex; mode=display">\sum_{n=1}^{2} \widehat{P}\left(\overline{\mathbf{p}}_{n}\right),</script><p>而当 $\eta_1$ 取 $0$ 时，我们将后面的项乘上一个缩放因子 $\frac{1}{1-q}$，即得</p><script type="math/tex; mode=display">\sum_{n=1}^{2} \widehat{P}\left(\overline{\mathbf{p}}_{n}\right)+\frac{1}{1-q}\sum_{n=3}^{\infty} \widehat{P}\left(\overline{\mathbf{p}}_{n}\right).</script><p>结合这两种情况，我们的统计量应该写成</p><script type="math/tex; mode=display">\widehat{Q}_3=\sum_{n=1}^{2} \widehat{P}\left(\overline{\mathbf{p}}_{n}\right)+\frac{1_{\eta_1=0}}{1-q}\sum_{n=3}^{\infty}\widehat{P}\left(\overline{\mathbf{p}}_{n}\right)</script><p>注意到</p><script type="math/tex; mode=display">\mathrm{E}\left[\frac{1_{\eta_1=0}}{1-q}\right]=\frac{\mathrm{P}(\eta_1=0)}{1-q}=\frac{1-q}{1-q}=1,</script><p>我们有</p><script type="math/tex; mode=display">\mathrm{E}\left[\sum_{n=1}^{\infty} \widehat{P}\left(\overline{\mathbf{p}}_{n}\right)\right]=\mathrm{E}\left[\sum_{n=1}^{2} \widehat{P}\left(\overline{\mathbf{p}}_{n}\right)+\frac{1_{\eta_1=0}}{1-q}\sum_{n=3}^{\infty}\widehat{P}\left(\overline{\mathbf{p}}_{n}\right)\right],</script><p>即 <script type="math/tex">\widehat{Q}_3</script> 也是 <script type="math/tex">\sum\limits_{n=1}^{\infty}{P}\left(\overline{\mathbf{p}}_{n}\right)</script> 的无偏估计量．</p><p>设 $\eta_2$ 与 $\eta_1$ 独立同分布，我们还可以用同样的方法继续构造出</p><script type="math/tex; mode=display">\widehat{Q}_4=\sum_{n=1}^{2} \widehat{P}\left(\overline{\mathbf{p}}_{n}\right)+\frac{1_{\eta_1=0}}{1-q}\left(\widehat{P}\left(\overline{\mathbf{p}}_{3}\right)+\frac{1_{\eta_2=0}}{1-q}\sum_{n=4}^{\infty} \widehat{P}\left(\overline{\mathbf{p}}_{n}\right)\right).</script><p>显然，$\mathrm{E}[\widehat{Q}_4]=\mathrm{E}[\widehat{Q}_3]$，故 $\widehat{Q}_4$ 也是一个无偏估计量．</p><p>一般地，若 $\eta_1,\eta_2,\cdots$ 独立且都服从成功率为 $q$ 的 0-1 分布，则</p><script type="math/tex; mode=display">\begin{aligned}\widehat{Q}_{N+2}&=\sum_{n=1}^{2} \widehat{P}\left(\overline{\mathbf{p}}_{n}\right)+\frac{1_{\eta_1=0}}{1-q}\left(\widehat{P}\left(\overline{\mathbf{p}}_{3}\right)+\frac{1_{\eta_2=0}}{1-q}\left(\widehat{P}\left(\overline{\mathbf{p}}_{4}\right)+\cdots+\frac{1_{\eta_N=0}}{1-q}\sum_{n=N+2}^{\infty} \widehat{P}\left(\overline{\mathbf{p}}_{n}\right)\right)\right)\\&=\sum_{n=1}^{2} \widehat{P}\left(\overline{\mathbf{p}}_{n}\right)+\frac{1_{\eta_1=0}}{1-q}\widehat{P}\left(\overline{\mathbf{p}}_{3}\right)+\frac{1_{\eta_1,\eta_2=0}}{(1-q)^2}\widehat{P}\left(\overline{\mathbf{p}}_{4}\right)+\cdots+\frac{1_{\eta_1,\eta_2,\cdots,\eta_N=0}}{(1-q)^N}\sum_{n=N+2}^{\infty} \widehat{P}\left(\overline{\mathbf{p}}_{n}\right)\end{aligned}</script><p>是 <script type="math/tex">\sum\limits_{n=1}^{\infty}{P}\left(\overline{\mathbf{p}}_{n}\right)</script> 的无偏估计量．令 <script type="math/tex">\widehat{Q}=\lim\limits_{N\to\infty}\widehat{Q}_{N}</script>，则 $\widehat{Q}$ 也是无偏估计量．</p><p>设</p><script type="math/tex; mode=display">\tau=\inf\{\:i\mid\eta_i=1\:\},</script><p>即第 $\tau+2$ 项及其后的所有项都被丢弃，我们可以将 $\widehat{Q}$ 写作</p><script type="math/tex; mode=display">\widehat{Q}=\sum_{n=1}^{2} \widehat{P}\left(\overline{\mathbf{p}}_{n}\right)+\sum_{n=3}^{\tau+1}\frac{1}{(1-q)^{n-2}} \widehat{P}\left(\overline{\mathbf{p}}_{n}\right)=\sum_{n=1}^{2} \widehat{P}\left(\overline{\mathbf{p}}_{n}\right)+\sum_{n=3}^{\infty}\frac{1}{(1-q)^{n-2}} \widehat{P}\left(\overline{\mathbf{p}}_{n}\right)1_{\tau>n-2}.</script><p>不难求出，$\tau$ 服从几何分布，其概率质量函数为</p><script type="math/tex; mode=display">\mathrm{P}(\tau=k)=(1-q)^{k-1} q,\quad k=1,2, \cdots.</script><p>于是，我们可以用计算验证 $\widehat{Q}$ 的无偏性</p><script type="math/tex; mode=display">\begin{aligned}\mathrm{E}\left[\widehat{Q}\right]&=\sum_{n=1}^{2} P\left(\overline{\mathbf{p}}_{n}\right)+\sum_{n=3}^{\infty}\frac{1}{(1-q)^{n-2}} P\left(\overline{\mathbf{p}}_{n}\right)\mathrm{P}(\tau>n-2)\\&=\sum_{n=1}^{2} P\left(\overline{\mathbf{p}}_{n}\right)+\sum_{n=3}^{\infty}\frac{1}{(1-q)^{n-2}} P\left(\overline{\mathbf{p}}_{n}\right)\sum_{k=n-1}^{\infty}(1-q)^{k-1}q\\&=\sum_{n=1}^{2} P\left(\overline{\mathbf{p}}_{n}\right)+\sum_{n=3}^{\infty}\frac{1}{(1-q)^{n-2}} P\left(\overline{\mathbf{p}}_{n}\right)(1-q)^{n-2}\\&=\sum_{n=1}^{\infty} P\left(\overline{\mathbf{p}}_{n}\right).\end{aligned}</script><p>注意到 $\mathrm{P}(\tau&lt;\infty)=1$，即 $\widehat{Q}$ 为有限项的概率为 $1$，我们完全可以在现实中求出 $\widehat{Q}$ 的估计值．</p><h2 id="伪代码"><a href="#伪代码" class="headerlink" title="伪代码"></a>伪代码</h2><p>路径追踪算法的伪代码如下：</p><pre><code>shade(p, wo):    # Contribution from the light source.    uniformly sample the light at x’ (pdf_light = 1 / A);    shoot a ray from p to x’;    L_dir = 0.0;    if the ray is not blocked in the middle:        L_dir = L_i * f_r * cos θ * cos θ’ / |x’ - p|^2 / pdf_light;    # Contribution from other reflectors.    L_indir = 0.0;    test Russian Roulette with probability P_RR;    if passing Russian Roulette test:        uniformly sample the hemisphere toward wi (pdf_hemi = 1 / 2pi);        trace a ray r(p, wi);        if ray r hit a non-emitting object at q:            L_indir = shade(q, -wi) * f_r * cos θ / pdf_hemi / P_RR;    return L_dir + L_indir;</code></pre>]]></content>
    
    
    <categories>
      
      <category>计算机图形</category>
      
    </categories>
    
    
    <tags>
      
      <tag>计算机图形</tag>
      
      <tag>PBR</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>基于物理的渲染 - 表面反射</title>
    <link href="/cn/2020/10/13/PBR%20-%20Surface%20Reflection/"/>
    <url>/cn/2020/10/13/PBR%20-%20Surface%20Reflection/</url>
    
    <content type="html"><![CDATA[<h1 id="双向反射分布函数"><a href="#双向反射分布函数" class="headerlink" title="双向反射分布函数"></a>双向反射分布函数</h1><p>考虑一张反射平面，在点 $\mathbf{p}$ 处来自入射光的辐照度可以表示成</p><script type="math/tex; mode=display">E_i(\mathbf{p})=\int_{H^2} L_i(\mathbf{p},\boldsymbol{\omega}_i)\cos\theta_i\:d\Omega_i,</script><p>其中 $d\Omega_i=\sin\theta_i\: d\theta_i\:d\phi_i$．上式的直观理解是：将遍布半球的入射光分割成来自很多个小圆锥的入射光，其中 $\boldsymbol{\omega}_i$ 方向上的小圆锥贡献的辐照度为 $L_i(\mathbf{p},\boldsymbol{\omega}_i)\cos\theta_i\:d\Omega_i$．将所有小圆锥贡献的辐照度加起来，就得到了来自入射光的总的辐照度 $E_i(\mathbf{p})$.</p><p>上式有时也写作微分形式</p><script type="math/tex; mode=display">dE_i(\mathbf{p},\boldsymbol{\omega}_i)=L_i(\mathbf{p},\boldsymbol{\omega}_i)\cos\theta_i\:d\Omega_i.</script><p>如果我们要考虑点 $\mathbf{p}$ 处沿 <script type="math/tex">\boldsymbol{\omega}_o</script> 方向出射光的辐照率 <script type="math/tex">L_o(\mathbf{p},\boldsymbol{\omega}_o)</script>，上述分割求和的思想依然可以沿用．假设 <script type="math/tex">\boldsymbol{\omega}_i</script> 方向上的小圆锥每增加 $1$ 个单位的辐照度，就能为 <script type="math/tex">\boldsymbol{\omega}_o</script> 方向的出射光多贡献 <script type="math/tex">f_{\mathrm{r}}\left(\mathbf{p}, \boldsymbol{\omega}_o, \boldsymbol{\omega}_i\right)</script> 单位的辐照率，那么 <script type="math/tex">\boldsymbol{\omega}_i</script> 方向上的小圆锥对  <script type="math/tex">L_o(\mathbf{p},\boldsymbol{\omega}_o)</script> 的贡献就是</p><script type="math/tex; mode=display">f_{\mathrm{r}}\left(\mathbf{p}, \boldsymbol{\omega}_o, \boldsymbol{\omega}_i\right)dE_i(\mathbf{p},\boldsymbol{\omega}_i)=f_{\mathrm{r}}\left(\mathbf{p}, \boldsymbol{\omega}_o, \boldsymbol{\omega}_i\right)L_i(\mathbf{p},\boldsymbol{\omega}_i)\cos\theta_i\:d\Omega_i.</script><p>将所有小圆锥的贡献累加起来，就得到 $L_o(\mathbf{p},\boldsymbol{\omega}_o)$ 的表达式</p><script type="math/tex; mode=display">L_o(\mathbf{p},\boldsymbol{\omega}_o)=\int_{H^2}f_{\mathrm{r}}\left(\mathbf{p}, \boldsymbol{\omega}_o, \boldsymbol{\omega}_i\right)dE_i(\mathbf{p},\boldsymbol{\omega}_i)=\int_{H^2}f_{\mathrm{r}}\left(\mathbf{p}, \boldsymbol{\omega}_o, \boldsymbol{\omega}_i\right)L_i(\mathbf{p},\boldsymbol{\omega}_i)\cos\theta_i\:d\Omega_i.</script><p>上式也可写作对应的微分形式</p><script type="math/tex; mode=display">dL_o(\mathbf{p},\boldsymbol{\omega}_o,\boldsymbol{\omega}_i)=f_{\mathrm{r}}\left(\mathbf{p}, \boldsymbol{\omega}_o, \boldsymbol{\omega}_i\right)dE_i(\mathbf{p},\boldsymbol{\omega}_i),</script><p>或</p><script type="math/tex; mode=display">f_{\mathrm{r}}\left(\mathbf{p}, \boldsymbol{\omega}_o, \boldsymbol{\omega}_i\right)=\frac{dL_o(\mathbf{p},\boldsymbol{\omega}_o,\boldsymbol{\omega}_i)}{dE_i(\mathbf{p},\boldsymbol{\omega}_i)}.</script><p>以上导出的函数 $f_{\mathrm{r}}\left(\mathbf{p}, \boldsymbol{\omega}_o, \boldsymbol{\omega}_i\right)$，被称作<strong> 双向反射分布函数</strong>（bidirectional reflectance distribution function），简称为BRDF．上面推导出的方程</p><script type="math/tex; mode=display">L_o(\mathbf{p},\boldsymbol{\omega}_o)=\int_{H^2}f_{\mathrm{r}}\left(\mathbf{p}, \boldsymbol{\omega}_o, \boldsymbol{\omega}_i\right)L_i(\mathbf{p},\boldsymbol{\omega}_i)\cos\theta_i\:d\Omega_i.</script><p>被称作<strong> 反射方程</strong>．</p><h1 id="性质"><a href="#性质" class="headerlink" title="性质"></a>性质</h1><p>基于物理的BRDF应该具有以下三条性质：</p><ol><li>非负性：$f_{\mathrm{r}}\left(\mathbf{p}, \boldsymbol{\omega}_o, \boldsymbol{\omega}_i\right)\ge 0$；</li><li>Helmholtz互异性（Helmholtz reciprocity）：<script type="math/tex">f_{\mathrm{r}}\left(\mathbf{p}, \boldsymbol{\omega}_o, \boldsymbol{\omega}_i\right)=f_{\mathrm{r}}\left(\mathbf{p}, \boldsymbol{\omega}_i, \boldsymbol{\omega}_o\right)</script>；</li><li>能量守恒：<script type="math/tex; mode=display">\forall\boldsymbol{\omega}_i,\quad\int_{H^2} f_{\mathrm{r}}\left(\mathbf{p}, \boldsymbol{\omega}_o, \boldsymbol{\omega}_i\right)\cos\theta_o\:d\Omega_o\le 1.</script></li></ol><h1 id="计算"><a href="#计算" class="headerlink" title="计算"></a>计算</h1><p>处理积分</p><script type="math/tex; mode=display">L_o(\mathbf{p},\boldsymbol{\omega}_o)=\int_{H^2}f_{\mathrm{r}}\left(\mathbf{p}, \boldsymbol{\omega}_o, \boldsymbol{\omega}_i\right)L_i(\mathbf{p},\boldsymbol{\omega}_i)\cos\theta_i\:d\Omega_i.</script><p>的常见方式有三种：</p><ol><li><p>单位半球上的第一类曲面积分，用球坐标进行参数化</p><script type="math/tex; mode=display">L_o(\mathbf{p},\boldsymbol{\omega}_o)=\int_{0}^{2\pi}\:d\varphi_i\int_{0}^{\frac{\pi}{2}}f_{\mathrm{r}}\left(\mathbf{p}, \boldsymbol{\omega}_o, \boldsymbol{\omega}_i(\theta_i,\varphi_i)\right)L_{i}(\mathbf{p},\boldsymbol{\omega}_i(\theta_i,\varphi_i))\cos\theta_i\sin\theta_i\:d\theta_i.</script></li><li><p>转化为发光曲面 $A$ 上的积分</p><script type="math/tex; mode=display">L_o(\mathbf{p},\boldsymbol{\omega}_o)=\int_{A} f_{\mathrm{r}}\left(\mathbf{p}, \boldsymbol{\omega}_o, \boldsymbol{\omega}_i\right)L_i(\mathbf{p},\boldsymbol{\omega}_i) \cos \theta_{i} \frac{\cos \theta^\prime \mathrm{d} A}{r^{2}},</script></li></ol><p>其中 $\theta^\prime$ 是 $A$ 上某点处的法向量与 $-\boldsymbol{\omega}_i$ 之间的夹角．</p><h1 id="实例：UE4-采用的-BRDF"><a href="#实例：UE4-采用的-BRDF" class="headerlink" title="实例：UE4 采用的 BRDF"></a>实例：UE4 采用的 BRDF</h1><p>UE4 引擎使用了如下 BRDF</p><script type="math/tex; mode=display">f_{r}\left(\omega_{i}, \omega_{o}\right)=k_{d} f_{\text {lambert}}+f_{s}</script><p>其中</p><script type="math/tex; mode=display">\begin{array}{l}f_{\text {lambert}}=\dfrac{\text{base_color}}{\pi} \\f_{s}=\dfrac{F\left(\mathbf{h}, \boldsymbol{\omega}_o\right) G(\boldsymbol{\omega}_i, \boldsymbol{\omega}_o) D(\mathbf{h})}{4(\mathbf{n} \cdot \boldsymbol{\omega}_o)(\mathbf{n} \cdot \boldsymbol{\omega}_i)} \\k_{s}=F\left(\mathbf{h}, \boldsymbol{\omega}_o\right) \\k_{d}=\left(1-k_{s}\right)(1-\text {metalness}).\end{array}</script><p>上式中，$\mathbf{n}$ 为单位法向量，$\boldsymbol{\omega}_i$ 为单位入射向量，$\boldsymbol{\omega}_o$ 为单位反射向量，$\mathbf{h}=(\boldsymbol{\omega}_i+\boldsymbol{\omega}_o)/\Vert\boldsymbol{\omega}_i+\boldsymbol{\omega}_o\Vert$ 为微平面单位法向量．下面描述函数 $F,D,G$ 的具体形式．</p><h2 id="法线分布函数-D"><a href="#法线分布函数-D" class="headerlink" title="法线分布函数 $D$"></a>法线分布函数 $D$</h2><p>GGX（Trowbridge-Reitz）分布</p><script type="math/tex; mode=display">\begin{aligned}\alpha&=\text {roughness}^{2}\\D(\mathbf{h})&=\dfrac{\alpha^{2}}{\pi\left((\mathbf{n} \cdot \mathbf{h})^{2}\left(\alpha^{2}-1\right)+1\right)^{2}}.\end{aligned}</script><p>一般地，设 $\mathbf{n} \cdot \mathbf{h}=\cos\theta_{\mathbf{h}}$，法线分布 $D(\mathbf{h})$ 应满足</p><script type="math/tex; mode=display">\int_{H^2_{\mathbf{n}}}D(\mathbf{h})\cos\theta_{\mathbf{h}} \:d\Omega_{\mathbf{h}}=1,</script><p>其中 $H^2_{\mathbf{n}}$ 表示底部大圆与 $\mathbf{n}$ 垂直的上半球面．可以验证 GGX 法线分布函数满足该关系</p><script type="math/tex; mode=display">\begin{aligned}\int_{\mathcal{H}^{2}} \cos \theta_{\mathbf{h}}  D\left(\mathbf{h}\right) \mathrm{d} \mathbf{h} &=\int_{0}^{2 \pi} \mathrm{d} \varphi_{\mathbf{h}} \int_{0}^{\frac{\pi}{2}} \frac{\alpha^{2} \cos \theta_{\mathbf{h}}  \sin \theta_{\mathbf{h}} }{\pi\left(\left(\alpha^{2}-1\right) \cos ^{2} \theta_{\mathbf{h}} +1\right)^{2}} d\theta_{\mathbf{h}}\\&=2\pi\int_{0}^{\frac{\pi}{2}} \frac{ \alpha^{2} \cos \theta_{\mathbf{h}} \sin \theta_{\mathbf{h}} }{\pi\left(\left(\alpha^{2}-1\right) \cos ^{2} \theta_{\mathbf{h}} +1\right)^{2}} d\theta_{\mathbf{h}} \\&=-\alpha^{2} \int_{0}^{\frac{\pi}{2}} \frac{1}{\left(\left(\alpha^{2}-1\right) \cos ^{2} \theta_{\mathbf{h}} +1\right)^{2}} d\cos ^{2} \theta_{\mathbf{h}} \\&=\alpha^{2} \int_{0}^{1} \frac{1}{\left(\left(\alpha^{2}-1\right) t+1\right)^{2}} dt \\&=\left.\frac{\alpha^{2}}{1-\alpha^{2}} \frac{1}{\left(\alpha^{2}-1\right) t+1}\right|_{0} ^{1} \\&=1.\end{aligned}</script><h2 id="几何函数-G"><a href="#几何函数-G" class="headerlink" title="几何函数 $G$"></a>几何函数 $G$</h2><p>GGX-Smith Correlated Joint 近似公式</p><script type="math/tex; mode=display">\begin{aligned}\alpha&=\text {roughness}^{2} \\\Lambda(\boldsymbol{\omega}_o)&=(\mathbf{n} \cdot \boldsymbol{\omega}_i)((\mathbf{n} \cdot \boldsymbol{\omega}_o)(1-\alpha)+\alpha) \\\Lambda(\boldsymbol{\omega}_i)&=(\mathbf{n} \cdot \boldsymbol{\omega}_o)((\mathbf{n} \cdot \boldsymbol{\omega}_i)(1-\alpha)+\alpha) \\G(\boldsymbol{\omega}_i, \boldsymbol{\omega}_o)&=\frac{2(\mathbf{n} \cdot \boldsymbol{\omega}_o)(\mathbf{n} \cdot \boldsymbol{\omega}_i)}{\Lambda(\boldsymbol{\omega}_o)+\Lambda(\boldsymbol{\omega}_i)}\end{aligned}</script><h2 id="菲涅尔项-F"><a href="#菲涅尔项-F" class="headerlink" title="菲涅尔项 $F$"></a>菲涅尔项 $F$</h2><p>Fresnel-Schlick 近似公式</p><script type="math/tex; mode=display">\begin{aligned}F\left(\mathbf{h}, \boldsymbol{\omega}_o\right)&=F_{0}+\left(1-F_{0}\right)(1-(\mathbf{h} \cdot \boldsymbol{\omega}_o))^{5} \\F_{0}&=\operatorname{lerp}(0.16\:\text{specular}^2, \text{base_color}, \text{metalness})\end{aligned}</script><p>其中 $\operatorname{lerp}(a,b,t)=(1-t)a+tb$ 为线性插值函数．</p>]]></content>
    
    
    <categories>
      
      <category>计算机图形</category>
      
    </categories>
    
    
    <tags>
      
      <tag>计算机图形</tag>
      
      <tag>PBR</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>色彩科学</title>
    <link href="/cn/2020/10/12/Color%20Science/"/>
    <url>/cn/2020/10/12/Color%20Science/</url>
    
    <content type="html"><![CDATA[<div class="note note-success">            <p><strong>前置知识</strong>：<a class="btn" href="/2020/10/10/Radiometry and Photometry" title="跳转至：辐射度量学与光度学" target="_blank" style="margin-bottom:0px">辐射度量学与光度学</a></p>          </div><p>色彩科学的研究表明，人类能感知到的所有颜色构成一个3维线性空间。只要选定一个基，我们就能将颜色编码成3维坐标。不同的编码方式，对应了不同的色彩空间。本文介绍了一些常见的色彩空间以及如何在色彩空间之间进行转换。</p><h1 id="CIE-RGB-色彩空间"><a href="#CIE-RGB-色彩空间" class="headerlink" title="CIE RGB 色彩空间"></a>CIE RGB 色彩空间</h1><h2 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h2><p>考虑一个离散化的光谱能量分布（Spectral Power Distribution，简称 SPD）空间，这里的光谱能量用辐照率衡量，波长范围取 $380nm-720nm$，波长梯度取 $0.1nm$。该空间是一个 $3401$ 维的线性空间 $\mathbb{R}^{3401}$．在一个固定的辐照率下，一个基为：<script type="math/tex">\mathbf{l}_{380.0}, \mathbf{l}_{380.1},\cdots, \mathbf{l}_{720.0}</script>．</p><p>设 $C$ 为人类色彩映射，它将 SPD 空间的光谱能量分布映射成色觉空间 $P$ 中的色彩．我们下面将说明：色觉空间是 $3$ 维线性空间，色彩映射</p><script type="math/tex; mode=display">C:\mathbb{R}^{3401}\longrightarrow P</script><p>是一个线性映射．</p><p>首先，因为人类产生色觉的前提是视网膜收到光的刺激，所以 $C$ 一定是满射．然后，Grassmann 定律告诉我们，色觉空间的加法可以被这样良定义：</p><script type="math/tex; mode=display">C(\mathbf{s}_1)+C(\mathbf{s}_2):=C\left(\overline{\mathbf{s}_1}+\overline{\mathbf{s}_2}\right),</script><p>其中 $\overline{\mathbf{s}_1},\overline{\mathbf{s}_2}\in\mathbb{R}^{3401}$ 为满足 $C(\overline{\mathbf{s}_1})=C(\mathbf{s}_1),C(\overline{\mathbf{s}_2})=C(\mathbf{s}_2)$ 的任意光谱能量分布．</p><p>进一步地，我们同样有良定义的数乘：对任意 $k&gt;0$，对任意 $\overline{\mathbf{s}}\in\mathbb{R}^{3401}$，只要 $\overline{\mathbf{s}}$ 满足 $C(\overline{\mathbf{s}})=C(\mathbf{s})$，就有</p><script type="math/tex; mode=display">k\,C(s):=C(k\hspace{1pt}\overline{\mathbf{s}}).</script><p>因此色觉空间 $P$ 是线性空间，$C$ 是线性映射．按照习惯，$C(\mathbf{s})$ 将简记为 $C\mathbf{s}$．</p><p>我们可以还定义色觉的减法：若存在 $\mathbf{s}_3$，使得 $C\mathbf{s}_1+C\mathbf{s}_3=C\mathbf{s}_2$，则定义 </p><script type="math/tex; mode=display">C\mathbf{s}_2-C\mathbf{s}_1:=C\mathbf{s}_3.</script><p>揭示色觉空间维数的是色匹配实验．实验结果表明：红 <script type="math/tex">\mathbf{v}_R=C\,\mathbf{l}_{700.0}</script>，绿 <script type="math/tex">\mathbf{v}_G=C\,\mathbf{l}_{546.1}</script>，蓝 <script type="math/tex">\mathbf{v}_B=C\,\mathbf{l}_{435.8}</script> 是色觉空间的一个基．换言之，任何色彩都可以表示成红、绿、蓝的线性组合．同时，红、绿、蓝中的任一种颜色都无法表示成另两种颜色的线性组合．因此，色觉空间是一个 $3$ 维线性空间．</p><p>为了消除歧义，我们做出如下约定：色觉空间是唯一的，其中的元素就是人类能够感知到的颜色．色彩空间则有很多种，它们的集合都是 $\mathbb{R}^3$，不同之处在于它们配备的与色觉空间之间的双射．说得更简单一点，面对同样的一个点 $(x_1,x_2,x_3)$，不同的色彩空间会它把解释成不同的颜色．</p><p>如果我们为色觉空间 $P$ 选定前面所说的这个基 <script type="math/tex">\mathbf{v}_R,\mathbf{v}_G,\mathbf{v}_B</script>，那么相应地会诱导出一个一一对应的坐标映射</p><script type="math/tex; mode=display">\mathrm{coor}_{RGB}:P\longrightarrow\mathbb{R}^3,</script><p>将色觉空间 $P$ 中的颜色映射成它在这个基下的坐标．配备了这个坐标映射的 $\mathbb{R}^3$ 就被称作 <strong>CIE RGB 色彩空间</strong>．</p><p>容易看出，色觉空间 $P$ 每选定一个基 $\eta$，与之对应的坐标空间 $\mathrm{coor}_{\mathbf{\eta}}(P)$ 就是一个色彩空间．因为坐标映射是一个线性同构，我们称这样得到的色彩空间为线性的．</p><h2 id="坐标计算"><a href="#坐标计算" class="headerlink" title="坐标计算"></a>坐标计算</h2><p>有了基之后，我们就可以进行基于坐标的计算，把任意一个 SPD 产生的色彩用三个数进行表示．具体来说，任意 SPD $\mathbf{s}\in\mathbb{R}^{3401}$ 产生的色彩都可由 <script type="math/tex">\mathbf{v}_R,\mathbf{v}_G,\mathbf{v}_B</script> 进行唯一的线性表示：</p><script type="math/tex; mode=display">C\mathbf{s}=R\cdot \mathbf{v}_R+G\cdot \mathbf{v}_G+B\cdot \mathbf{v}_B.</script><p>即 $C\mathbf{s}$ 拥有坐标 $(R,G,B)$. 特别地，任意单频光谱 <script type="math/tex">\mathbf{l}_\lambda</script> 产生的色彩都可由 <script type="math/tex">\mathbf{v}_R,\mathbf{v}_G,\mathbf{v}_B</script> 进行唯一的线性表示</p><script type="math/tex; mode=display">C\,\mathbf{l}_{\lambda}=( \mathbf{v}_R,\mathbf{v}_G,\mathbf{v}_B)\begin{pmatrix}     R_{\lambda} \\ G_{\lambda} \\ B_{\lambda} \end{pmatrix}.</script><p>设 $C$ 在基 <script type="math/tex">\mathbf{l}_{380.0}, \mathbf{l}_{380.1},\cdots, \mathbf{l}_{720.0}</script> 和基 <script type="math/tex">\mathbf{v}_R,\mathbf{v}_G,\mathbf{v}_B</script> 下的矩阵表示为色匹配矩阵 $CMF^{RGB}$，则有</p><script type="math/tex; mode=display">\begin{align}(C\,\mathbf{l}_{700.0},C\,\mathbf{l}_{700.1},\cdots,C\,\mathbf{l}_{720.0})&=\left(\mathbf{v}_R,\mathbf{v}_G,\mathbf{v}_B\right)\,CMF^{RGB}\\&=\left(\mathbf{v}_R,\mathbf{v}_G,\mathbf{v}_B\right)\begin{pmatrix}     R_{380.0} & R_{380.1}& \cdots & R_{720.0} \\    G_{380.0} & G_{380.1}& \cdots & G_{720.0} \\    B_{380.0} & B_{380.1}& \cdots & B_{720.0} \\\end{pmatrix}.\end{align}</script><p>下图即为实验确定的 CIE RGB 空间的色匹配矩阵 $CMF^{RGB}$．图中横坐标为 $\lambda$ 时，红绿蓝曲线的纵坐标分别为 <script type="math/tex">R_{\lambda},G_{\lambda},B_{\lambda}</script>．</p><center>    <img style="border-radius: 0.3125em;    box-shadow: 0 2px 4px 0 rgba(34,36,38,.12),0 2px 10px 0 rgba(34,36,38,.08);"     src="https://upload.wikimedia.org/wikipedia/commons/3/36/CIE1931_RGBCMF.png" width="95%">    <br>    <div style="color:orange;    font-size:14px;    display: inline-block;    color: #999;    padding: 10px;">图1 - CIE 1931 RGB 色匹配函数</div></center><p>如果知道了色匹配矩阵 $CMF$，我们就能计算出任意 SPD 在色彩空间 CIE RGB 中的坐标．任给 SPD</p><script type="math/tex; mode=display">\mathbf{s}=\left(\mathbf{l}_{380.0}, \mathbf{l}_{380.1},\cdots, \mathbf{l}_{720.0}\right)\begin{pmatrix}     k_{380.0}  \\    k_{380.1}  \\    \vdots     \\    k_{720.0}  \\\end{pmatrix},</script><p>我们有如下计算公式</p><script type="math/tex; mode=display">C\mathbf{s}=\left(\mathbf{v}_R,\mathbf{v}_G,\mathbf{v}_B\right)\begin{pmatrix}     R_{380.0} & R_{380.1}& \cdots & R_{720.0} \\    G_{380.0} & G_{380.1}& \cdots & G_{720.0} \\    B_{380.0} & B_{380.1}& \cdots & B_{720.0} \\\end{pmatrix}\begin{pmatrix}     k_{380.0}  \\    k_{380.1}  \\    \vdots     \\    k_{720.0}  \\\end{pmatrix}</script><p>记 <script type="math/tex">\mathbf{k}=(k_{380.0},k_{380.1},\cdots,k_{720.0})^T</script>，并将 $CMF^{RGB}$ 按行分块</p><script type="math/tex; mode=display">CMF=\begin{pmatrix}     CMF^{RGB}_1 \\ CMF^{RGB}_2 \\ CMF^{RGB}_3 \end{pmatrix},</script><p>计算公式可以重写为</p><script type="math/tex; mode=display">C\mathbf{s}=\left(\mathbf{v}_R,\mathbf{v}_G,\mathbf{v}_B\right)\begin{pmatrix}     CMF^{RGB}_1\,\mathbf{k}\\     CMF^{RGB}_2\,\mathbf{k}\\     CMF^{RGB}_3\,\mathbf{k}\end{pmatrix}.</script><h2 id="CIE-rg-色度空间"><a href="#CIE-rg-色度空间" class="headerlink" title="CIE rg 色度空间"></a>CIE rg 色度空间</h2><p>色彩空间 CIE RGB 中任意一点可由三个坐标 $(R,G,B)$ 确定．映射</p><script type="math/tex; mode=display">\begin{align}r&=\frac{R}{R+G+B},\\g&=\frac{G}{R+G+B},\\b&=\frac{B}{R+G+B}=1-r-g.\end{align}</script><p>将三维的色彩空间 CIE RGB 压缩成二维的平面．下图是展示了 $(r,g)$ 构成的空间，被称作 CIE rg 色度空间．</p><center>    <img style="border-radius: 0.3125em;    box-shadow: 0 2px 4px 0 rgba(34,36,38,.12),0 2px 10px 0 rgba(34,36,38,.08);"     src="https://upload.wikimedia.org/wikipedia/commons/1/16/CIE1931_rgxy.png" width="95%">    <br>    <div style="color:orange;    font-size:14px;    display: inline-block;    color: #999;    padding: 10px;">图2 - CIE rg 色度空间</div></center><p>不难发现，CIE RGB 色彩空间中的任意一条直线 $t(\hat{R},\hat{G},\hat{B})$，在映射 $(R,G,B)\mapsto (r,g)$ 的作用下，都被压缩成 CIE rg 色度空间中的一个点 $\left(\frac{\hat{R}}{\hat{R}+\hat{G}+\hat{B}},\frac{\hat{G}}{\hat{R}+\hat{G}+\hat{B}}\right)$．因此，由 $(r,g)$ 表示的色度是一种与辐照度无关的属性．在这张图上，每个点具有不同的色度，但它们的辐照度完全可以被设定为相同值．</p><h1 id="CIE-XYZ-色彩空间"><a href="#CIE-XYZ-色彩空间" class="headerlink" title="CIE XYZ 色彩空间"></a>CIE XYZ 色彩空间</h1><h2 id="定义-1"><a href="#定义-1" class="headerlink" title="定义"></a>定义</h2><p>在使用由基 $\mathbf{v}_R,\mathbf{v}_G,\mathbf{v}_B$ 导出的色彩空间 CIE RGB 时，有些色彩的坐标会出现负值，这在计算时不太方便．因此，我们为色觉空间更换一个更利于计算的基 <script type="math/tex">\mathbf{v}_X,\mathbf{v}_Y,\mathbf{v}_Z</script>，由此得到色彩空间 CIE XYZ．</p><p>设换基的转移矩阵为 $T$，我们有</p><script type="math/tex; mode=display">( \mathbf{v}_X,\mathbf{v}_Y,\mathbf{v}_Z)=(\mathbf{v}_R,\mathbf{v}_G,\mathbf{v}_B)T,</script><p>或</p><script type="math/tex; mode=display">( \mathbf{v}_X,\mathbf{v}_Y,\mathbf{v}_Z)T^{-1}=(\mathbf{v}_R,\mathbf{v}_G,\mathbf{v}_B),</script><p>因为</p><script type="math/tex; mode=display">\begin{align}(C\,\mathbf{l}_{700.0},C\,\mathbf{l}_{700.1},\cdots,C\,\mathbf{l}_{720.0})&=\left(\mathbf{v}_R,\mathbf{v}_G,\mathbf{v}_B\right)\,CMF^{RGB}\\&=( \mathbf{v}_X,\mathbf{v}_Y,\mathbf{v}_Z)T^{-1}CMF^{RGB}\\&=( \mathbf{v}_X,\mathbf{v}_Y,\mathbf{v}_Z)CMF^{XYZ},\end{align}</script><p>所以色彩空间 CIE XYZ 的色匹配矩阵 $CMF^{XYZ}=T^{-1}CMF^{RGB}$. 在精心选取 $T$ 后，得到的 $CMF^{XYZ}$ 如下图所示．</p><center>    <img style="border-radius: 0.3125em;    box-shadow: 0 2px 4px 0 rgba(34,36,38,.12),0 2px 10px 0 rgba(34,36,38,.08);"     src="/img/color_science/CIE_1931_XYZ_Color_Matching_Functions.png" width="95%">    <br>    <div style="color:orange;    font-size:14px;    display: inline-block;    color: #999;    padding: 10px;">图3 - CIE 1931 XYZ 色匹配函数</div></center><p>从图中可以看出，色匹配矩阵 $CMF^{XYZ}$ 的每一项都是非负的．也就是说，在色彩空间 CIE XYZ 中，单频光谱产生的色彩 <script type="math/tex">C\,\mathbf{l}_{\lambda}</script> 始终具有非负的坐标 <script type="math/tex">(X_{\lambda} , Y_{\lambda}, Z_{\lambda})</script>．</p><h2 id="亮度的表示"><a href="#亮度的表示" class="headerlink" title="亮度的表示"></a>亮度的表示</h2><p>除了坐标分量非负，色彩空间 CIE XYZ 在表示亮度时也有着明显的优势．<a href="/2020/10/10/辐射度量学与光度学/#亮度" target="_blank">亮度</a>（luminance）描述人对光明亮程度的主观感受，它与描述光的客观物理量辐照率 $SPD(\lambda)$ 有如下关系</p><script type="math/tex; mode=display">\text{luminance}=\int_\lambda V(\lambda)SPD(\lambda)d\lambda=\sum_{i=1}^{3401}V(\lambda_i)k_{\lambda_i},\quad\lambda_i=380.0+0.1*(i-1),</script><p>其中 $\lambda$ 为波长，$V(\lambda)$ 为光度函数，$SPD(\lambda)$ 为光谱能量分布．下图画出了实验测得的 $V(\lambda)$．</p><center>    <img style="border-radius: 0.3125em;    box-shadow: 0 2px 4px 0 rgba(34,36,38,.12),0 2px 10px 0 rgba(34,36,38,.08);"     src="/img/color_science/CIE_1931_Luminosity.png" width="95%">    <br>    <div style="color:orange;    font-size:14px;    display: inline-block;    color: #999;    padding: 10px;">图4 - 光度函数</div></center><p>从图中可以看出，人对绿光最敏感．在辐照率相同时，绿光最亮．</p><p>事实上，色彩空间 CIE XYZ 的 $Y$ 坐标可直接当作亮度．因为</p><script type="math/tex; mode=display">C\mathbf{s}=\left(\mathbf{v}_R,\mathbf{v}_G,\mathbf{v}_B\right)CMF^{RGB}\,\mathbf{k}=(\mathbf{v}_X,\mathbf{v}_Y,\mathbf{v}_Z)CMF^{XYZ}\,\mathbf{k}.</script><p>设 $C\mathbf{s}$ 在基 $( \mathbf{v}_X,\mathbf{v}_Y,\mathbf{v}_Z)$ 下的坐标表示为</p><script type="math/tex; mode=display">C\mathbf{s}=( \mathbf{v}_X,\mathbf{v}_Y,\mathbf{v}_Z)\begin{pmatrix}     X \\ Y\\ Z\end{pmatrix},</script><p>则有</p><script type="math/tex; mode=display">\begin{pmatrix}     X \\ Y\\ Z\end{pmatrix}=CMF^{XYZ}\,\mathbf{k}.</script><p>设 $CMF^{XYZ}$ 的第 $2$ 行第 $j$ 列的元素为 $Y_{\lambda_j}$, 我们有</p><script type="math/tex; mode=display">Y=\sum_{j=1}^{3401}Y_{\lambda_j}\hspace{1pt}k_{\lambda_{j}}</script><p>因为 $CMF^{XYZ}$ 中的绿色曲线与 $V(\lambda)$ 曲线非常相近，可以近似认为 $Y_{\lambda_j}=V(\lambda_j)$，故 $Y$ 可直接当作亮度．</p><h2 id="xyY-空间与色度图"><a href="#xyY-空间与色度图" class="headerlink" title="xyY 空间与色度图"></a>xyY 空间与色度图</h2><p>对 CIE XYZ 空间做非线性变换</p><script type="math/tex; mode=display">\begin{align}x&=\frac{X}{X+Y+Z},\\y&=\frac{Y}{X+Y+Z},\\z&=Y,\end{align}</script><p>就得到了一个非线性的色彩空间：xyY空间．$x,y$ 表示色度，$z表示明度$．下图是一张等明度色度图，它包含了人类能看到的所有色度．</p><center>    <img style="border-radius: 0.3125em;    box-shadow: 0 2px 4px 0 rgba(34,36,38,.12),0 2px 10px 0 rgba(34,36,38,.08);"     src="/img/color_science/CIE1931xy_blank.svg" width="95%">    <br>    <div style="color:orange;    font-size:14px;    display: inline-block;    color: #999;    padding: 10px;">图5 - CIE 1931 xy 色度图</div></center><h1 id="sRGB-色彩空间"><a href="#sRGB-色彩空间" class="headerlink" title="sRGB 色彩空间"></a>sRGB 色彩空间</h1><p>从 CIE XYZ 空间到 sRGB 空间需要经过两步．第一步是换基，将 CIE XYZ 空间变为线性 sRGB 空间．第二步是 Gamma 变换，将线性 sRGB 空间变成最终的 sRGB 空间．</p><h2 id="标准光源"><a href="#标准光源" class="headerlink" title="标准光源"></a>标准光源</h2><p>标准光源 CIE Standard Illuminant D65 是一个相对 SPD，与辐照度无关．一方面，它在 CIE XYZ 空间中为一条直线 $k(0.95047,1,1.08883)$，直线上 $Y=1$ 的点 $(0.95047,1,1.08883)$ 称为白点．另一方面，它在CIE xy 色度图中为一个点 $(0.31271,0.32902)$．</p><h2 id="线性-sRGB-空间"><a href="#线性-sRGB-空间" class="headerlink" title="线性 sRGB 空间"></a>线性 sRGB 空间</h2><p>设色觉空间 $P$ 的一个基 $(\mathbf{c}_R,\mathbf{c}_G,\mathbf{c}_B)$ 导出了线性 sRGB 空间。 基 $(\mathbf{c}_R,\mathbf{c}_G,\mathbf{c}_B)$ 是由下列条件唯一确定的：</p><ol><li><p>三原色（primaries）：$\mathbf{c}_R,\mathbf{c}_G,\mathbf{c}_B$ 的 CIE xy 色度分别为 $(0.64,0.33),(0.30,0.60),(0.15,0.06)$，即</p><script type="math/tex; mode=display">(\mathbf{c}_R,\mathbf{c}_G,\mathbf{c}_B)=(\mathbf{v}_X,\mathbf{v}_Y,\mathbf{v}_Z)\begin{pmatrix} 0.64w_1&0.30w_2&0.15w_3\\ 0.33w_1&0.60w_2&0.06w_3\\ 0.03w_1&0.10w_2&0.79w_3\end{pmatrix}.</script></li><li><p>白点：CIE XYZ 空间中的白点 $(0.95047,1,1.08883)$ 被映到 sRGB 空间中的 $(1,1,1)$，即</p><script type="math/tex; mode=display">(\mathbf{v}_X,\mathbf{v}_Y,\mathbf{v}_Z)\begin{pmatrix}  0.95047\\  1\\  1.08883\end{pmatrix}= (\mathbf{c}_R,\mathbf{c}_G,\mathbf{c}_B)\begin{pmatrix}  1\\  1\\  1\end{pmatrix}.</script></li></ol><p>联立两个条件得到</p><script type="math/tex; mode=display">\begin{pmatrix}    0.64&0.30&0.15\\    0.33&0.60&0.06\\    0.03&0.10&0.79\end{pmatrix}\begin{pmatrix}     w_1\\     w_2\\     w_3\end{pmatrix}=\begin{pmatrix}     0.95047\\     1\\     1.08883\end{pmatrix}.</script><p>解出</p><script type="math/tex; mode=display">\begin{pmatrix}     w_1\\     w_2\\     w_3\end{pmatrix}=\begin{pmatrix}     0.644463\\     1.19192\\     1.20292\end{pmatrix}.</script><p>由此可求出 CIE XYZ 空间到线性 sRGB 空间的坐标变换公式</p><script type="math/tex; mode=display">\begin{pmatrix} R_{\text {linear }} \\G_{\text {linear }} \\B_{\text {linear }}\end{pmatrix}=\begin{pmatrix} +3.24096994 & -1.53738318 & -0.49861076 \\-0.96924364 & +1.8759675 & +0.04155506 \\+0.05563008 & -0.20397696 & +1.05697151\end{pmatrix}\begin{pmatrix} X\\Y \\Z\end{pmatrix}</script><h2 id="Gamma-变换"><a href="#Gamma-变换" class="headerlink" title="Gamma 变换"></a>Gamma 变换</h2><p>定义 Gamma 变换为</p><script type="math/tex; mode=display">\gamma(u)=\left\{\begin{array}{lll}12.92 u & =\frac{323 u}{25} & u \leq 0.0031308 \\1.055 u^{1 / 2.4}-0.055 & =\frac{211 u^{\frac{5}{12}}-11}{200} & \text { otherwise }\end{array}\right.</script><p>它将线性 sRGB 空间中的坐标映成 sRGB 空间中的坐标，即</p><script type="math/tex; mode=display">\begin{pmatrix} R_{sRGB} \\G_{sRGB} \\B_{sRGB}\end{pmatrix}=\begin{pmatrix} \gamma(R_{\text {linear }})\\\gamma(G_{\text {linear }})\\\gamma(B_{\text {linear }})\end{pmatrix}.</script><p>此外，如果有坐标分量值超出了 $1$，那么该分量会被钳制到 $1$．因为钳制的存在，从 CIE XYZ 空间到 sRGB 空间的映射并不是单射。因此，sRGB 空间能够表示的颜色是 CIE XYZ 空间的一个子集。下面展示了sRGB空间的色度图．<br><img src="/img/color_science/CIE1931xy_gamut_comparison.svg" alt=""></p><hr><p><strong>扩展阅读</strong>：<a href="https://chrisbrejon.com/cg-cinematography/chapter-1-5-academy-color-encoding-system-aces/">ACES(Academy Color Encoding System)</a></p>]]></content>
    
    
    <categories>
      
      <category>计算机图形</category>
      
    </categories>
    
    
    <tags>
      
      <tag>计算机图形</tag>
      
      <tag>色彩科学</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>辐射度量学与光度学</title>
    <link href="/cn/2020/10/10/Radiometry%20and%20Photometry/"/>
    <url>/cn/2020/10/10/Radiometry%20and%20Photometry/</url>
    
    <content type="html"><![CDATA[<p><strong>辐射度量学</strong>（radiometry）是测量包括可见光在内的各种电磁辐射的学科．而<strong> 光度学</strong>（photometry）是测量人眼感知到的可见光强弱的学科．因为人眼对各种波长的光敏感度不同，所以只有把不同波长的辐射功率用光度函数加权，才能准确描述人类感受到的光的强弱．</p><h1 id="辐射度量学"><a href="#辐射度量学" class="headerlink" title="辐射度量学"></a>辐射度量学</h1><h2 id="辐射通量"><a href="#辐射通量" class="headerlink" title="辐射通量"></a>辐射通量</h2><p>在辐射度量学中，<strong> 辐射通量</strong>（radiant flux）或<strong> 辐射功率</strong>（radiant power）$\Phi_\mathrm{e}$ 是单位时间内发射、反射、透过或接收的辐射能量，单位为瓦特 $\mathrm W$．</p><p>与辐射通量 <script type="math/tex">\Phi_{\mathrm{e}}</script> 相关的一个物理量是<strong> 辐射通量的光谱密度函数 </strong> <script type="math/tex">\Phi_{\mathrm{e},\lambda}</script>，它与 $\Phi_\mathrm{e}$ 的关系如下</p><script type="math/tex; mode=display">\Phi_{\mathrm{e}, \lambda}=\frac{\mathrm{d} \Phi_{\mathrm{e}}}{\mathrm{d} \lambda},\quad \Phi_{\mathrm{e}}=\int_{0}^{\infty} \Phi_{\mathrm{e}, \lambda} \mathrm{d} \lambda.</script><p>考虑一个点光源，它的辐射通量 <script type="math/tex">\Phi_\mathrm{e}</script> 可以想象成发射的箭头的数量．</p><center>    <img style="border-radius: 0.3125em;    box-shadow: 0 2px 4px 0 rgba(34,36,38,.12),0 2px 10px 0 rgba(34,36,38,.08);"     src="/img/radiometry_and_photometry/radiant_flux.png">    <br>    <div style="color:orange;    font-size:14px;    display: inline-block;    color: #999;    padding: 10px;">图1 - 辐射通量示意图</div></center><p>上图中的点光源发射了 $11$ 根箭头，那么它的辐射通量就是 $11\mathrm W$．我们也可以考虑一片发光或受光的曲面，它的辐射通量就是发射或接收的箭头的数量．如果进一步假定箭头有各种颜色，那么 <script type="math/tex">\Phi_{\mathrm{e},\lambda}</script> 可以想象成颜色为 $\lambda$ 的箭头数量．</p><h2 id="辐射强度"><a href="#辐射强度" class="headerlink" title="辐射强度"></a>辐射强度</h2><p><strong> 辐射强度</strong>（radiation intensity）$I_{\mathrm{e}, \Omega}$ 是某一方向上单位立体角内发射、反射、透过或接收的辐射通量，即</p><script type="math/tex; mode=display">I_{\mathrm{e}, \Omega}=\frac{\partial \Phi_{\mathrm{e}}}{\partial \Omega}</script><p>单位为 $\mathrm{W}/\mathrm{sr}$．若某一点光源在单位向量 $\omega$ 方向上的辐射强度为 $I_{\mathrm{e}, \Omega}(\boldsymbol{\omega})$，则空间中某曲面 $S$ 接收到的辐射通量为</p><script type="math/tex; mode=display">\Phi_\mathrm{e}(S)=\int_S I_{\mathrm{e},\Omega}(\boldsymbol{\omega}) d\Omega.</script><p>设曲面 $S$ 被径向投影 $p: \mathbf{r}\mapsto \frac{\mathbf{r}}{\Vert\mathbf{r}\Vert}$ 映成 $\hat{S}$，则上式可转化成 $\hat{S}$ 上的第一类曲面积分</p><script type="math/tex; mode=display">\Phi_\mathrm{e}(S)=\int_\hat{S} I_{\mathrm{e},\Omega}(\boldsymbol{\omega}) d\Omega,</script><p>其中 $d\Omega$ 为单位球面上的面积元．计算时，可如下进行参数化 </p><script type="math/tex; mode=display">\boldsymbol{\omega}=(\sin\theta\cos\phi,\sin\theta\sin\phi, \cos\theta),\quad d\Omega=\sin\theta\: d\theta\:d\phi.</script><p>如果将辐射通量想象成箭头数，那么辐射强度的几何想象就是某一方向上一个很小的立体角内的箭头数比上立体角的角度．</p><center>    <img style="border-radius: 0.3125em;    box-shadow: 0 2px 4px 0 rgba(34,36,38,.12),0 2px 10px 0 rgba(34,36,38,.08);"     src="/img/radiometry_and_photometry/radiation_intensity.png">    <br>    <div style="color:orange;    font-size:14px;    display: inline-block;    color: #999;    padding: 10px;">图2 - 辐射强度示意图</div></center><p>考虑一个各向同性点光源，它在所有方向上的辐射强度都为 $2\mathrm{W}/\mathrm{sr}$，即一个立体角发射两个箭头．因为一个球面总的球面度为 $4\pi$，所以这个点光源一共发出了 $2\times 4\pi=8\pi$ 个箭头，它的辐射通量为 $8\pi\mathrm{W}$．</p><p>一般地，若各向同性点光源的辐射强度为 $I_0$，那么它的辐射通量为</p><script type="math/tex; mode=display">\Phi_0=\int_\hat{S} I_{0}d\Omega=\int_{0}^{2\pi}\int_{0}^{\frac{\pi}{2}}I_0 \sin\theta\: d\theta\:d\phi= 4\pi I_0.</script><h2 id="辐照度"><a href="#辐照度" class="headerlink" title="辐照度"></a>辐照度</h2><p><strong> 辐照度</strong>（irradiance）<script type="math/tex">E_{\mathrm{e}}</script> 是电磁辐射入射曲面时单位面积上接收的辐射通量</p><script type="math/tex; mode=display">E_{\mathrm{e}}=\frac{\partial \Phi_{\mathrm{e}}}{\partial A},</script><p>单位为 $\mathrm{W}/\mathrm{m}^2$．</p><p>承接前面的几何想象，曲面上某点处的辐照度可以被描述为一个很小的区域内发出（或接收）的箭头数比上区域的面积．</p><h2 id="辐射率"><a href="#辐射率" class="headerlink" title="辐射率"></a>辐射率</h2><p>曲面的上某点在某一方向上的 <strong> 辐射率</strong>（radiance）$L_{\mathrm{e}, \Omega}$，是它在单位立体角内由单位投影面积发射、反射、透过或接收的辐射通量，公式为</p><script type="math/tex; mode=display">L_{\mathrm{e}, \Omega}=\frac{\partial^{2} \Phi_{\mathrm{e}}}{\partial \Omega \partial A \cos \theta},</script><p>其中 $\Omega$ 表示立体角，$A \cos \theta$ 表示在某方向上的投影面积，$\theta$ 则表示曲面法向量与该方向的夹角．辐射率的单位是 $\mathrm{W}/(\mathrm{sr}\cdot \mathrm{m}^2)$．</p><p>记曲面上点 $\mathbf{p}$ 在 $\boldsymbol\omega$ 方向上的的辐射率是 $L_{\mathrm{e}, \Omega}(\mathbf{p},\boldsymbol{\omega})$，则该点处的辐照度为</p><script type="math/tex; mode=display">E_{\mathrm{e}}(\mathbf{p})=\int_S L_{\mathrm{e}, \Omega}(\mathbf{p},\boldsymbol{\omega})\cos\theta\:d\Omega.</script><p>若曲面是一个不透光的反射平面，那么上式可化为在一个单位半球面上的第一类曲面积分，并进一步化为重积分进行计算</p><script type="math/tex; mode=display">E_{\mathrm{e}}(\mathbf{p})=\int_{H^2} L_{\mathrm{e}, \Omega}(\mathbf{p},\boldsymbol{\omega})\cos\theta\:d\Omega=\int_{0}^{2\pi}\int_{0}^{\frac{\pi}{2}}L_{\mathrm{e}, \Omega}(\mathbf{p},\boldsymbol{\omega})\cos\theta\sin\theta\:d\theta\:d\phi.</script><p>要形象表述曲面上某点处的沿某一方向的辐射率，可以想象曲面上包围该点的一个很小的区域，在该方向的一个小圆锥内接收箭头．辐射率就等于区域接收的箭头数先除以小圆锥的立体角，再除以区域被直射的面积．</p><h1 id="光度学"><a href="#光度学" class="headerlink" title="光度学"></a>光度学</h1><p>将辐射度量学的物理量按波长加权，即可得到对应的光度学物理量．</p><h2 id="光通量"><a href="#光通量" class="headerlink" title="光通量"></a>光通量</h2><p><strong>光通量</strong>（luminous flux）$\Phi_{\mathrm{v}}$ 定义为</p><script type="math/tex; mode=display">\Phi_{\mathrm{v}} =K \cdot \int_{0}^{\infty} \Phi_{\mathrm{e},\lambda} \cdot V(\lambda) \mathrm{d} \lambda,</script><p>其中光敏度 $K= 683.002\:\mathrm{lm}/\mathrm{W}$．光通量的单位是流明（lumen) $\mathrm{lm}$．</p><p>$V(\lambda)$ 是<strong> 光度函数</strong>（luminosity function），也称作相对视见函数，无量纲，描述了人眼对不同波长可见光亮度的感知敏感度．下图中黑色实线是CIE 1931标准下的明视光度函数，黑色虚线代表的其他版本的明视光度函数，绿色实线则代表暗视光度函数．</p><center>    <img style="border-radius: 0.3125em;    box-shadow: 0 2px 4px 0 rgba(34,36,38,.12),0 2px 10px 0 rgba(34,36,38,.08);"     src="/img/radiometry_and_photometry/Luminosity.svg">    <br>    <div style="color:orange;    display: inline-block;    color: #999;    font-size:14px;    padding: 10px;">图3 - 光度函数</div></center><p>注意到 $V(\lambda)$ 是经过归一化处理的．当 $\lambda=555\mathrm{nm}$ 时，$V(\lambda)$ 取得最大值 $1$．</p><h2 id="发光强度"><a href="#发光强度" class="headerlink" title="发光强度"></a>发光强度</h2><p><strong>发光强度</strong>（Luminous intensity）$I_{\mathrm{v}, \Omega}$ 定义为</p><script type="math/tex; mode=display">I_{\mathrm{v}, \Omega}=\frac{\partial \Phi_{\mathrm{v}}}{\partial \Omega},</script><p>单位是坎德拉（candela）$\mathrm{cd}$．$1$ 坎德拉是发出 $540\times10^{12} \mathrm{Hz}$ 频率的单色辐射源在给定方向上的发光强度，该方向上的辐射强度为 $\frac{1}{683} \mathrm{W}/\mathrm{sr}$．</p><p>我们可以通过光度函数来检查坎德拉的定义是否合理．$540\times10^{12} \mathrm{Hz}$ 的频率对应 $555.016 \mathrm{nm}$ 的波长，而 $V(555.016\mathrm{nm})=0.999997$．因此，定义中光源的发光强度应为</p><script type="math/tex; mode=display">I_{\mathrm{v}, \Omega}=K V(\lambda) I_{\mathrm{e}, \Omega} =683.002\:\mathrm{lm}/\mathrm{W}\times0.999997\times \frac{1}{683}\mathrm{W}/\mathrm{sr}=1\mathrm{lm}/\mathrm{sr}.</script><p>结果正好为 $1$ 坎德拉．</p><h2 id="照度"><a href="#照度" class="headerlink" title="照度"></a>照度</h2><p><strong>照度</strong>（illuminance）$E_{\mathrm{v}}$ 是每单位面积所接收到的光通量，单位为勒克斯（lux) $\mathrm{lx}$．照度公式为</p><script type="math/tex; mode=display">E_{\mathrm{v}}=\frac{\partial \Phi_{\mathrm{v}}}{\partial A}.</script><h2 id="亮度"><a href="#亮度" class="headerlink" title="亮度"></a>亮度</h2><p><strong>亮度</strong>（luminance）$L_{\mathrm{v}, \Omega}$ 是表示人眼对发光体或被照射物体表面的发光或反射光强度实际感受的物理量，定义为</p><script type="math/tex; mode=display">L_{\mathrm{v}, \Omega}=\frac{\partial^{2} \Phi_{\mathrm{v}}}{\partial \Omega \partial A \cos \theta},</script><p>国际单位为 $\mathrm{cd}/\mathrm{m}^2$．亮度还有一个非国际单位尼特（nit) $\mathrm{nt}$，$1\mathrm{nt}=1\mathrm{cd}/\mathrm{m}^2$．</p>]]></content>
    
    
    <categories>
      
      <category>计算机图形</category>
      
    </categories>
    
    
    <tags>
      
      <tag>计算机图形</tag>
      
      <tag>辐射度量学</tag>
      
      <tag>光度学</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>张量 - 计算篇</title>
    <link href="/cn/2020/01/12/Tensor%20-%20Calculation/"/>
    <url>/cn/2020/01/12/Tensor%20-%20Calculation/</url>
    
    <content type="html"><![CDATA[<p>除非特殊说明，以下只考虑选取了标准正交基的欧式空间 $\mathbb{R}^n$ 及其对偶空间．张量采用黑体，标量则是标准罗马字体．</p><p>$\mathbb{R}^m$ 的元素为列向量 $\mathbf{a}^i=[a^1,a^2,\cdots,a^m]^T$，<script type="math/tex">(\mathbb{R}^n)^*</script> 的元素为行向量 $ \mathbf{b}_j=[b_1,b_2,\cdots,b_n]$．$\mathbb{R}^m$ 的标准正交基表示为列向量 $ \boldsymbol{ \delta } ^1,\cdots \boldsymbol{ \delta } ^m $，其中 $ \boldsymbol{ \delta } ^i$ 的第 $i$ 个分量等于 $ 1 $，其余分量等于 $ 0 $ ．$(\mathbb{R}^n)^*$ 的标准正交基表示为行向量 $ \boldsymbol{ \delta }_1,\cdots, \boldsymbol{ \delta }_n $，其中 $ \boldsymbol{ \delta }_j$ 的第 $j$ 个分量等于 $ 1 $，其余分量等于 $ 0 $．</p><h1 id="张量积"><a href="#张量积" class="headerlink" title="张量积"></a>张量积</h1><p>定义 $ (\mathbb{R}^n)^*\otimes \mathbb{R}^m $ 是以 $ \boldsymbol{ \delta }_j \otimes \boldsymbol{ \delta } ^i $ 为基的自由向量空间．容易验证，</p><script type="math/tex; mode=display">\begin{align}    \otimes : (\mathbb{R}^n)^*\times \mathbb{R}^m &\longrightarrow (\mathbb{R}^n)^*\otimes \mathbb{R}^m \\     \mathbf{b} _j \times \mathbf{a} ^i&\longmapsto \sum_{i}\sum_{j} b_j a^i \boldsymbol{ \delta } _j \otimes \boldsymbol{ \delta } ^i\end{align}</script><p>是双线性映射．即</p><script type="math/tex; mode=display">\begin{align}     (\lambda\mathbf{b}_j+ \mathbf{c}_j )\otimes \mathbf{a}^i&= \lambda\mathbf{b}_j\otimes \mathbf{a}^i +\mathbf{c}_j \otimes \mathbf{a}^i ,\quad&\forall \lambda\in\mathbb{R}, \mathbf{a}^i \in\mathbb{R}^m,\mathbf{b}_j , \mathbf{c}_j\in (\mathbb{R}^n)^* ,\\     \mathbf{b} _j \otimes (\lambda\mathbf{a} ^i + \mathbf{d} ^i ) &= \lambda \mathbf{b}_j\otimes \mathbf{a}^i + \mathbf{b}_j \otimes \mathbf{d}^i ,\quad&\forall \lambda\in\mathbb{R}, \mathbf{a}^i , \mathbf{d}^i \in\mathbb{R}^m,\mathbf{b}_j \in (\mathbb{R}^n)^* .\end{align}</script><p>根据同构 $\mathcal{L}(\mathbb{R}^n, \mathbb{R}^m )\cong \mathrm{M}_{m\times n}( \mathbb{R} )$，线性映射 $f:\mathbb{R}^n\to\mathbb{R}^m\in\mathcal{L}(\mathbb{R}^n, \mathbb{R}^m ) $ 可由矩阵表示</p><script type="math/tex; mode=display">\mathbf{A}^i {}_j=\begin{bmatrix}      A^1 {}_1 & A^1 {} _2& \cdots & A^1 {}_n \\    A^2 {}_1 & A^2 {}_2& \cdots & A^2 {}_n \\    \vdots& \vdots& & \vdots \\    A^m {}_1 & A^m {}_2& \cdots & A^m {}_n       \end{bmatrix}.</script><p>可以验证，映射</p><script type="math/tex; mode=display">\begin{align}    \varphi: \mathrm{M}_{m\times n}( \mathbb{R} ) &\longrightarrow (\mathbb{R}^n)^*\otimes \mathbb{R}^m\\    \mathbf{A}^i {}_j&\longmapsto \sum_{i}\sum_{j}A^i {}_j \boldsymbol{ \delta } _j \otimes \boldsymbol{ \delta } ^i \end{align}</script><p>是线性同构．因此，我们有如下同构关系，</p><script type="math/tex; mode=display">\mathrm{M}_{m\times n}( \mathbb{R} ) \cong \mathcal{L}(\mathbb{R}^n, \mathbb{R}^m ) \cong (\mathbb{R}^n)^*\otimes \mathbb{R}^m,</script><p>并且可以将 $ (\mathbb{R}^n)^*\otimes \mathbb{R}^m $ 中的元素记成矩阵．一个简单的例子是</p><script type="math/tex; mode=display">\begin{bmatrix}    1&2 \end{bmatrix}\otimes \begin{bmatrix}     3\\    4 \end{bmatrix} = \begin{bmatrix}      3\times1&3 \times 2 \\    4\times1&4 \times 2 \end{bmatrix} .</script><h1 id="张量"><a href="#张量" class="headerlink" title="张量"></a>张量</h1><p>设 $V=\mathbb{R}^n$．在微分几何中，常考虑的是一个向量空间 $V$ 及其对偶空间 $V^*$ 之间的张量积．张量积</p><mjx-container class="MathJax" jax="SVG" display="true"><svg style="vertical-align: -3.85ex" xmlns="http://www.w3.org/2000/svg" width="34.54ex" height="8.931ex" role="img" focusable="false" viewBox="0 -2245.8 15266.7 3947.5" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="MJX-2-TEX-I-1D449" d="M52 648Q52 670 65 683H76Q118 680 181 680Q299 680 320 683H330Q336 677 336 674T334 656Q329 641 325 637H304Q282 635 274 635Q245 630 242 620Q242 618 271 369T301 118L374 235Q447 352 520 471T595 594Q599 601 599 609Q599 633 555 637Q537 637 537 648Q537 649 539 661Q542 675 545 679T558 683Q560 683 570 683T604 682T668 681Q737 681 755 683H762Q769 676 769 672Q769 655 760 640Q757 637 743 637Q730 636 719 635T698 630T682 623T670 615T660 608T652 599T645 592L452 282Q272 -9 266 -16Q263 -18 259 -21L241 -22H234Q216 -22 216 -15Q213 -9 177 305Q139 623 138 626Q133 637 76 637H59Q52 642 52 648Z"></path><path id="MJX-2-TEX-I-1D45F" d="M21 287Q22 290 23 295T28 317T38 348T53 381T73 411T99 433T132 442Q161 442 183 430T214 408T225 388Q227 382 228 382T236 389Q284 441 347 441H350Q398 441 422 400Q430 381 430 363Q430 333 417 315T391 292T366 288Q346 288 334 299T322 328Q322 376 378 392Q356 405 342 405Q286 405 239 331Q229 315 224 298T190 165Q156 25 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 114 189T154 366Q154 405 128 405Q107 405 92 377T68 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path><path id="MJX-2-TEX-I-1D460" d="M131 289Q131 321 147 354T203 415T300 442Q362 442 390 415T419 355Q419 323 402 308T364 292Q351 292 340 300T328 326Q328 342 337 354T354 372T367 378Q368 378 368 379Q368 382 361 388T336 399T297 405Q249 405 227 379T204 326Q204 301 223 291T278 274T330 259Q396 230 396 163Q396 135 385 107T352 51T289 7T195 -10Q118 -10 86 19T53 87Q53 126 74 143T118 160Q133 160 146 151T160 120Q160 94 142 76T111 58Q109 57 108 57T107 55Q108 52 115 47T146 34T201 27Q237 27 263 38T301 66T318 97T323 122Q323 150 302 164T254 181T195 196T148 231Q131 256 131 289Z"></path><path id="MJX-2-TEX-N-3A" d="M78 370Q78 394 95 412T138 430Q162 430 180 414T199 371Q199 346 182 328T139 310T96 327T78 370ZM78 60Q78 84 95 102T138 120Q162 120 180 104T199 61Q199 36 182 18T139 0T96 17T78 60Z"></path><path id="MJX-2-TEX-N-3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path><path id="MJX-2-TEX-N-2297" d="M56 250Q56 394 156 488T384 583Q530 583 626 485T722 250Q722 110 625 14T390 -83Q249 -83 153 14T56 250ZM582 471Q531 510 496 523Q446 542 381 542Q324 542 272 519T196 471L389 278L485 375L582 471ZM167 442Q95 362 95 250Q95 137 167 58L359 250L167 442ZM610 58Q682 138 682 250Q682 363 610 442L418 250L610 58ZM196 29Q209 16 230 2T295 -27T388 -42Q409 -42 429 -40T465 -33T496 -23T522 -11T544 1T561 13T574 22T582 29L388 222L196 29Z"></path><path id="MJX-2-TEX-N-22EF" d="M78 250Q78 274 95 292T138 310Q162 310 180 294T199 251Q199 226 182 208T139 190T96 207T78 250ZM525 250Q525 274 542 292T585 310Q609 310 627 294T646 251Q646 226 629 208T586 190T543 207T525 250ZM972 250Q972 274 989 292T1032 310Q1056 310 1074 294T1093 251Q1093 226 1076 208T1033 190T990 207T972 250Z"></path><path id="MJX-2-TEX-S4-E150" d="M-18 -213L-24 -207V-172L-16 -158Q75 2 260 84Q334 113 415 119Q418 119 427 119T440 120Q454 120 457 117T460 98V60V25Q460 7 457 4T441 0Q308 0 193 -55T25 -205Q21 -211 18 -212T-1 -213H-18Z"></path><path id="MJX-2-TEX-S4-E151" d="M-10 60Q-10 104 -10 111T-5 118Q-1 120 10 120Q96 120 190 84Q375 2 466 -158L474 -172V-207L468 -213H451H447Q437 -213 434 -213T428 -209T423 -202T414 -187T396 -163Q331 -82 224 -41T9 0Q-4 0 -7 3T-10 25V60Z"></path><path id="MJX-2-TEX-S4-E153" d="M-10 60V95Q-10 113 -7 116T9 120Q151 120 250 171T396 284Q404 293 412 305T424 324T431 331Q433 333 451 333H468L474 327V292L466 278Q375 118 190 36Q95 0 8 0Q-5 0 -7 3T-10 24V60Z"></path><path id="MJX-2-TEX-S4-E152" d="M-24 327L-18 333H-1Q11 333 15 333T22 329T27 322T35 308T54 284Q115 203 225 162T441 120Q454 120 457 117T460 95V60V28Q460 8 457 4T442 0Q355 0 260 36Q75 118 -16 278L-24 292V327Z"></path><path id="MJX-2-TEX-S4-E154" d="M-10 0V120H410V0H-10Z"></path><path id="MJX-2-TEX-N-2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="msubsup"><g data-mml-node="mi"><use xlink:href="#MJX-2-TEX-I-1D449"></use></g><g data-mml-node="mi" transform="translate(828.3, 413) scale(0.707)"><use xlink:href="#MJX-2-TEX-I-1D45F"></use></g><g data-mml-node="mi" transform="translate(583, -247) scale(0.707)"><use xlink:href="#MJX-2-TEX-I-1D460"></use></g></g><g data-mml-node="mo" transform="translate(1475, 0)"><use xlink:href="#MJX-2-TEX-N-3A"></use><use xlink:href="#MJX-2-TEX-N-3D" transform="translate(278, 0)"></use></g><g data-mml-node="mover" transform="translate(2808.8, 0)"><g data-mml-node="TeXAtom" data-mjx-texclass="OP"><g data-mml-node="mover"><g data-mml-node="mrow"><g data-mml-node="mi"><use xlink:href="#MJX-2-TEX-I-1D449"></use></g><g data-mml-node="mo" transform="translate(991.2, 0)"><use xlink:href="#MJX-2-TEX-N-2297"></use></g><g data-mml-node="mo" transform="translate(1991.4, 0)"><use xlink:href="#MJX-2-TEX-N-22EF"></use></g><g data-mml-node="mo" transform="translate(3385.7, 0)"><use xlink:href="#MJX-2-TEX-N-2297"></use></g><g data-mml-node="mi" transform="translate(4385.9, 0)"><use xlink:href="#MJX-2-TEX-I-1D449"></use></g></g><g data-mml-node="mo" transform="translate(0, 943)"><use xlink:href="#MJX-2-TEX-S4-E150"></use><use xlink:href="#MJX-2-TEX-S4-E151" transform="translate(4704.9, 0)"></use><g data-c="E155" transform="translate(2127.4, 0)"><use xlink:href="#MJX-2-TEX-S4-E153"></use><use xlink:href="#MJX-2-TEX-S4-E152" transform="translate(450, 0)"></use></g><svg width="1877.4" height="720" x="350" y="-300" viewBox="469.4 -300 1877.4 720"><use xlink:href="#MJX-2-TEX-S4-E154" transform="scale(7.04, 1)"></use></svg><svg width="1877.4" height="720" x="2927.4" y="-300" viewBox="469.4 -300 1877.4 720"><use xlink:href="#MJX-2-TEX-S4-E154" transform="scale(7.04, 1)"></use></svg></g></g></g><g data-mml-node="TeXAtom" transform="translate(2205.9, 1615.4) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><use xlink:href="#MJX-2-TEX-I-1D45F"></use></g><g data-mml-node="mtext" transform="translate(451, 0)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="773.5px" font-family="serif">个</text></g></g></g><g data-mml-node="mo" transform="translate(8185.9, 0)"><use xlink:href="#MJX-2-TEX-N-2297"></use></g><g data-mml-node="munder" transform="translate(9186.1, 0)"><g data-mml-node="TeXAtom" data-mjx-texclass="OP"><g data-mml-node="munder"><g data-mml-node="mrow"><g data-mml-node="msup"><g data-mml-node="mi"><use xlink:href="#MJX-2-TEX-I-1D449"></use></g><g data-mml-node="mo" transform="translate(828.3, 413) scale(0.707)"><use xlink:href="#MJX-2-TEX-N-2217"></use></g></g><g data-mml-node="mo" transform="translate(1454.1, 0)"><use xlink:href="#MJX-2-TEX-N-2297"></use></g><g data-mml-node="mo" transform="translate(2454.3, 0)"><use xlink:href="#MJX-2-TEX-N-22EF"></use></g><g data-mml-node="mo" transform="translate(3848.5, 0)"><use xlink:href="#MJX-2-TEX-N-2297"></use></g><g data-mml-node="msup" transform="translate(4848.7, 0)"><g data-mml-node="mi"><use xlink:href="#MJX-2-TEX-I-1D449"></use></g><g data-mml-node="mo" transform="translate(828.3, 413) scale(0.707)"><use xlink:href="#MJX-2-TEX-N-2217"></use></g></g></g><g data-mml-node="mo" transform="translate(0, -463)"><use xlink:href="#MJX-2-TEX-S4-E152"></use><use xlink:href="#MJX-2-TEX-S4-E153" transform="translate(5630.6, 0)"></use><g data-c="E156" transform="translate(2590.3, 0)"><use xlink:href="#MJX-2-TEX-S4-E151"></use><use xlink:href="#MJX-2-TEX-S4-E150" transform="translate(450, 0)"></use></g><svg width="2340.3" height="720" x="350" y="-300" viewBox="585.1 -300 2340.3 720"><use xlink:href="#MJX-2-TEX-S4-E154" transform="scale(8.776, 1)"></use></svg><svg width="2340.3" height="720" x="3390.3" y="-300" viewBox="585.1 -300 2340.3 720"><use xlink:href="#MJX-2-TEX-S4-E154" transform="scale(8.776, 1)"></use></svg></g></g></g><g data-mml-node="TeXAtom" transform="translate(2662.3, -1460.3) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><use xlink:href="#MJX-2-TEX-I-1D460"></use></g><g data-mml-node="mtext" transform="translate(469, 0)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="773.5px" font-family="serif">个</text></g></g></g></g></g></svg></mjx-container><p>的元素</p><script type="math/tex; mode=display">\mathbf{A}^{i_1,\cdots,i_{r}} {}_{ j_1,\cdots,j_{s} } =\sum\limits_{i_1,\cdots,i_{r},\\ j_1,\cdots,j_{s} } A^{ i_1 \cdots i_{r}} {}_{ j_1 \cdots j_{s} } \boldsymbol{ \delta } ^{i_1} \otimes \cdots \otimes \boldsymbol{ \delta } ^{i_{r}} \otimes \boldsymbol{ \delta } _{j_1} \otimes \cdots \otimes \boldsymbol{ \delta } _{j_{s}}</script><p>称为 $(r,s)$ 型混合张量，或简称为 $(r,s)$ 张量．记</p><script type="math/tex; mode=display">\boldsymbol{ \delta } ^ {i_1,\cdots,i_{r}} {}_{ j_1,\cdots,j_{s} }:= \boldsymbol{ \delta } ^{i_1} \otimes \cdots \otimes \boldsymbol{ \delta } ^{i_{r}} \otimes \boldsymbol{ \delta } _{j_1} \otimes \cdots \otimes \boldsymbol{ \delta } _{j_{s}} ,</script><p>则有</p><script type="math/tex; mode=display">\mathbf{A}^{i_1,\cdots,i_{r}} {}_{ j_1,\cdots,j_{s} } =\sum\limits_{i_1,\cdots,i_{r},\\ j_1,\cdots,j_{s} } A^{ i_1 \cdots i_{r}} {}_{ j_1 \cdots j_{s} } \boldsymbol{ \delta } ^ {i_1\cdots i_{r}} {}_{ j_1\cdots j_{s} }</script><p>若引入指标缩略记号 <script type="math/tex">\alpha= (i_1,\cdots,i_{r})</script>，<script type="math/tex">\beta= (j_1,\cdots,j_{s})</script>，上式可进一步简化为</p><script type="math/tex; mode=display">\mathbf{A}^{ \alpha } {}_{ \beta } =\sum\limits_{ \alpha , \beta } A^{ \alpha } {}_{ \beta } \boldsymbol{ \delta } ^ { \alpha } {}_{ \beta }．</script><h1 id="张量的运算"><a href="#张量的运算" class="headerlink" title="张量的运算"></a>张量的运算</h1><p>张量有乘法和缩并两种运算．$(r_1,s_1)$ 张量与 $(r_2,s_2)$张量的乘法就是张量积</p><script type="math/tex; mode=display">\begin{align}    \otimes : V_{s_1}^{r_1} \times V_{s_2}^{r_2} &\longrightarrow V_{s_1+s_2}^{r_1+r_2} \\    \mathbf{A}^{ \alpha_1 } {}_{ \beta_1} \times \mathbf{B}^{ \alpha_2} {}_{ \beta_2} &\longmapsto \sum\limits_{ \alpha_1 , \beta_1, \alpha_2 , \beta_2} A^{ \alpha_1}{}_{ \beta_1 } B^{ \alpha_2} {}_{ \beta_2 }\boldsymbol{\delta }^{ \alpha_1 }{}_{ \beta_1} {}^{\alpha_ 2 } {}_{\beta_ 2 }\end{align}\ .</script><p>定义迹为如下映射，</p><script type="math/tex; mode=display">\begin{align}    \mathrm{Tr}: V^*\otimes V &\longrightarrow \mathbb{R}\\    \sum_{i,j} A^i {}_j \boldsymbol{ \delta } _j \otimes \boldsymbol{ \delta } ^i &\longmapsto \sum_{i}A^i {}_i \end{align}\ ,</script><p>容易验证它是一个线性映射．由此可定义缩并运算．设 $ 1\le p\le r$，$ 1\le q\le s$，$(r,s)$ 张量的缩并运算定义为</p><script type="math/tex; mode=display">\begin{align}    \mathrm{Tr_{pq}}: V_{s}^{r} &\longrightarrow V_{s-1}^{r-1} \\ \mathbf{A}^{i_1,\cdots,i_{r}} {}_{ j_1,\cdots,j_{s} }&\longmapsto \sum\limits_{i_1, \cdots, \widehat{i_p}, \cdots,i_{r},\\    j_1, \cdots ,\widehat{j_q}, \cdots,j_{s} } \mathrm{Tr} \left( \sum_{i_p,j_q} A^{ i_1 \cdots i_p \cdots i_{r}} {}_{ j_1 \cdots j_q \cdots j_{s} } \boldsymbol{ \delta } ^{ i_p }{}_{ j_q } \right) \boldsymbol{ \delta } ^ {i_1\cdots \widehat{i_p}\cdots i_{r}} {}_{ j_1 \cdots \widehat{j_q} \cdots j_{s} } \end{align},</script><p>其中带 ${}^\widehat{\hspace{0.8em}}$ 的指标已被删除．</p>]]></content>
    
    
    <categories>
      
      <category>数学</category>
      
    </categories>
    
    
    <tags>
      
      <tag>数学</tag>
      
      <tag>代数</tag>
      
      <tag>线性代数</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>线性变换的直观理解</title>
    <link href="/cn/2019/08/25/Understand%20Linear%20Transformation%20Intuitively/"/>
    <url>/cn/2019/08/25/Understand%20Linear%20Transformation%20Intuitively/</url>
    
    <content type="html"><![CDATA[<h1 id="·-符号与约定"><a href="#·-符号与约定" class="headerlink" title="· 符号与约定"></a>· 符号与约定</h1><p>为避免可能出现的歧义，先对相关符号进行约定．</p><ul><li><p><strong>线性空间</strong>：本文目标是展示出直观的图像，因此考虑的线性空间 $V$ 默认是欧式空间 $\mathbb{R}^n$．依照惯例，$\mathbb{R}^n$ 中的向量都是列向量．同时也应注意到，本文在尽力保证一般性．对于那些不涉及 $ \mathbb{R}^n$ 特殊性质的论述，几乎可以原封不动地推广至更一般的线性空间．</p></li><li><p><strong>基</strong>： 一个基由能生成全空间且线性无关的一组向量构成．我们用希腊字母表示一个基，例如 $\eta=\left(\eta_1,\eta_2,\cdots,\eta_n\right)$，其中 $\eta_i\in \mathbb{R}^n(i=1,2,\cdots,n)$ 称作基 $\eta$ 的第 $i$ 个基向量．</p></li><li><p><strong>标准正交基</strong>： $\epsilon=(\epsilon_1,\epsilon_2,\cdots,\epsilon_n)$, 其中 $\epsilon_i\in\mathbb{R}^n\left(i=1,2,\cdots,n\right)$ 的第 $i$ 个分量为 $1$，其余分量为 $0$．</p></li><li><p><strong>坐标</strong>：因为本文会考虑多个基，所以有必要将坐标和向量的概念加以区分．如果向量 $v=(v_1,v_2,\cdots,v_n )^T$，则 $ v $ 在基 $ \eta $ 下的坐标 $ v^\eta=(v^\eta_1, v^\eta_2,\cdots, v^\eta_n)^T $ 是一个 $n$ 维向量，由</p><script type="math/tex; mode=display">v^\eta_1 \eta _1+\cdots+ v^\eta_n \eta _n = ( \eta_1 \; \eta_2 \;\cdots\; \eta_n)\begin{pmatrix} v^\eta_1 \\ v^\eta_2 \\ \vdots\\ v^\eta_n \end{pmatrix} =v</script><p>确定．特别地，$v^\epsilon =(\epsilon_1 , \epsilon_2 , \cdots, \epsilon_n )v^\epsilon=v$．</p></li><li><p><strong>基矩阵</strong>：$M_{\eta}$ $=( \eta_1^{\epsilon} \; \eta_2^\epsilon \; \cdots \; \eta_n^\epsilon)$．注意基向量的坐标是列向量，因此得到基矩阵唯一自然的方式就是按列拼合．事实上，根据上面的讨论，我们有 </p><script type="math/tex; mode=display">M_ \eta=(\eta_1 \;\eta_2 \; \cdots \; \eta_n).</script><p>观察可知，标准正交基的基矩阵 <script type="math/tex">M_\epsilon</script> 就是单位矩阵 $I$；$v^\eta=M_\eta ^{-1}v$．</p></li><li><p><strong>线性变换</strong>： $ \mathbb{R}^n$ 上的线性变换 $ \mathcal{A}$ 是一个 $ \mathbb{R}^n$ 到 $ \mathbb{R}^n$ 的映射，满足 $ \forall v_1,v_2\in\mathbb{R}^n$，$\forall \lambda _1, \lambda _2\in\mathbb{R}$，</p><script type="math/tex; mode=display">\mathcal{A} (\lambda_1 v_1+\lambda_2 v_2)= \lambda_1 \mathcal{A} (v_1)+\lambda_2 \mathcal{A} (v_2).</script><p>$ \mathcal{A} (v)$ 通常简记为 $ \mathcal{A} v$．</p></li></ul><h1 id="·-线性变换的矩阵表示"><a href="#·-线性变换的矩阵表示" class="headerlink" title="· 线性变换的矩阵表示"></a>· 线性变换的矩阵表示</h1><p>有了这些约定后，我们还需要做一点必要的铺垫．我们将说明，线性变换能在给定的基下表示成矩阵．反过来，给定一个基，一个矩阵也能确定一个线性变换．</p><p>理解线性空间的一种方式，是想象它由基线性生成．基是一个基础框架，而向量则是「长」在基上．比起考虑线性变换 $ \mathcal{A} $ 在整个 $ \mathbb{R}^n$ 上进行作用，更简单的方式是考虑它在基上的作用．一旦清楚了它在基上的作用，它对生长在基上的向量的作用也就一清二楚了．具体来说，如果 $ \mathcal{A} $ 是这么生成的：</p><script type="math/tex; mode=display">v=v^\eta_1 \eta_1+\cdots+ v^\eta_n \eta_n ,</script><p>即 $ v $ 在基 $ \eta $ 下的坐标是 $ v^\eta $，那么</p><script type="math/tex; mode=display">\mathcal{A} v= \mathcal{A} ( v^\eta_1 \eta_1+\cdots+ v^\eta_n \eta_n )=v^\eta_1 \mathcal{A} \eta_1 +\cdots + v^\eta_n \mathcal{A} \eta_n,</script><p>即 $ \mathcal{A} v $ 在基 $ \mathcal{A} \eta=(\mathcal{A} \eta_1,\cdots, \mathcal{A} \eta_n) $ 上的坐标也是 $ v^\eta $．<br>由此可以看出，虽然 $ v $ 和 $ \mathcal{A} v $ 长在了不同的基（ $ \eta $ 和 $ \mathcal{A} \eta$）上，但是它们的生长方式（坐标）是一样的．<br>我们断言，如果知道了 $ \mathcal{A} $ 在旧基 $ \eta $ 上的作用的结果，又或者知道了新基 $ \mathcal{A} \eta $ 在旧基 $ \eta $ 下的坐标，<br>$ \mathcal{A} $ 的全部信息就已经知悉了．事实上，假设</p><script type="math/tex; mode=display">\mathcal{A} \eta_i = (\eta_1\; \eta_2\;\cdots\; \eta_n )\begin{pmatrix}a_{i1}\\a_{i2}\\ \vdots\\a_{in}\end{pmatrix}</script><p>即</p><script type="math/tex; mode=display">( \mathcal{A} \eta_1 \; \mathcal{A} \eta_2 \;\cdots\; \mathcal{A} \eta_n) = (\eta_1\; \eta_2\;\cdots\; \eta_n )\begin{pmatrix}    a_{11}& a_{12} &\cdots&a_{1n}\\     a_{21}& a_{22} &\cdots&a_{2n}\\     \vdots& \vdots &&\vdots\\     a_{n1}& a_{n2} &\cdots&a_{nn} \end{pmatrix}．</script><p>将 $ \mathcal{A} \eta $ 在基 $ \eta $ 下的这 $ n $ 个坐标向量排成的矩阵记作</p><script type="math/tex; mode=display">A^\eta= \begin{pmatrix}    a_{11}& a_{12} &\cdots&a_{1n}\\     a_{21}& a_{22} &\cdots&a_{2n}\\     \vdots& \vdots &&\vdots\\ a_{n1}& a_{n2} &\cdots&a_{nn} \end{pmatrix} = \left( (\mathcal{A} \eta_1)^ \eta \; (\mathcal{A} \eta_2)^ \eta \;\cdots\; (\mathcal{A} \eta_n)^ \eta\right) ,</script><p>称作 $ \mathcal{A} $ 在基 $ \eta $ 下的矩阵表示．这种叫法是合理的，因为我们马上会看到，$ A ^\eta $ 连同基 $ \eta $ 确定了 $ \mathcal{A} $ 在  $ \mathbb{R}^n$ 中任一向量上作用的结果，从而完全确定了 $ \mathcal{A} $．任取 $ v\in\mathbb{R}^n $ , 我们有</p><script type="math/tex; mode=display">\mathcal{A} v = v^\eta_1 \mathcal{A} \eta_1 +\cdots + v^\eta_n \mathcal{A} \eta_n =( \mathcal{A} \eta_1 \; \mathcal{A} \eta_2 \;\cdots\; \mathcal{A} \eta_n)\begin{pmatrix}     v^\eta_1 \\     v^\eta_2 \\     \vdots\\     v^\eta_n \end{pmatrix}=(\eta_1\;\eta_2 \; \cdots \; \eta_n) A ^\eta v ,</script><p>这表明 $\mathcal{A}^\eta v$ 在基 $\eta$ 下的坐标就是 $A^\eta v $．特别地，在标准正交基下，$ \mathcal{A} v= A^\epsilon v $．</p><p>更进一步，可以证明矩阵与线性变换的这种一一对应保持线性运算、乘法（映射复合）和单位元．它同时构成线性同构、环同构和结合代数同构．</p><h1 id="·-直观理解线性变换"><a href="#·-直观理解线性变换" class="headerlink" title="· 直观理解线性变换"></a>· 直观理解线性变换</h1><p>现在让我们把目光转向具体的欧式平面．假设我们在 $ \mathbb{R}^2 $ 上选取了标准正交基 $ \epsilon $，此时向量在基下的坐标就等于自己本身．那么矩阵</p><script type="math/tex; mode=display">A^\epsilon =\begin{pmatrix}    1&-1\\    1&1\end{pmatrix}</script><p>表示的线性变换是什么样子的呢？根据前面得到的结论，$A^\epsilon$ 的第 $i$ 列就是线性变换作用在标准正交基第 $ i$ 个基向量上得到的新向量的坐标，所以 $ A^\epsilon $ 的第 $i$ 列就等于$ A^\epsilon \epsilon_i $．当然，我们也可以直接根据关系式</p><script type="math/tex; mode=display">(\mathcal{A} \epsilon_1 \; \mathcal{A} \epsilon_2 \;\cdots\; \mathcal{A} \epsilon_n) = ( \epsilon_1\; \epsilon_2\;\cdots\; \epsilon_n ) A ^\epsilon =IA ^\epsilon =A ^\epsilon</script><p>看出这一点．因为 $ \epsilon_1=(1,0)^T $ 被映成 $ A^\epsilon \epsilon_1=(1,1)^T $，$ \epsilon_2=(0,1)^T $ 被映成 $ A^\epsilon \epsilon_2=(-1,1)^T $，于是我们知道，$ A^\epsilon $ 表示的线性变换是将坐标轴逆时针旋转 $ 45° $ 并拉伸 $\sqrt{2}$ 倍．</p><h1 id="·-基变换与相似矩阵"><a href="#·-基变换与相似矩阵" class="headerlink" title="· 基变换与相似矩阵"></a>· 基变换与相似矩阵</h1><p>下面将说明一个重要事实，给定一个线性变换，它在不同基下的矩阵是相似的．</p><p>设 $ \eta,\zeta $ 是两个基，那么我们令线性变换 $ \mathcal{T} $ 由下式确定</p><script type="math/tex; mode=display">\mathcal{T}(\lambda_1\eta_1+\cdots+ \lambda_n\eta_n )= \lambda_1\zeta_1+\cdots+ \lambda_n\zeta_n ,</script><p>则得到了一个将 $ \eta_i $ 映成 $ \zeta_i (i=1,2,\cdots,n) $ 的线性变换．换言之，基 $ \zeta $ 就等于基 $ \mathcal{T} \eta $．$ \mathcal{T} $ 称作从基 $ \eta $ 到基 $ \zeta $ 的转移变换，$ \mathcal{T} $ 在基 $ \eta $下的矩阵表示 $ T^\eta $ 称作从基 $ \eta $ 到基 $ \zeta $ 的转移矩阵．</p><p>给定一个线性变换 $ \mathcal{A} $，一方面</p><script type="math/tex; mode=display">( \mathcal{A} \zeta_1 \; \mathcal{A} \zeta_2 \;\cdots\; \mathcal{A} \zeta_n) = (\zeta_1\; \zeta_2\;\cdots\; \zeta_n )A^\zeta = ( \mathcal{T} \eta_1 \; \mathcal{T} \eta_2 \;\cdots\; \mathcal{T} \eta_n) A^\zeta = (\eta_1\; \eta_2\;\cdots\; \eta_n )T^\eta A^\zeta .</script><p>另一方面，</p><script type="math/tex; mode=display">(\mathcal{A} \zeta_1 \; \mathcal{A} \zeta_2 \;\cdots\; \mathcal{A} \zeta_n) = ( \mathcal{A} \mathcal{T} \eta_1\; \mathcal{A} \mathcal{T} \eta_2\;\cdots\; \mathcal{A} \mathcal{T} \eta_n )= (\eta_1\; \eta_2\;\cdots\; \eta_n ) A^\eta T^\eta .</script><p>由此我们得到</p><script type="math/tex; mode=display">A^\zeta = (T^\eta)^{-1} A^\eta T^\eta ,</script><p>即同一线性变换在不同基下的矩阵是相似的．</p><h1 id="·-基变换与坐标变换"><a href="#·-基变换与坐标变换" class="headerlink" title="· 基变换与坐标变换"></a>· 基变换与坐标变换</h1><p>设 $ \mathcal{T} $ 是从基 $ \eta $ 到基 $ \zeta $ 的转移变换，$ T^\eta $ 是从基 $ \eta $ 到基 $ \zeta $ 的转移矩阵．若 $ v $ 在旧基 $ \eta $ 下的坐标表示为</p><script type="math/tex; mode=display">v= ( \eta _1 \; \eta _2 \;\cdots\; \eta _n)\begin{pmatrix} v^\eta_1 \\ v^\eta_2 \\ \vdots\\ v^\eta_n \end{pmatrix},</script><p>$ v $ 在新基 $ \zeta $ 下的坐标表示为</p><script type="math/tex; mode=display">v= ( \zeta _1 \; \zeta _2 \;\cdots\; \zeta _n)\begin{pmatrix}     v^\zeta_1 \\ v^\zeta_2 \\ \vdots\\ v^\zeta_n \end{pmatrix},</script><p>则有</p><script type="math/tex; mode=display">v= (\mathcal{T} \eta _1 \; \mathcal{T}\eta _2 \;\cdots\; \mathcal{T}\eta _n)\begin{pmatrix}     v^\zeta_1 \\ v^\zeta_2 \\ \vdots\\ v^\zeta_n \end{pmatrix}= (\eta _1 \; \eta _2 \;\cdots\; \eta _n)T^\eta\begin{pmatrix}     v^\zeta_1 \\ v^\zeta_2 \\ \vdots\\ v^\zeta_n \end{pmatrix}．</script><p>对比系数可知</p><script type="math/tex; mode=display">\begin{pmatrix}     v^\eta_1 \\     v^\eta_2 \\     \vdots\\     v^\eta_n \end{pmatrix}=T^\eta\begin{pmatrix}     v^\zeta_1 \\ v^\zeta_2 \\ \vdots\\ v^\zeta_n \end{pmatrix}.</script><p>于是我们得到了向量 $ v$ 在新基 $ \zeta$ 和旧基 $ \eta$ 下的坐标之间的关系</p><script type="math/tex; mode=display">\begin{pmatrix}    v^\zeta_1 \\ v^\zeta_2 \\ \vdots\\ v^\zeta_n \end{pmatrix}=(T^\eta)^{-1}\begin{pmatrix}     v^\eta_1 \\ v^\eta_2 \\ \vdots\\ v^\eta_n \end{pmatrix},</script><p>它也被称为坐标变换公式．</p><p>注意下面的交换图．（交换图是指，只要图中两个复合映射起点和终点相同，它们就相等，本例中即为 $\mathrm{coor}^\zeta\circ\mathrm{id}=(T^\eta)^{-1}\circ\mathrm{coor}^\eta$．）</p><mjx-container class="MathJax" jax="SVG" display="true"><svg style="vertical-align: -6.43ex" xmlns="http://www.w3.org/2000/svg" width="15.028ex" height="13.991ex" role="img" focusable="false" viewBox="0 -3342.1 6642.5 6184.2" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="MJX-5-TEX-I-1D449" d="M52 648Q52 670 65 683H76Q118 680 181 680Q299 680 320 683H330Q336 677 336 674T334 656Q329 641 325 637H304Q282 635 274 635Q245 630 242 620Q242 618 271 369T301 118L374 235Q447 352 520 471T595 594Q599 601 599 609Q599 633 555 637Q537 637 537 648Q537 649 539 661Q542 675 545 679T558 683Q560 683 570 683T604 682T668 681Q737 681 755 683H762Q769 676 769 672Q769 655 760 640Q757 637 743 637Q730 636 719 635T698 630T682 623T670 615T660 608T652 599T645 592L452 282Q272 -9 266 -16Q263 -18 259 -21L241 -22H234Q216 -22 216 -15Q213 -9 177 305Q139 623 138 626Q133 637 76 637H59Q52 642 52 648Z"></path><path id="MJX-5-TEX-S4-2192" d="M56 237T56 250T70 270H835Q719 357 692 493Q692 494 692 496T691 499Q691 511 708 511H711Q720 511 723 510T729 506T732 497T735 481T743 456Q765 389 816 336T935 261Q944 258 944 250Q944 244 939 241T915 231T877 212Q836 186 806 152T761 85T740 35T732 4Q730 -6 727 -8T711 -11Q691 -11 691 0Q691 7 696 25Q728 151 835 230H70Q56 237 56 250Z"></path><path id="MJX-5-TEX-S4-2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"></path><path id="MJX-5-TEX-N-69" d="M69 609Q69 637 87 653T131 669Q154 667 171 652T188 609Q188 579 171 564T129 549Q104 549 87 564T69 609ZM247 0Q232 3 143 3Q132 3 106 3T56 1L34 0H26V46H42Q70 46 91 49Q100 53 102 60T104 102V205V293Q104 345 102 359T88 378Q74 385 41 385H30V408Q30 431 32 431L42 432Q52 433 70 434T106 436Q123 437 142 438T171 441T182 442H185V62Q190 52 197 50T232 46H255V0H247Z"></path><path id="MJX-5-TEX-N-64" d="M376 495Q376 511 376 535T377 568Q377 613 367 624T316 637H298V660Q298 683 300 683L310 684Q320 685 339 686T376 688Q393 689 413 690T443 693T454 694H457V390Q457 84 458 81Q461 61 472 55T517 46H535V0Q533 0 459 -5T380 -11H373V44L365 37Q307 -11 235 -11Q158 -11 96 50T34 215Q34 315 97 378T244 442Q319 442 376 393V495ZM373 342Q328 405 260 405Q211 405 173 369Q146 341 139 305T131 211Q131 155 138 120T173 59Q203 26 251 26Q322 26 373 103V342Z"></path><path id="MJX-5-TEX-N-63" d="M370 305T349 305T313 320T297 358Q297 381 312 396Q317 401 317 402T307 404Q281 408 258 408Q209 408 178 376Q131 329 131 219Q131 137 162 90Q203 29 272 29Q313 29 338 55T374 117Q376 125 379 127T395 129H409Q415 123 415 120Q415 116 411 104T395 71T366 33T318 2T249 -11Q163 -11 99 53T34 214Q34 318 99 383T250 448T370 421T404 357Q404 334 387 320Z"></path><path id="MJX-5-TEX-N-6F" d="M28 214Q28 309 93 378T250 448Q340 448 405 380T471 215Q471 120 407 55T250 -10Q153 -10 91 57T28 214ZM250 30Q372 30 372 193V225V250Q372 272 371 288T364 326T348 362T317 390T268 410Q263 411 252 411Q222 411 195 399Q152 377 139 338T126 246V226Q126 130 145 91Q177 30 250 30Z"></path><path id="MJX-5-TEX-N-72" d="M36 46H50Q89 46 97 60V68Q97 77 97 91T98 122T98 161T98 203Q98 234 98 269T98 328L97 351Q94 370 83 376T38 385H20V408Q20 431 22 431L32 432Q42 433 60 434T96 436Q112 437 131 438T160 441T171 442H174V373Q213 441 271 441H277Q322 441 343 419T364 373Q364 352 351 337T313 322Q288 322 276 338T263 372Q263 381 265 388T270 400T273 405Q271 407 250 401Q234 393 226 386Q179 341 179 207V154Q179 141 179 127T179 101T180 81T180 66V61Q181 59 183 57T188 54T193 51T200 49T207 48T216 47T225 47T235 46T245 46H276V0H267Q249 3 140 3Q37 3 28 0H20V46H36Z"></path><path id="MJX-5-TEX-I-1D702" d="M21 287Q22 290 23 295T28 317T38 348T53 381T73 411T99 433T132 442Q156 442 175 435T205 417T221 395T229 376L231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336V326Q503 302 439 53Q381 -182 377 -189Q364 -216 332 -216Q319 -216 310 -208T299 -186Q299 -177 358 57L420 307Q423 322 423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 114 189T154 366Q154 405 128 405Q107 405 92 377T68 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path><path id="MJX-5-TEX-S4-2193" d="M473 86Q483 86 483 67Q483 63 483 61T483 56T481 53T480 50T478 48T474 47T470 46T464 44Q428 35 391 14T316 -55T264 -168Q264 -170 263 -173T262 -180T261 -184Q259 -194 251 -194Q242 -194 238 -176T221 -121T180 -49Q169 -34 155 -21T125 2T95 20T67 33T44 42T27 47L21 49Q17 53 17 67Q17 87 28 87Q33 87 42 84Q158 52 223 -45L230 -55V312Q230 391 230 482T229 591Q229 662 231 676T243 693Q244 694 251 694Q264 692 270 679V-55L277 -45Q307 1 353 33T430 76T473 86Z"></path><path id="MJX-5-TEX-S4-23D0" d="M312 0V602H355V0H312Z"></path><path id="MJX-5-TEX-I-1D701" d="M296 643Q298 704 324 704Q342 704 342 687Q342 682 339 664T336 633Q336 623 337 618T338 611Q339 612 341 612Q343 614 354 616T374 618L384 619H394Q471 619 471 586Q467 548 386 546H372Q338 546 320 564L311 558Q235 506 175 398T114 190Q114 171 116 155T125 127T137 104T153 86T171 72T192 61T213 53T235 46T256 39L322 16Q389 -10 389 -80Q389 -119 364 -154T300 -202Q292 -204 274 -204Q247 -204 225 -196Q210 -192 193 -182T172 -167Q167 -159 173 -148Q180 -139 191 -139Q195 -139 221 -153T283 -168Q298 -166 310 -152T322 -117Q322 -91 302 -75T250 -51T183 -29T116 4T65 62T44 160Q44 287 121 410T293 590L302 595Q296 613 296 643Z"></path><path id="MJX-5-TEX-D-211D" d="M17 665Q17 672 28 683H221Q415 681 439 677Q461 673 481 667T516 654T544 639T566 623T584 607T597 592T607 578T614 565T618 554L621 548Q626 530 626 497Q626 447 613 419Q578 348 473 326L455 321Q462 310 473 292T517 226T578 141T637 72T686 35Q705 30 705 16Q705 7 693 -1H510Q503 6 404 159L306 310H268V183Q270 67 271 59Q274 42 291 38Q295 37 319 35Q344 35 353 28Q362 17 353 3L346 -1H28Q16 5 16 16Q16 35 55 35Q96 38 101 52Q106 60 106 341T101 632Q95 645 55 648Q17 648 17 665ZM241 35Q238 42 237 45T235 78T233 163T233 337V621L237 635L244 648H133Q136 641 137 638T139 603T141 517T141 341Q141 131 140 89T134 37Q133 36 133 35H241ZM457 496Q457 540 449 570T425 615T400 634T377 643Q374 643 339 648Q300 648 281 635Q271 628 270 610T268 481V346H284Q327 346 375 352Q421 364 439 392T457 496ZM492 537T492 496T488 427T478 389T469 371T464 361Q464 360 465 360Q469 360 497 370Q593 400 593 495Q593 592 477 630L457 637L461 626Q474 611 488 561Q492 537 492 496ZM464 243Q411 317 410 317Q404 317 401 315Q384 315 370 312H346L526 35H619L606 50Q553 109 464 243Z"></path><path id="MJX-5-TEX-I-1D45B" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"></path><path id="MJX-5-TEX-N-28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path><path id="MJX-5-TEX-I-1D447" d="M40 437Q21 437 21 445Q21 450 37 501T71 602L88 651Q93 669 101 677H569H659Q691 677 697 676T704 667Q704 661 687 553T668 444Q668 437 649 437Q640 437 637 437T631 442L629 445Q629 451 635 490T641 551Q641 586 628 604T573 629Q568 630 515 631Q469 631 457 630T439 622Q438 621 368 343T298 60Q298 48 386 46Q418 46 427 45T436 36Q436 31 433 22Q429 4 424 1L422 0Q419 0 415 0Q410 0 363 1T228 2Q99 2 64 0H49Q43 6 43 9T45 27Q49 40 55 46H83H94Q174 46 189 55Q190 56 191 56Q196 59 201 76T241 233Q258 301 269 344Q339 619 339 625Q339 630 310 630H279Q212 630 191 624Q146 614 121 583T67 467Q60 445 57 441T43 437H40Z"></path><path id="MJX-5-TEX-N-29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path><path id="MJX-5-TEX-N-2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"></path><path id="MJX-5-TEX-N-31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mtable"><g data-mml-node="mtr" transform="translate(0, 1968.4)"><g data-mml-node="mtd" transform="translate(213.6, 0)"><g data-mml-node="mi"><use xlink:href="#MJX-5-TEX-I-1D449"></use></g><g data-mml-node="mpadded" transform="translate(769, 0)"></g></g><g data-mml-node="mtd" transform="translate(1696.3, 0)"><g data-mml-node="mover"><g data-mml-node="mo"><use xlink:href="#MJX-5-TEX-S4-2192" transform="translate(1750, 0)"></use><svg width="1850" height="865" x="0" y="-182" viewBox="462.5 -182 1850 865"><use xlink:href="#MJX-5-TEX-S4-2212" transform="scale(3.567, 1)"></use></svg></g><g data-mml-node="mpadded" transform="translate(1138.1, 783) scale(0.707)"><g transform="translate(330, 100)"><g data-mml-node="TeXAtom" data-mjx-texclass="ORD"><g data-mml-node="TeXAtom" data-mjx-texclass="ORD"><g data-mml-node="mi"><use xlink:href="#MJX-5-TEX-N-69"></use></g><g data-mml-node="mi" transform="translate(278, 0)"><use xlink:href="#MJX-5-TEX-N-64"></use></g></g></g></g></g></g></g><g data-mml-node="mtd" transform="translate(5159.9, 0)"><g data-mml-node="mi"><use xlink:href="#MJX-5-TEX-I-1D449"></use></g></g></g><g data-mml-node="mtr" transform="translate(0, 93.4)"><g data-mml-node="mtd" transform="translate(264.6, 0)"><g data-mml-node="mrow"><g data-mml-node="mstyle" transform="scale(0.707)"><g data-mml-node="TeXAtom" data-mjx-texclass="ORD"><g data-mml-node="mpadded"><g transform="translate(-2237.4, 0)"><g data-mml-node="TeXAtom" data-mjx-texclass="ORD"><g data-mml-node="msup"><g data-mml-node="TeXAtom" data-mjx-texclass="ORD"><g data-mml-node="mi"><use xlink:href="#MJX-5-TEX-N-63"></use></g><g data-mml-node="mi" transform="translate(444, 0)"><use xlink:href="#MJX-5-TEX-N-6F"></use></g><g data-mml-node="mi" transform="translate(944, 0)"><use xlink:href="#MJX-5-TEX-N-6F"></use></g><g data-mml-node="mi" transform="translate(1444, 0)"><use xlink:href="#MJX-5-TEX-N-72"></use></g></g><g data-mml-node="mi" transform="translate(1836, 363) scale(0.707)"><use xlink:href="#MJX-5-TEX-I-1D702"></use></g></g></g></g></g></g></g><g data-mml-node="mo"><use xlink:href="#MJX-5-TEX-S4-2193" transform="translate(83.5, -431)"></use><svg width="667" height="962" y="163" x="0" viewBox="0 240.5 667 962"><use xlink:href="#MJX-5-TEX-S4-23D0" transform="scale(1, 2.397)"></use></svg></g></g></g><g data-mml-node="mtd" transform="translate(3071.3, 0)"></g><g data-mml-node="mtd" transform="translate(5210.9, 0)"><g data-mml-node="mrow"><g data-mml-node="mo"><use xlink:href="#MJX-5-TEX-S4-2193" transform="translate(83.5, -431)"></use><svg width="667" height="962" y="163" x="0" viewBox="0 240.5 667 962"><use xlink:href="#MJX-5-TEX-S4-23D0" transform="scale(1, 2.397)"></use></svg></g><g data-mml-node="mstyle" transform="translate(667, 0) scale(0.707)"><g data-mml-node="TeXAtom" data-mjx-texclass="ORD"><g data-mml-node="mpadded"><g data-mml-node="TeXAtom" data-mjx-texclass="ORD"><g data-mml-node="msup"><g data-mml-node="TeXAtom" data-mjx-texclass="ORD"><g data-mml-node="mi"><use xlink:href="#MJX-5-TEX-N-63"></use></g><g data-mml-node="mi" transform="translate(444, 0)"><use xlink:href="#MJX-5-TEX-N-6F"></use></g><g data-mml-node="mi" transform="translate(944, 0)"><use xlink:href="#MJX-5-TEX-N-6F"></use></g><g data-mml-node="mi" transform="translate(1444, 0)"><use xlink:href="#MJX-5-TEX-N-72"></use></g></g><g data-mml-node="mi" transform="translate(1836, 363) scale(0.707)"><use xlink:href="#MJX-5-TEX-I-1D701"></use></g></g></g></g></g></g></g></g><g data-mml-node="mtd" transform="translate(6642.5, 0)"></g></g><g data-mml-node="mtr" transform="translate(0, -2592.1)"><g data-mml-node="mtd"><g data-mml-node="msup"><g data-mml-node="TeXAtom" data-mjx-texclass="ORD"><g data-mml-node="mi"><use xlink:href="#MJX-5-TEX-D-211D"></use></g></g><g data-mml-node="mi" transform="translate(722, 413) scale(0.707)"><use xlink:href="#MJX-5-TEX-I-1D45B"></use></g></g><g data-mml-node="mpadded" transform="translate(1196.3, 0)"></g></g><g data-mml-node="mtd" transform="translate(1696.3, 0)"><g data-mml-node="mover"><g data-mml-node="mo"><use xlink:href="#MJX-5-TEX-S4-2192" transform="translate(1750, 0)"></use><svg width="1850" height="865" x="0" y="-182" viewBox="462.5 -182 1850 865"><use xlink:href="#MJX-5-TEX-S4-2212" transform="scale(3.567, 1)"></use></svg></g><g data-mml-node="mpadded" transform="translate(1138.1, 870.8) scale(0.707)"><g transform="translate(330, 100)"><g data-mml-node="TeXAtom" data-mjx-texclass="ORD"><g data-mml-node="mo"><use xlink:href="#MJX-5-TEX-N-28"></use></g><g data-mml-node="msup" transform="translate(389, 0)"><g data-mml-node="mi"><use xlink:href="#MJX-5-TEX-I-1D447"></use></g><g data-mml-node="mi" transform="translate(760, 363) scale(0.707)"><use xlink:href="#MJX-5-TEX-I-1D702"></use></g></g><g data-mml-node="msup" transform="translate(1550.4, 0)"><g data-mml-node="mo"><use xlink:href="#MJX-5-TEX-N-29"></use></g><g data-mml-node="TeXAtom" transform="translate(389, 363) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mo"><use xlink:href="#MJX-5-TEX-N-2212"></use></g><g data-mml-node="mn" transform="translate(778, 0)"><use xlink:href="#MJX-5-TEX-N-31"></use></g></g></g></g></g></g></g></g><g data-mml-node="mtd" transform="translate(4946.3, 0)"><g data-mml-node="msup"><g data-mml-node="TeXAtom" data-mjx-texclass="ORD"><g data-mml-node="mi"><use xlink:href="#MJX-5-TEX-D-211D"></use></g></g><g data-mml-node="mi" transform="translate(722, 413) scale(0.707)"><use xlink:href="#MJX-5-TEX-I-1D45B"></use></g></g></g></g></g></g></g></svg></mjx-container><p>从线性空间本身来看，换基只是一次平凡的恒等变换．但从坐标空间的角度来看，坐标变换是非平凡的线性变换．</p><h1 id="·-特征值与特征向量"><a href="#·-特征值与特征向量" class="headerlink" title="· 特征值与特征向量"></a>· 特征值与特征向量</h1><p>给定一个线性变换 $ \mathcal{A} $，如果能够找到一个基 $ \zeta $，使得 $ \mathcal{A} $ 在 $ \zeta $ 下的矩阵表示 $ A^ \zeta $ 为对角阵 $ \Lambda $，即</p><script type="math/tex; mode=display">A^\zeta = \Lambda = \begin{pmatrix}     \lambda_{1}& &&\\     & \lambda_{2} &&\\     & &\ddots&\\     &&& \lambda_{n} \end{pmatrix} ,</script><p>那么就有</p><script type="math/tex; mode=display">(\mathcal{A} \zeta_1 \; \mathcal{A} \zeta_2 \;\cdots\; \mathcal{A} \zeta_n) = (\zeta_1\; \zeta_2\;\cdots\; \zeta_n ) \begin{pmatrix}     \lambda_{1}& &&\\ & \lambda_{2} &&\\ & &\ddots&\\ &&& \lambda_{n} \end{pmatrix} = (\lambda_{1} \zeta_1 \; \lambda_{2} \zeta_2 \;\cdots\; \lambda_{n} \zeta_n)．</script><p>即对角阵的 $n$ 个对角元 <script type="math/tex">\lambda_{1},\lambda_{2},\cdots,\lambda_{n}</script> 是线性变换 $\mathcal{A}$ 的特征值，而 $\zeta_1,\zeta_2,\cdots,\zeta_n$ 是其对应的特征向量．从几何上看，若以 $n$ 个特征值对应的特征向量作为基，线性变换对基向量的作用仅仅是简单的缩放．</p><p>为了计算一个具体的例子，让我们把目光再次转向选取了标准正交基 $ \epsilon $ 的欧式平面．我们知道，矩阵</p><script type="math/tex; mode=display">A ^\epsilon =\begin{pmatrix}    1&2\\    -1&4\end{pmatrix}</script><p>表示的线性变换把 $ \epsilon_1=(1,0)^T $ 映成 $ A^\epsilon \epsilon_1=(1,-1)^T $，$ \epsilon_2=(0,1)^T $ 映成 $ A ^\epsilon \epsilon_2=(2,4)^T $．</p><p>这个变换过程有点不太容易想象．但如果我们选取这样一个由特征向量构成的基 $ \zeta_1=(2,1)^T $ , $ \zeta_2=(1,1)^T $，并计算矩阵 $A^\epsilon$ 所表示的线性变换在基 $ \zeta_1,\zeta_2 $ 上的作用，我们会发现</p><script type="math/tex; mode=display">A^\epsilon\zeta_1=\begin{pmatrix}    4\\    2\end{pmatrix}=2\zeta_1,\quadA^\epsilon\zeta_2=\begin{pmatrix}    3\\    3\end{pmatrix}=3\zeta_2.</script><p>这说明，矩阵 $A^\epsilon$ 所表示的线性变换可以看成 $ \zeta_1,\zeta_2$ 方向上的一个缩放．</p>]]></content>
    
    
    <categories>
      
      <category>数学</category>
      
    </categories>
    
    
    <tags>
      
      <tag>数学</tag>
      
      <tag>线性代数</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
